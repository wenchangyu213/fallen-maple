window.__require=function e(t,i,s){function o(a,r){if(!i[a]){if(!t[a]){var c=a.split("/");if(c=c[c.length-1],!t[c]){var l="function"==typeof __require&&__require;if(!r&&l)return l(c,!0);if(n)return n(c,!0);throw new Error("Cannot find module '"+a+"'")}a=c}var h=i[a]={exports:{}};t[a][0].call(h.exports,function(e){return o(t[a][1][e]||e)},h,h.exports,e,t,i,s)}return i[a].exports}for(var n="function"==typeof __require&&__require,a=0;a<s.length;a++)o(s[a]);return o}({ActiveThing:[function(e,t,i){"use strict";cc._RF.push(t,"67b26qM4txMEb1Ryy0PaCtU","ActiveThing");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const o=e("../../../utils/enums"),n=e("../../../utils/messager"),{ccclass:a,property:r,menu:c}=cc._decorator;let l=class extends cc.Component{constructor(){super(...arguments),this.mode=o.EnumsInUse.RunningState.Idle,this.isLoop=!1,this.isAuto=!1,this.cycleTimes=1,this.activeItems=[],this.callTag=0,this.targetNode=null,this._tikPast=0,this._itemCursor=0,this._cycleTimes=0}onLoad(){cc.isValid(this.targetNode)||(this.targetNode=this.node),this._initEvents()}onEnable(){this.isAuto&&(this.mode=o.EnumsInUse.RunningState.Running),this.cycleTimes<1&&(this.cycleTimes=1),this._cycleTimes=this.cycleTimes,this._itemCursor=0,this._tikPast=0,this._calculate()}onDisable(){this.mode=o.EnumsInUse.RunningState.Idle}start(){}update(e){this._calculate(e)}_initEvents(){this.node.on(n.Messager.Inners.StateChange_Pause,()=>{this.mode=o.EnumsInUse.RunningState.Paused},this),this.node.on(n.Messager.Inners.StateChange_Run,e=>{null!=e&&e!=this.callTag||(this._cycleTimes=this.cycleTimes,this.mode=o.EnumsInUse.RunningState.Running)},this),this.node.on(n.Messager.Inners.StateChange_Stop,()=>{this.mode=o.EnumsInUse.RunningState.Stop},this),this.node.on(n.Messager.Inners.ThingSetChange_Active,e=>{e&&(this.activeItems=e),this._itemCursor=0,this._tikPast=0},this)}_calculate(e=0){switch(this.mode){case o.EnumsInUse.RunningState.Running:if(this.activeItems.length<=0)return;this._tikPast=this._tikPast+e;break;default:return}if(this._tikPast>=this.activeItems[this._itemCursor].x&&(this.targetNode.active=0!=this.activeItems[this._itemCursor].y,this._tikPast=this._tikPast-this.activeItems[this._itemCursor].x,this._itemCursor++),this._itemCursor>=this.activeItems.length){if(this._itemCursor=0,this.isLoop)return;if(this._cycleTimes--,this._cycleTimes<1)return void(this.mode=o.EnumsInUse.RunningState.Idle)}}};s([r({type:cc.Enum(o.EnumsInUse.RunningState)})],l.prototype,"mode",void 0),s([r],l.prototype,"isLoop",void 0),s([r],l.prototype,"isAuto",void 0),s([r({min:1})],l.prototype,"cycleTimes",void 0),s([r({type:[cc.Vec2],tooltip:"y=0 is using as inactive while others as active"})],l.prototype,"activeItems",void 0),s([r],l.prototype,"callTag",void 0),s([r(cc.Node)],l.prototype,"targetNode",void 0),l=s([a,c("Creatives/behavior2d/ActiveThing")],l),i.default=l,cc._RF.pop()},{"../../../utils/enums":"enums","../../../utils/messager":"messager"}],AlleyAtk:[function(e,t,i){"use strict";cc._RF.push(t,"78090qKASBE0Jkru1pXorCW","AlleyAtk");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const o=e("./Enemy"),{ccclass:n,property:a}=cc._decorator;let r=class extends cc.Component{constructor(){super(...arguments),this.hurt=1,this.atkDire=cc.v2()}onLoad(){}start(){}onShoot(e){}onCollisionEnter(e,t){e.getComponent(o.default).onHit(this.hurt),this.node.removeFromParent(),this.node.destroy()}};r=s([n],r),i.default=r,cc._RF.pop()},{"./Enemy":"Enemy"}],Alley:[function(e,t,i){"use strict";cc._RF.push(t,"c469aN+B6BDSK5T38Vgi3ne","Alley");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0}),i.AlleySpAnis=void 0;const o=e("../Framework/Management/MgrMain"),n=e("./Constant"),a=e("./InGaming"),{ccclass:r,property:c}=cc._decorator;var l;(function(e){e.Idle="idle",e.Atk="attack",e.Run="run",e.Work="cut",e.Die="die"})(l=i.AlleySpAnis||(i.AlleySpAnis={}));let h=class extends cc.Component{constructor(){super(...arguments),this.alleyType=n.Prefabs.Archer,this.hitMat=null,this.hpNode=null,this.hpBarSpr=null,this.hittedAni=null,this.isRunning=!1,this.isDead=!1,this.dieAniDura=2,this.spine=null,this.rigid=null,this.deadCb=null,this.moveSpeed=n.AlleyMoveSpeed,this.hurt=1,this._atkSpan=n.ArcherAtkSpan,this._atkRange=n.ArcherAtkRange,this._atkAniDelay=n.ArcherAtkAniDelay,this._lastSpAni=l.Idle,this._tmpVec2s=[cc.v2(),cc.v2(),cc.v2()],this.maxHp=n.AlleyMaxHp,this.hp=0,this.lockHp=0,this._mat=null,this._matVals={progress:0},this._isTweening=!1,this._onAtk=null}onLoad(){this.hp=this.maxHp,this.spine=this.node.getChildByName("char").getComponent(sp.Skeleton),cc.isValid(this.hitMat)&&(this.spine.setMaterial(0,this.hitMat),this._mat=this.spine.getMaterial(0),this._mat.setProperty("progress",this._matVals.progress,0)),this.rigid=this.getComponent(cc.RigidBody),this._onAtk=this.onAtk.bind(this)}start(){cc.isValid(this.rigid)&&this.rigid.syncPosition(!1)}onDestroy(){cc.Tween.stopAllByTarget(this._matVals),cc.Tween.stopAllByTarget(this.node),this.unscheduleAllCallbacks()}onScheduleAtk(){}onAtk(){}onHit(e){!this.isDead&&cc.isValid(this._mat)&&(o.default.Instance.MgrAudio.forcePlayMusic(8),this.hp-=e,this.hp<=0&&(this.hp=0,cc.tween(this.hpNode).to(.2,{opacity:0}).start(),this.isDead=!0,this.unscheduleAllCallbacks(),this.spine.setAnimation(0,l.Die,!1),this.scheduleOnce(()=>{this.node.destroy(),this.deadCb&&this.deadCb()},this.dieAniDura)),this._isTweening||(this._isTweening=!0,e>0&&this.hittedAni.play(),cc.tween(this._matVals).to(.2,{progress:n.HitFlashAniDura},{onUpdate:e=>{this._mat.setProperty("progress",e.progress,0)}}).to(.2,{progress:0},{onUpdate:e=>{this._mat.setProperty("progress",e.progress,0)}}).call(()=>this._isTweening=!1).start(),e>0&&cc.isValid(this.hpNode)&&!this.hpNode.active&&(this.hpNode.active=!0),cc.isValid(this.hpBarSpr)&&(this.hpBarSpr.fillRange=this.hp/this.maxHp)))}onMoveDestination(e,t=!0){this.isDead=!0;let i=e.children,s=cc.tween(this.node);i.forEach(e=>{e.convertToWorldSpaceAR(cc.Vec2.ZERO_R,this._tmpVec2s[0]),a.default.Instance.mapNode.convertToNodeSpaceAR(this._tmpVec2s[0],this._tmpVec2s[1]),this._tmpVec2s[1].sub(this._tmpVec2s[0],this._tmpVec2s[2]);let t=this._tmpVec2s[2].x>=0?1:-1;s=s.then(cc.tween(this.node).call(()=>this.node.scaleX=t).to(this._tmpVec2s[2].mag()/n.AlleyMoveSpeed,{x:this._tmpVec2s[1].x,y:this._tmpVec2s[1].y}))}),t&&(s=s.then(cc.tween(this.node).call(()=>{this.isDead=!1,this.isRunning=!1,this.setAnimation(l.Idle),this.onScheduleAtk()}))),this.setAnimation(l.Run),s.start()}setAnimation(e,t=!0){t&&e==this._lastSpAni||(this.spine.setAnimation(0,e,t),this._lastSpAni=e)}stopActions(){this.isDead=!0,this.rigid.linearVelocity=cc.Vec2.ZERO_R,this.setAnimation(l.Idle),this.unscheduleAllCallbacks()}};s([c({type:cc.Enum(n.Prefabs)})],h.prototype,"alleyType",void 0),s([c(cc.Material)],h.prototype,"hitMat",void 0),s([c(cc.Node)],h.prototype,"hpNode",void 0),s([c(cc.Sprite)],h.prototype,"hpBarSpr",void 0),s([c(cc.Animation)],h.prototype,"hittedAni",void 0),h=s([r],h),i.default=h,cc._RF.pop()},{"../Framework/Management/MgrMain":"MgrMain","./Constant":"Constant","./InGaming":"InGaming"}],AnimationCtrl:[function(e,t,i){"use strict";cc._RF.push(t,"10732oPw8hGVIh4arr+dfLS","AnimationCtrl");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const o=e("./RepeatableBehavior"),{ccclass:n,property:a,menu:r}=cc._decorator;let c=class extends o.default{constructor(){super(...arguments),this.rpType=o.RepeatableBehaviorType.Animations,this._behavior=null}start(){}CheckSubTypeLegal(){return this._behavior||(this._behavior=this.effectNode.getComponent(cc.Animation)),!!this._behavior}SubAction(){this._living&&(this._commandInfo.command.length>0?this._behavior.play(this._commandInfo.command):this._behavior.play())}};c=s([n,r("Creatives/Logics/AnimationCtrl")],c),i.default=c,cc._RF.pop()},{"./RepeatableBehavior":"RepeatableBehavior"}],Archer:[function(e,t,i){"use strict";cc._RF.push(t,"7f17aywb1lCSK+D0tgEmxlO","Archer");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const o=e("../Framework/Management/MgrMain"),n=e("../Framework/utils/utils"),a=e("./Alley"),r=e("./AlleyAtk"),c=e("./Constant"),l=e("./EnemyInit"),h=e("./InGaming"),{ccclass:d,property:p}=cc._decorator;let u=class extends a.default{onLoad(){super.onLoad()}start(){super.start()}onScheduleAtk(){this.getComponent(cc.PhysicsCollider).sensor=!1,this.schedule(this._onAtk,this._atkSpan,cc.macro.REPEAT_FOREVER)}onAtk(){if(this.isRunning||this.isDead)return void this.unschedule(this._onAtk);this.node.getChildByName("shootPoint").convertToWorldSpaceAR(cc.Vec2.ZERO_R,this._tmpVec2s[2]),h.default.Instance.atkArrowsNode.convertToNodeSpaceAR(this._tmpVec2s[2],this._tmpVec2s[0]);let e=null;if(cc.isValid(l.default.Instance.bossCollider)&&l.default.Instance.bossCollider.node.active&&(l.default.Instance.bossCollider.node.getPosition(this._tmpVec2s[1]),this._tmpVec2s[1].subSelf(this._tmpVec2s[0]),this._tmpVec2s[1].mag()<=this._atkRange&&(e=l.default.Instance.bossCollider.node)),null==e){const t=l.default.Instance.enemys;let i=n.Utils.RandomRangeInt(0,t.length);for(let s=0;s<t.length;s++){let o=(s+i)%t.length;if(cc.isValid(t[o])&&!t[o].isDead&&(t[o].node.getPosition(this._tmpVec2s[1]),this._tmpVec2s[1].subSelf(this._tmpVec2s[0]),this._tmpVec2s[1].mag()<=this._atkRange)){e=t[o].node;break}}}if(null!=e&&!this._tmpVec2s[1].equals(cc.Vec2.ZERO_R)){if(this.node.scaleX=this._tmpVec2s[1].x>=0?1:-1,cc.isValid(this.hpNode)){let e=Math.abs(this.hpNode.scaleX);this.hpNode.scaleX=this._tmpVec2s[1].x>=0?e:-e}let e=cc.instantiate(o.default.Instance.MgrRcs.prefabs[c.Prefabs.AtkArrow]);e.getComponent(r.default).hurt=this.hurt,e.angle=-cc.misc.radiansToDegrees(this._tmpVec2s[1].signAngle(cc.Vec2.UP_R)),e.setPosition(this._tmpVec2s[0]),this.scheduleOnce(()=>{e.setParent(h.default.Instance.atkArrowsNode),e.getComponent(r.default).onShoot(this._tmpVec2s[1])},this._atkAniDelay),this.setAnimation(a.AlleySpAnis.Atk,!1)}}};u=s([d],u),i.default=u,cc._RF.pop()},{"../Framework/Management/MgrMain":"MgrMain","../Framework/utils/utils":"utils","./Alley":"Alley","./AlleyAtk":"AlleyAtk","./Constant":"Constant","./EnemyInit":"EnemyInit","./InGaming":"InGaming"}],Area:[function(e,t,i){"use strict";cc._RF.push(t,"c62f1M1E0FMn6wYsposjIp+","Area");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const o=e("./Constant"),{ccclass:n,property:a}=cc._decorator;let r=class extends cc.Component{constructor(){super(...arguments),this.areaType=o.AreaType.Camp}onLoad(){}start(){}};s([a({type:cc.Enum(o.AreaType)})],r.prototype,"areaType",void 0),r=s([n],r),i.default=r,cc._RF.pop()},{"./Constant":"Constant"}],AtkArrow:[function(e,t,i){"use strict";cc._RF.push(t,"091669rF8lNErNXUdx1DzWi","AtkArrow");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const o=e("../Framework/Management/MgrMain"),n=e("./AlleyAtk"),a=e("./Constant"),{ccclass:r,property:c}=cc._decorator;let l=class extends n.default{onLoad(){super.onLoad()}start(){super.start()}onShoot(e){o.default.Instance.MgrAudio.forcePlayMusic(0),e.normalize(this.atkDire),this.atkDire.mulSelf(a.AtkArrowLifeTime*a.AtkArrowSpeed),cc.tween(this.node).by(a.AtkArrowLifeTime,{x:this.atkDire.x,y:this.atkDire.y}).call(()=>this.node.destroy()).start()}};l=s([r],l),i.default=l,cc._RF.pop()},{"../Framework/Management/MgrMain":"MgrMain","./AlleyAtk":"AlleyAtk","./Constant":"Constant"}],Boss:[function(e,t,i){"use strict";cc._RF.push(t,"1b8419esItODp+9yBpMLtUH","Boss");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const o=e("../Framework/Management/MgrMain"),n=e("./Constant"),a=e("./Enemy"),r=e("./Fence"),c=e("./InGaming"),{ccclass:l,property:h}=cc._decorator;var d;(function(e){e.Idle="idle",e.Run="run",e.Atk="attack",e.Die="die"})(d||(d={}));let p=class extends a.default{constructor(){super(...arguments),this.maxHp=n.BossMaxHp,this.moveSpeed=n.BossMoveSpeed,this._atkSpan=n.BossAtkSpan}onLoad(){super.onLoad(),this.node.on(n.StopActionsCall,this.stopActions,this)}start(){super.start()}update(e){if(this._burnAniDura>0)return void(this._burnAniDura-=e);if(this.isDead)return;const t=c.default.Instance.charCtrl;this.node.getPosition(this._tmpVec2s[1]),c.default.Instance.charPos.sub(this._tmpVec2s[1],this._tmpVec2s[2]),t.curAreaType==n.AreaType.Out?(null!=this._atkCollider&&this._atkCollider.node!=t.collider.node&&(this._atkCollider=null),this._tmpVec2s[2].mag()<=this.followRange?this._isAtking||(this._isAtking=!0,this.schedule(this._onAtk,this._atkSpan,cc.macro.REPEAT_FOREVER),this._atkCollider=t.collider,this._tmpVec2s[2].x=0,this._tmpVec2s[2].y=0,this.rigid.linearVelocity=this._tmpVec2s[2]):(this._isAtking&&(this._isAtking=!1,this.unschedule(this._onAtk)),this.setAnimation(d.Run),this.rigid.linearVelocity=this._tmpVec2s[2].normalizeSelf().mulSelf(this.moveSpeed),this.node.scaleX=this._tmpVec2s[2].x<=0?-1:1,this.hpNode.scaleX=this._tmpVec2s[2].x<=0?-1:1)):null==this._atkCollider?(this.rigid.linearVelocity=this._tmpVec2s[2].normalizeSelf().mulSelf(this.moveSpeed),this.node.scaleX=this._tmpVec2s[2].x<=0?-1:1,this.hpNode.scaleX=this._tmpVec2s[2].x<=0?-1:1,this.setAnimation(d.Run),this._isAtking&&(this._isAtking=!1,this.unschedule(this._onAtk))):this._isAtking||(this._isAtking=!0,this.schedule(this._onAtk,this._atkSpan,cc.macro.REPEAT_FOREVER))}onAtk(){null!=this._atkCollider?(this.scheduleOnce(()=>{null!=this._atkCollider?(o.default.Instance.MgrAudio.forcePlayMusic(5),this.atkAni.play(),this._atkCollider.tag!=n.PhysicsTags.Fence&&this._atkCollider.tag!=n.PhysicsTags.Door||this._atkCollider.getComponent(r.default).onHit(this.hurt)):this.unschedule(this._onAtk)},this._atkAniDelay),this.setAnimation(d.Atk,!1)):this.unschedule(this._onAtk)}onHit(e){super.onHit(e),this.hp<=0&&o.default.Instance.MgrAudio.PlayMusic(2)}};p=s([l],p),i.default=p,cc._RF.pop()},{"../Framework/Management/MgrMain":"MgrMain","./Constant":"Constant","./Enemy":"Enemy","./Fence":"Fence","./InGaming":"InGaming"}],CallEvent:[function(e,t,i){"use strict";cc._RF.push(t,"bfc29Mv45pF3p+rjcZ7Wthb","CallEvent");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const{ccclass:o,property:n}=cc._decorator;let a=class extends cc.Component{constructor(){super(...arguments),this.callEvents=[],this.callDelay=0,this._timePast=-1}onEnable(){this._timePast=0}update(e){this._timePast<0||(this._timePast+=e,this._timePast>=this.callDelay&&(cc.Component.EventHandler.emitEvents(this.callEvents),this._timePast=-1))}};s([n([cc.Component.EventHandler])],a.prototype,"callEvents",void 0),s([n(cc.Float)],a.prototype,"callDelay",void 0),a=s([o],a),i.default=a,cc._RF.pop()},{}],Camp:[function(e,t,i){"use strict";cc._RF.push(t,"f69eaSMfDFGcYRY4LwuxgHR","Camp");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const o=e("../Framework/Management/MgrMain"),n=e("./Alley"),a=e("./Constant"),r=e("./InGaming"),c=e("./Need"),l=e("./NeedFarmer"),{ccclass:h,property:d}=cc._decorator;let p=class extends cc.Component{constructor(){super(...arguments),this.alleyType=a.Prefabs.Archer,this.toLvNeeds=[],this.needFarmer=null,this.initNode=null,this.upgradeAni=null,this.level=0,this.maxLevel=a.JianTaMaxLevel,this.alleys=[],this.alleyCount=0,this.maxAlleyCount=a.MaxCampCount,this.trainingCount=0,this._tmpVec2s=[cc.v2(),cc.v2(),cc.v2()]}onLoad(){this.initNode=this.node.getChildByName("init"),this.upgradeAni=this.node.getComponentInChildren(cc.Animation),o.default.Instance.MgrAudio.forcePlayMusic(10),this.needFarmer.node.active=!0,this.node.__alleys=this.alleys,this.node.on(a.ChangeBuildMaxLevel,e=>{this.maxLevel=e,this.level<this.maxLevel&&(this.toLvNeeds[this.level-1].node.active=!0)})}start(){}onUpgrade(){var e;o.default.Instance.MgrAudio.forcePlayMusic(10),this.level>0&&this.level,this.level++,null===(e=this.upgradeAni)||void 0===e||e.play()}onEnter(e){if(this.alleyCount<this.maxAlleyCount){this.alleyCount++;let t=0;for(let e=0;e<this.maxAlleyCount;e++)if(!cc.isValid(this.alleys[e])){t=e;break}let i=cc.instantiate(o.default.Instance.MgrRcs.prefabs[this.alleyType]),s=i.getComponent(n.default);this.alleys[t]=s;let c=e.getComponent(n.default),l=this.trainingCount++,h=this.node.getChildByName("train"),d=h.childrenCount,p=cc.tween(e);for(let o=d-l-1;o<d-1;o++)h.children[o].convertToWorldSpaceAR(cc.Vec2.ZERO,this._tmpVec2s[0]),r.default.Instance.mapNode.convertToNodeSpaceAR(this._tmpVec2s[0],this._tmpVec2s[1]),p.then(cc.tween(e).call(()=>{e.scaleX=this._tmpVec2s[1].x-e.x>0?1:-1,c.setAnimation(n.AlleySpAnis.Run)}).to(.2,{x:this._tmpVec2s[1].x,y:this._tmpVec2s[1].y}).call(()=>{c.setAnimation(n.AlleySpAnis.Idle)}).delay(a.AlleyTrainTime));h.children[d-1].convertToWorldSpaceAR(cc.Vec2.ZERO,this._tmpVec2s[0]),r.default.Instance.mapNode.convertToNodeSpaceAR(this._tmpVec2s[0],this._tmpVec2s[1]),(p=p.then(cc.tween(e).to(.5,{x:this._tmpVec2s[1].x,y:this._tmpVec2s[1].y}).call(()=>{"Camp0"==this.node.name?(c.node.scaleX=1,c.setAnimation(n.AlleySpAnis.Atk)):(c.node.scaleX=-1,c.spine.setSkin("pifu03"),c.setAnimation(n.AlleySpAnis.Work))}).delay(a.AlleyTrainTime).call(()=>{this.trainingCount--,e.convertToWorldSpaceAR(cc.Vec2.ZERO_R,this._tmpVec2s[0]),e.destroy(),r.default.Instance.mapNode.convertToNodeSpaceAR(this._tmpVec2s[0],this._tmpVec2s[1]),i.setPosition(this._tmpVec2s[1]),i.setParent(r.default.Instance.mapNode),s.deadCb=this.onCheckAlleys.bind(this),s.setAnimation(n.AlleySpAnis.Run),this.initNode.convertToWorldSpaceAR(cc.Vec2.ZERO_R,this._tmpVec2s[0]),r.default.Instance.mapNode.convertToNodeSpaceAR(this._tmpVec2s[0],this._tmpVec2s[1]),cc.tween(i).to(.5,{x:this._tmpVec2s[1].x,y:this._tmpVec2s[1].y}).call(()=>{let e=this.initNode.children[t];s.onMoveDestination(e)}).start()}))).start(),this.alleyCount>=this.maxAlleyCount&&(this.needFarmer.node.active=!1)}}onToFactoryAndEnter(){if(this.alleyCount>=this.maxAlleyCount)return;let e=r.default.Instance.charCtrl.onShiftFollowee();if(!cc.isValid(e))return;e.getPosition(this._tmpVec2s[0]),this.needFarmer.node.getPosition(this._tmpVec2s[1]),this._tmpVec2s[1].sub(this._tmpVec2s[0],this._tmpVec2s[2]);let t=this._tmpVec2s[2].x>=0?1:-1;e.getComponent(n.default).setAnimation(n.AlleySpAnis.Run),cc.tween(e).call(()=>e.scaleX=t).to(this._tmpVec2s[2].mag()/a.AlleyMoveSpeed,{x:this._tmpVec2s[1].x,y:this._tmpVec2s[1].y}).call(()=>{this.onEnter(e)}).start()}onCheckAlleys(){this.scheduleOnce(()=>{this.scheduleOnce(()=>{let e=0;this.alleys.forEach((t,i)=>{cc.isValid(t)?e++:this.alleys[i]=null}),this.alleyCount=e,this.needFarmer.owns=e,this.needFarmer.onUpdateProgress(),this.needFarmer.node.active=this.alleyCount<this.maxAlleyCount})})}};s([d({type:cc.Enum(a.Prefabs)})],p.prototype,"alleyType",void 0),s([d([c.default])],p.prototype,"toLvNeeds",void 0),s([d(l.default)],p.prototype,"needFarmer",void 0),p=s([h],p),i.default=p,cc._RF.pop()},{"../Framework/Management/MgrMain":"MgrMain","./Alley":"Alley","./Constant":"Constant","./InGaming":"InGaming","./Need":"Need","./NeedFarmer":"NeedFarmer"}],CharacterController:[function(e,t,i){"use strict";cc._RF.push(t,"a393529isdED5k5OOQMiG8m","CharacterController");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const o=e("../Framework/Management/MgrMain"),n=e("./Area"),a=e("./Constant"),r=e("./DropCoin"),c=e("./Enemy"),l=e("./Factory"),h=e("./HeroAtk"),d=e("./InGaming"),p=e("./Need"),u=e("./RangeFollowee"),{ccclass:m,property:_}=cc._decorator;var g,f,y;(function(e){e.Idle="idle",e.Run="run",e.Atk="skill2_x",e.RunAtk="run_skill2",e.Work="skill1"})(g||(g={})),function(e){e.Weapon="wu1"}(f||(f={})),function(e){e.Wp_Atk="BarbarianAxe",e.Wp_Wood="wu1",e.Wp_Stone="barb"}(y||(y={})),cc.color(200,0,0),cc.color(255,128,0),cc.color(0,255,0);let v=class extends cc.Component{constructor(){super(...arguments),this.eventNode=null,this.camera=null,this.roleSpine=null,this.collectsNode=null,this.heroAtk=null,this.heroAtkAni=null,this.moveSpeed=a.HeroMoveSpeed,this.moveDirection=cc.Vec2.ZERO,this.linearVelocity=cc.Vec2.ZERO,this.hurt=1,this.rigidBody=null,this._lastPos=cc.Vec2.ZERO,this._curPos=cc.Vec2.ZERO,this._fuzzyEqualsRange=.1,this.collider=null,this.hasWorkContact=!1,this._lastResCollider=null,this._lastSpineAni=g.Idle,this.validEnemyCount=0,this._isAttacking=!1,this.curAreaType=a.AreaType.Camp,this._giveSchedule=null,this._tmpVec2s=[cc.v2(),cc.v2(),cc.v2()],this._onAtk=null}onLoad(){this.rigidBody=this.node.getComponent(cc.RigidBody),this.collider=this.node.getComponent(cc.CircleCollider),this.collider.__followees=[],this.roleSpine.timeScale=1.5,this.roleSpine.setAttachment(f.Weapon,y.Wp_Atk),this.node.once(a.FarmerFollow,()=>{this.eventNode.emit(a.FarmerFollow)})}start(){this.rigidBody.syncPosition(!1),this._onAtk=this.onAtk.bind(this)}Reset(){}update(e){this.validEnemyCount=0,this.heroAtk.enemyColliders.forEach((e,t)=>{cc.isValid(e)&&(e.getComponent(c.default).isDead?this.heroAtk.enemyColliders[t]=null:this.validEnemyCount++)});let t=null,i=!1;this.moveDirection.equals(cc.Vec2.ZERO_R)&&(this.validEnemyCount>0?(this._isAttacking||(this._isAttacking=!0,this.roleSpine.setAttachment(f.Weapon,y.Wp_Atk),this.schedule(this._onAtk,a.HeroAtkSpan,cc.macro.REPEAT_FOREVER)),t=g.Atk):(this._isAttacking&&(this._isAttacking=!1,this.unschedule(this._onAtk)),this.hasWorkContact?(this._lastResCollider.tag==a.PhysicsTags.Wood?this.roleSpine.setAttachment(f.Weapon,y.Wp_Wood):this.roleSpine.setAttachment(f.Weapon,y.Wp_Stone),t=g.Work):(t=g.Idle,i=!0)),this.rigidBody.linearVelocity=cc.Vec2.ZERO_R),t&&t!=this._lastSpineAni&&(this._lastSpineAni=t,this.roleSpine.setAnimation(0,t,i))}setMoveDirection(e){this.moveDirection.x=e.x,this.moveDirection.y=e.y;let t=null,i=!1;e.equals(cc.Vec2.ZERO_R)||(e.x<=0?this.node.scaleX=-1:this.node.scaleX=1,this.validEnemyCount>0?(this._isAttacking||(this._isAttacking=!0,this.schedule(this._onAtk,a.HeroAtkSpan,cc.macro.REPEAT_FOREVER)),t=g.RunAtk):(this._isAttacking&&(this._isAttacking=!1,this.unschedule(this._onAtk)),t=g.Run,i=!0)),t&&t!=this._lastSpineAni&&(this._lastSpineAni=t,this.roleSpine.setAnimation(0,t,i)),this.moveDirection.mul(this.moveSpeed,this.linearVelocity),this.rigidBody.linearVelocity=this.linearVelocity}onCollisionEnter(e,t){if(e.tag!=a.PhysicsTags.Wood&&e.tag!=a.PhysicsTags.Stone||(this._lastResCollider=e),e.tag==a.PhysicsTags.Area){let t=e.getComponent(n.default);cc.isValid(t)&&(this.curAreaType=t.areaType);let i=e.getComponent(p.default);if(cc.isValid(i)&&i.owns<i.needs&&i.resType!=a.ResourceType.Farmer){let e=Math.min(i.needs-i.owns,d.default.Instance.resCount[i.resType]);this._giveSchedule=()=>{let e=cc.instantiate(o.default.Instance.MgrRcs.prefabs[i.resType+3]);const t=d.default.Instance.onGetDropResToNode(i.resType);cc.isValid(t)&&(d.default.Instance.resCount[i.resType]--,d.default.Instance.updateResFlag=!0,i.onAdd(),t.convertToWorldSpaceAR(cc.Vec2.ZERO_R,this._tmpVec2s[0]),d.default.Instance.mapTopNode.convertToNodeSpaceAR(this._tmpVec2s[0],this._tmpVec2s[1]),e.setPosition(this._tmpVec2s[1]),e.setParent(d.default.Instance.mapTopNode),e.scale=t.parent.scale,e.getComponent(r.default).onFlyTo(i.node,()=>{}))},this.schedule(this._giveSchedule,a.ResourceFillSpan,e-1)}}if(e.tag==a.PhysicsTags.FactoryWood||e.tag==a.PhysicsTags.FactoryStone){let t=e.getComponent(l.default);if(cc.isValid(t)&&t.resCount>0){let e=t.resCount;this._giveSchedule=()=>{let e=d.default.Instance.resCount[t.resType],i=e>40?40:e,s=this.collectsNode.children[t.resType].children[i];t.onDecResource();let n=cc.instantiate(o.default.Instance.MgrRcs.prefabs[t.resType+3]);const a=t.onGetDropResToNode(t.resType);d.default.Instance.resCount[t.resType]++,a.convertToWorldSpaceAR(cc.Vec2.ZERO_R,this._tmpVec2s[0]),s.parent.convertToNodeSpaceAR(this._tmpVec2s[0],this._tmpVec2s[1]),n.setPosition(this._tmpVec2s[1]),n.setParent(s.parent),n.scale=1,n.getComponent(r.default).onFlyTo(s,()=>{d.default.Instance.updateResFlag=!0})},this.schedule(this._giveSchedule,a.ResourceFillSpan,e-1)}}}onCollisionExit(e,t){e.tag!=a.PhysicsTags.Wood&&e.tag!=a.PhysicsTags.Stone||e.node!=this._lastResCollider.node||(this._lastResCollider=null),e.tag==a.PhysicsTags.Area&&null!=this._giveSchedule&&(this.unschedule(this._giveSchedule),this._giveSchedule=null)}onAtk(){this.validEnemyCount<=0?this.unschedule(this._onAtk):(o.default.Instance.MgrAudio.forcePlayMusic(1),this.roleSpine.setAnimation(0,this._lastSpineAni,!1),this.scheduleOnce(()=>{this.heroAtkAni.play()},.05),this.heroAtk.enemyColliders.forEach(e=>{cc.isValid(e)&&e.getComponent(c.default).onHit(this.hurt)}))}onHit(){}onHaveFolloee(){return this.collider.__followees.length>0}onShiftFollowee(){let e=this.collider.__followees.shift();return cc.isValid(e)&&(e.getComponent(u.default).follower=null),this.collider.__followees.length>0&&(this.collider.__followees[0].getComponent(u.default).follower=this.node),e}};s([_(cc.Node)],v.prototype,"eventNode",void 0),s([_(cc.Camera)],v.prototype,"camera",void 0),s([_(sp.Skeleton)],v.prototype,"roleSpine",void 0),s([_(cc.Node)],v.prototype,"collectsNode",void 0),s([_(h.default)],v.prototype,"heroAtk",void 0),s([_(cc.Animation)],v.prototype,"heroAtkAni",void 0),v=s([m],v),i.default=v,cc._RF.pop()},{"../Framework/Management/MgrMain":"MgrMain","./Area":"Area","./Constant":"Constant","./DropCoin":"DropCoin","./Enemy":"Enemy","./Factory":"Factory","./HeroAtk":"HeroAtk","./InGaming":"InGaming","./Need":"Need","./RangeFollowee":"RangeFollowee"}],CharacterHandler:[function(e,t,i){"use strict";cc._RF.push(t,"b39c9FxwOxHD5eHav47Kb3x","CharacterHandler");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const o=e("./CharacterController"),n=e("./Constant"),{ccclass:a,property:r}=cc._decorator;let c=class extends cc.Component{constructor(){super(...arguments),this.background=null,this.centerPoint=null,this.character=null,this.radius=100,this.controller=null,this.isTouching=!1,this.moveDirection=cc.Vec2.ZERO}onLoad(){this.background.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.background.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.background.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.background.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this)}onTouchStart(e){this.isTouching=!0,this.onTouchMove(e),this.controller.collider.__followees.forEach(e=>{e.emit(n.SetSpineAnimation,"run")})}onTouchMove(e){this.isTouching&&(this.background.convertToNodeSpaceAR(e.getLocation(),this.moveDirection),this.moveDirection.magSqr()>this.radius*this.radius&&this.moveDirection.normalizeSelf().mulSelf(this.radius),this.centerPoint.setPosition(this.moveDirection),this.moveDirection.normalizeSelf())}onTouchEnd(){this.isTouching=!1,this.resetCenterPosition(),this.moveDirection.x=0,this.moveDirection.y=0,this.controller.setMoveDirection(this.moveDirection),this.controller.collider.__followees.forEach(e=>{e.emit(n.SetSpineAnimation,"idle")})}update(e){this.isTouching&&this.controller.setMoveDirection(this.moveDirection)}resetCenterPosition(){this.centerPoint.setPosition(cc.Vec2.ZERO_R)}};s([r(cc.Node)],c.prototype,"background",void 0),s([r(cc.Node)],c.prototype,"centerPoint",void 0),s([r(cc.Node)],c.prototype,"character",void 0),s([r({type:cc.Float,min:0})],c.prototype,"radius",void 0),s([r(o.default)],c.prototype,"controller",void 0),c=s([a],c),i.default=c,cc._RF.pop()},{"./CharacterController":"CharacterController","./Constant":"Constant"}],CineCamera2d:[function(e,t,i){"use strict";cc._RF.push(t,"5da1cb5BsROLrsSspo5d5Q6","CineCamera2d");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0}),i.CutPointInfoSet=i.CutPointInfoPositionValue=i.CineMode=void 0;const{ccclass:o,property:n,executeInEditMode:a,menu:r}=cc._decorator;var c;(function(e){e[e.Idle=0]="Idle",e[e.FollowAlways=1]="FollowAlways",e[e.Tracks=2]="Tracks"})(c=i.CineMode||(i.CineMode={}));let l=class{constructor(){this.InUse=!0,this.Position=cc.v3(),this.ZoomRatio=1}};s([n(cc.Boolean)],l.prototype,"InUse",void 0),s([n(cc.Vec3)],l.prototype,"Position",void 0),s([n(cc.Float)],l.prototype,"ZoomRatio",void 0),l=s([o("CutPointInfoPositionValue")],l),i.CutPointInfoPositionValue=l;let h=class{constructor(){this.Index=0,this.TimeForMoving=.5,this.Category=[]}};s([n(cc.Integer)],h.prototype,"Index",void 0),s([n(cc.Float)],h.prototype,"TimeForMoving",void 0),s([n([l])],h.prototype,"Category",void 0),h=s([o("CutPointInfoSet")],h),i.CutPointInfoSet=h;let d=class extends cc.Component{constructor(){super(...arguments),this.mode=c.Idle,this.NodToFollow=null,this.PointAxis=null,this.effectCameras=[],this._orderPointsByAsc=!0,this.Points=[],this._tweenState={now:0,end:1},this._stateMoving=!1,this._temPos=cc.v2()}get OrderPointsByAsc(){return this._orderPointsByAsc}set OrderPointsByAsc(e){this._orderPointsByAsc=e,this._orderPointsByIndexAsc(this._orderPointsByAsc)}start(){}update(e){switch(this.mode){case c.Idle:break;case c.FollowAlways:this._checkFollowNode();break;case c.Tracks:}}_orderPointsByIndexAsc(e){e?this.Points.sort((e,t)=>e.Index-t.Index):this.Points.sort((e,t)=>t.Index-e.Index)}MoveViewerByIndex(e,t,i){if(this.Points.length<e||this.Points[e].Category.length<t||!this.Points[e].Category[t].InUse)return;if(this.mode=c.Tracks,i)return cc.Tween.stopAllByTarget(this._tweenState),this.effectCameras.forEach(i=>{i.node.setPosition(this.Points[e].Category[t].Position.add(cc.v3(this.PointAxis.getPosition()))),i.zoomRatio=this.Points[e].Category[t].ZoomRatio}),void(this._stateMoving=!1);if(this._stateMoving)return;this._stateMoving=!0,this._tweenState.end=1;let s=[],o=[];this.effectCameras.forEach(e=>{s.push(e.node.getPosition()),o.push(e.zoomRatio)}),cc.tween(this._tweenState).to(this.Points[e].TimeForMoving,{now:this._tweenState.end},{progress:(i,n,a,r)=>(this.effectCameras.forEach((i,n)=>{i.node.setPosition(cc.Vec3.lerp(cc.v3(),s[n],this.Points[e].Category[t].Position.add(cc.v3(this.PointAxis.getPosition())),r)),i.zoomRatio=cc.misc.lerp(o[n],this.Points[e].Category[t].ZoomRatio,r)}),cc.misc.lerp(i,n,r))}).call(()=>{this._stateMoving=!1}).start()}_checkFollowNode(){null!=this.NodToFollow&&this.mode==c.FollowAlways&&(this._temPos=this.NodToFollow.convertToWorldSpaceAR(cc.v2()),this.effectCameras.forEach(e=>{e.node.getPosition().equals(this._temPos)||e.node.setPosition(this._temPos)}))}};s([n({type:cc.Enum(c)})],d.prototype,"mode",void 0),s([n({type:cc.Node,visible(){return this.mode==c.FollowAlways}})],d.prototype,"NodToFollow",void 0),s([n({type:cc.Node,visible(){return this.mode==c.Tracks}})],d.prototype,"PointAxis",void 0),s([n({type:[cc.Camera]})],d.prototype,"effectCameras",void 0),s([n],d.prototype,"_orderPointsByAsc",void 0),s([n({visible(){return this.mode==c.Tracks}})],d.prototype,"OrderPointsByAsc",null),s([n({type:[h],visible(){return this.mode==c.Tracks}})],d.prototype,"Points",void 0),d=s([o,r("Creatives/CineCamera/2d"),a],d),i.default=d,cc._RF.pop()},{}],CineCamera:[function(e,t,i){"use strict";cc._RF.push(t,"c8e19Rn4rtKXLSxH4s7GTQ2","CineCamera");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const o=e("../../Management/MgrMain"),{ccclass:n,property:a}=cc._decorator;let r=class extends cc.Component{constructor(){super(...arguments),this.NodFollower=null,this.NodLookAt=null,this._temPos=cc.v2()}start(){o.default.Instance.RegisterCinecameras(this)}update(e){this._checkFollowNode()}_checkFollowNode(){null!=this.NodFollower&&(null!=this.NodFollower.parent?this._temPos=this.NodFollower.parent.convertToWorldSpaceAR(this.NodFollower.getPosition()):this._temPos=this.NodFollower.getPosition(),null!=this.node.parent&&(this._temPos=this.node.parent.convertToNodeSpaceAR(this._temPos)),this.node.getPosition().equals(this._temPos)||this.node.setPosition(this._temPos))}};s([a({type:cc.Node,displayName:"Follow Node"})],r.prototype,"NodFollower",void 0),s([a({type:cc.Node,displayName:"Look At"})],r.prototype,"NodLookAt",void 0),r=s([n],r),i.default=r,cc._RF.pop()},{"../../Management/MgrMain":"MgrMain"}],CircleGradient:[function(e,t,i){"use strict";cc._RF.push(t,"15eb8/g1cdHPazsK6+Y7zoK","CircleGradient");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const{ccclass:o,property:n}=cc._decorator;let a=class extends cc.Component{constructor(){super(...arguments),this.radius=cc.v2(0,0),this._mat=null}onLoad(){this._mat=this.node.getComponent(cc.Sprite).getMaterial(0)}start(){this.updateRadius()}updateRadius(e,t,i=.5){e?this.radius.set(e):(this.radius.x=0,this.radius.y=2),t||(t=cc.v2(0,0)),cc.tween(this.radius).to(i,{x:t.x,y:t.y},{onUpdate:e=>{this._mat.setProperty("radius",e)}}).start()}};s([n],a.prototype,"radius",void 0),a=s([o],a),i.default=a,cc._RF.pop()},{}],CollectItem:[function(e,t,i){"use strict";cc._RF.push(t,"0f0a4rkRRxFzL8avdkT6VPj","CollectItem");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const o=e("../Framework/Management/MgrMain"),n=e("./Constant"),{ccclass:a,property:r}=cc._decorator;let c=class extends cc.Component{constructor(){super(...arguments),this.resType=n.ResourceType.Wood,this.resStatus=n.ResourceStatus.Able,this._mat=null,this._matVals={progress:0},this._isTweening=!1}onLoad(){}start(){}onEnable(){this.resStatus=n.ResourceStatus.Able,this.node.opacity=255,cc.isValid(this._mat)&&this.onHit(0)}onHit(e=0){this._isTweening||(this._isTweening=!0,cc.tween(this._matVals).to(.2,{progress:n.HitFlashAniDura},{onUpdate:e=>{this._mat.setProperty("progress",e.progress,0)}}).to(.2,{progress:0},{onUpdate:e=>{this._mat.setProperty("progress",e.progress,0)}}).call(()=>this._isTweening=!1).start(),e>0&&(o.default.Instance.MgrAudio.forcePlayMusic(9),cc.tween(this.node).delay(.2).to(.2,{opacity:0}).call(()=>this.node.active=!1).start(),this.resStatus=n.ResourceStatus.Disable))}};s([r({type:cc.Enum(n.ResourceType)})],c.prototype,"resType",void 0),c=s([a],c),i.default=c,cc._RF.pop()},{"../Framework/Management/MgrMain":"MgrMain","./Constant":"Constant"}],Constant:[function(e,t,i){"use strict";cc._RF.push(t,"57c85FmwDBAlL4JIZ3UX4NC","Constant"),Object.defineProperty(i,"__esModule",{value:!0}),i.SetSpineAnimation=i.FarmerFollow=i.SetEnemyDead=i.StopActionsCall=i.StartInitCall=i.AutoHyperLink=i.MaxWorkerCollectCount=i.MaxFactoryCount=i.MaxCampCount=i.ResourceFillSpan=i.ResourceRefreshSpan=i.MaxFieldEnemy=i.FieldEnemyInitNearRange=i.FieldEnemyInitSpan=i.MaxFieldFarmer=i.FieldFarmerInitSpan=i.FlyToAniDura=i.DropAniDura=i.HitFlashAniDura=i.AlleyMaxHp=i.FenceLockHp=i.FenceMaxHp=i.BossMaxHp=i.EnemyAtkAniDelay=i.WorkerAtkAniDelay=i.SwordsmanAtkAniDelay=i.ArcherAtkAniDelay=i.HeroAtkAniDelay=i.BossAtkSpan=i.EnemyAtkSpan=i.WorkerCollectRange=i.SwordsmanAtkRange=i.SwordsmanAtkSearchRange=i.ArcherAtkRange=i.SwordsmanAtkSpan=i.ArcherAtkSpan=i.HeroAtkSpan=i.AtkArrowLifeTime=i.AtkArrowSpeed=i.BossMoveSpeed=i.EnemyMoveSpeed=i.SwordsmanMoveSpeed=i.AlleyMoveSpeed=i.HeroMoveSpeed=i.GuideNeeds=i.AreaType=i.ResourceStatus=i.ResourceType=i.Prefabs=i.PhysicsTags=void 0,i.JianTaMaxLevel=i.AlleyTrainTime=i.NeedFarmerFillSpan=i.FenceRepairTime=i.FenceBuildTime=i.ChangeBuildMaxLevel=i.ChangeEnemyInitRatio=void 0,function(e){e[e.Fence=0]="Fence",e[e.Door=1]="Door",e[e.Hero=2]="Hero",e[e.Alley=3]="Alley",e[e.Enemy=4]="Enemy",e[e.Wood=5]="Wood",e[e.Stone=6]="Stone",e[e.JianTa=7]="JianTa",e[e.Area=8]="Area",e[e.Camp=9]="Camp",e[e.FactoryWood=10]="FactoryWood",e[e.FactoryStone=11]="FactoryStone"}(i.PhysicsTags||(i.PhysicsTags={})),function(e){e[e.Archer=0]="Archer",e[e.Swordsman=1]="Swordsman",e[e.AtkArrow=2]="AtkArrow",e[e.DropCoin=3]="DropCoin",e[e.DropWood=4]="DropWood",e[e.DropStone=5]="DropStone",e[e.WorkerWood=6]="WorkerWood",e[e.WorkerStone=7]="WorkerStone",e[e.HpBar=8]="HpBar",e[e.WorkerRepair=9]="WorkerRepair",e[e.ArcherFarmer=10]="ArcherFarmer"}(i.Prefabs||(i.Prefabs={})),function(e){e[e.Coin=0]="Coin",e[e.Wood=1]="Wood",e[e.Stone=2]="Stone",e[e.Farmer=3]="Farmer"}(i.ResourceType||(i.ResourceType={})),function(e){e[e.Able=0]="Able",e[e.Disable=1]="Disable",e[e.Targeted=2]="Targeted"}(i.ResourceStatus||(i.ResourceStatus={})),function(e){e[e.Camp=0]="Camp",e[e.Out=99]="Out"}(i.AreaType||(i.AreaType={})),function(e){e[e.Build_Base1=0]="Build_Base1",e[e.Farmer_Jianta_0=1]="Farmer_Jianta_0",e[e.Farmer_Jianta_1=2]="Farmer_Jianta_1",e[e.ExpandArea_0=3]="ExpandArea_0",e[e.BuildFactory_0=4]="BuildFactory_0",e[e.ExpandArea_1=5]="ExpandArea_1",e[e.BuildFactory_1=6]="BuildFactory_1",e[e.Build_Base2_0=7]="Build_Base2_0",e[e.Build_Base2_1=8]="Build_Base2_1",e[e.Build_Camp_0=9]="Build_Camp_0",e[e.Build_Camp_1=10]="Build_Camp_1",e[e.Farmer_Base=11]="Farmer_Base"}(i.GuideNeeds||(i.GuideNeeds={})),i.HeroMoveSpeed=300,i.AlleyMoveSpeed=350,i.SwordsmanMoveSpeed=300,i.EnemyMoveSpeed=150,i.BossMoveSpeed=150,i.AtkArrowSpeed=600,i.AtkArrowLifeTime=1,i.HeroAtkSpan=.5,i.ArcherAtkSpan=1,i.SwordsmanAtkSpan=2,i.ArcherAtkRange=600,i.SwordsmanAtkSearchRange=50,i.SwordsmanAtkRange=60,i.WorkerCollectRange=50,i.EnemyAtkSpan=1.2,i.BossAtkSpan=1.2,i.HeroAtkAniDelay=.2,i.ArcherAtkAniDelay=.5,i.SwordsmanAtkAniDelay=.5,i.WorkerAtkAniDelay=.2,i.EnemyAtkAniDelay=.5,i.BossMaxHp=500,i.FenceMaxHp=100,i.FenceLockHp=60,i.AlleyMaxHp=15,i.HitFlashAniDura=.8,i.DropAniDura=.5,i.FlyToAniDura=.5,i.FieldFarmerInitSpan=15,i.MaxFieldFarmer=10,i.FieldEnemyInitSpan=2,i.FieldEnemyInitNearRange=1200,i.MaxFieldEnemy=30,i.ResourceRefreshSpan=6,i.ResourceFillSpan=.02,i.MaxCampCount=3,i.MaxFactoryCount=3,i.MaxWorkerCollectCount=5,i.AutoHyperLink=210,i.StartInitCall="StartInit",i.StopActionsCall="StopActions",i.SetEnemyDead="SetEnemyDead",i.FarmerFollow="FarmerFollow",i.SetSpineAnimation="SetSpineAnimation",i.ChangeEnemyInitRatio="ChangeEnemyInitRatio",i.ChangeBuildMaxLevel="ChangeBuildMaxLevel",i.FenceBuildTime=2,i.FenceRepairTime=1,i.NeedFarmerFillSpan=.7,i.AlleyTrainTime=5,i.JianTaMaxLevel=1,cc._RF.pop()},{}],CyclePic:[function(e,t,i){"use strict";cc._RF.push(t,"66ebcCdn4VH+JPsE0TdTv49","CyclePic");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const{ccclass:o,property:n}=cc._decorator;let a=class extends cc.Component{constructor(){super(...arguments),this._direction=cc.v2(1,0),this._speed=1,this._moveVec=cc.v2(),this._offset=cc.v2(),this._mat=null}get direction(){return this._direction}set direction(e){e.normalize(this._direction)}get speed(){return this._speed}set speed(e){this._speed=e}onLoad(){this._mat=this.node.getComponent(cc.Sprite).getMaterial(0)}onEnable(){this._calcMoveVec()}start(){}update(e){this._offset.addSelf(this._moveVec),this._mat.setProperty("offset",this._offset)}_calcMoveVec(){this._moveVec.x=this._direction.x*this.speed/cc.game.getFrameRate(),this._moveVec.y=this._direction.y*this.speed/cc.game.getFrameRate()}};s([n],a.prototype,"_direction",void 0),s([n],a.prototype,"direction",null),s([n],a.prototype,"_speed",void 0),s([n],a.prototype,"speed",null),a=s([o],a),i.default=a,cc._RF.pop()},{}],DoorTrigger:[function(e,t,i){"use strict";cc._RF.push(t,"0b875pyBS5AIJVR8zqe6XYA","DoorTrigger");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const o=e("./Constant"),{ccclass:n,property:a}=cc._decorator;let r=class extends cc.Component{constructor(){super(...arguments),this._spine=null,this._openCount=0,this._isClosed=!0}onLoad(){this._spine=this.node.getComponent(sp.Skeleton)}start(){}onCollisionEnter(e,t){this._isClosed&&(this._isClosed=!1,this._spine.setAnimation(0,"01_kai",!1)),e.tag!=o.PhysicsTags.Hero&&e.tag!=o.PhysicsTags.Alley||this._openCount++}onCollisionExit(e,t){this._isClosed&&this._spine.setAnimation(0,"01_kai",!1),e.tag!=o.PhysicsTags.Hero&&e.tag!=o.PhysicsTags.Alley||(this._openCount--,0==this._openCount&&(this._isClosed=!0,this._spine.setAnimation(0,"01_guan",!1)))}};r=s([n],r),i.default=r,cc._RF.pop()},{"./Constant":"Constant"}],Door:[function(e,t,i){"use strict";cc._RF.push(t,"e49dczhFjpLjq/jxuDTzezS","Door");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const o=e("./Fence"),{ccclass:n,property:a}=cc._decorator;let r=class extends o.default{onLoad(){this._mat=this.node.getChildByName("trigger").getComponent(sp.Skeleton).getMaterial(0),this._mat.setProperty("progress",this._matVals.progress,0),this.hp=this.maxHp,this.node.opacity=120,this.hpBarSpr.fillRange=0,this.hpNode.scaleX*=1==this.node.scaleX?1:-1}};r=s([n],r),i.default=r,cc._RF.pop()},{"./Fence":"Fence"}],DropCoin:[function(e,t,i){"use strict";cc._RF.push(t,"e8f13OqfYBAML/kxc2n3YjC","DropCoin");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const o=e("../Framework/Management/MgrMain"),n=e("../Framework/utils/utils"),a=e("./Constant"),{ccclass:r,property:c}=cc._decorator;let l=class extends cc.Component{constructor(){super(...arguments),this.dropDis=cc.v2(10,-30),this._tmpVec2s=[cc.v2(),cc.v2(),cc.v2()]}onLoad(){}start(){}onDrop(e,t){e=null==e?Math.random()<.5:e,cc.tween(this.node).parallel(cc.tween().by(a.DropAniDura,{x:e?this.dropDis.x:-this.dropDis.x}),cc.tween().by(a.DropAniDura,{y:this.dropDis.y},{easing:"bounceOut"})).call(()=>{t&&t()}).start()}onFlyTo(e,t){o.default.Instance.MgrAudio.forcePlayMusic(4),e.convertToWorldSpaceAR(cc.Vec2.ZERO_R,this._tmpVec2s[0]),this.node.parent.convertToNodeSpaceAR(this._tmpVec2s[0],this._tmpVec2s[1]),this.node.getPosition(this._tmpVec2s[0]);const i=this._tmpVec2s[1].x<this._tmpVec2s[0].x,s=n.Utils.calculateBezPoint2(this._tmpVec2s[0],this._tmpVec2s[1],i?-50:50,null,i);let r=this.node.scale;cc.tween(this.node).bezierTo(a.FlyToAniDura,s[0],s[1],this._tmpVec2s[1],{easing:"cubicOut"}).to(.1,{scale:1.1*r}).to(.1,{scale:r}).call(()=>{this.node.destroy(),t&&t()}).start()}};l=s([r],l),i.default=l,cc._RF.pop()},{"../Framework/Management/MgrMain":"MgrMain","../Framework/utils/utils":"utils","./Constant":"Constant"}],EaseConfig:[function(e,t,i){"use strict";cc._RF.push(t,"7f132C+kTNEFaXw+OBpVZ9j","EaseConfig"),Object.defineProperty(i,"__esModule",{value:!0}),i.EaseType=i.EaseFunction=void 0;const s=e("../../../utils/algorithm");i.EaseFunction=[s.Algorithm.easeCubicOut,s.Algorithm.easeCubicIn,s.Algorithm.easeCubicInOut,s.Algorithm.easeBounceOut,s.Algorithm.easeBackIn,s.Algorithm.easeBackOut],function(e){e[e.CubicOut=0]="CubicOut",e[e.CubicIn=1]="CubicIn",e[e.CubicInOut=2]="CubicInOut",e[e.BonuceOut=3]="BonuceOut",e[e.BackIn=4]="BackIn",e[e.BackOut=5]="BackOut"}(i.EaseType||(i.EaseType={})),cc._RF.pop()},{"../../../utils/algorithm":"algorithm"}],EnemyInit:[function(e,t,i){"use strict";cc._RF.push(t,"738aa9jqRpFwo73iY3a4L/z","EnemyInit");var s,o=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const n=e("../Framework/utils/utils"),a=e("./Constant"),r=e("./Enemy"),c=e("./InGaming"),{ccclass:l,property:h}=cc._decorator;let d=s=class extends cc.Component{constructor(){super(...arguments),this.farmerPrebs=[],this.bossCollider=null,this.initPoints=null,this._initedIdxs=null,this.initNearRange=a.FieldEnemyInitNearRange,this._initNearRange=0,this.enemys=[],this.initSpan=a.FieldEnemyInitSpan,this.maxEnemyCount=a.MaxFieldEnemy,this._time=0,this._tmpVec2=cc.v2(),this.isStopped=!0}onLoad(){s.Instance=this,this.node.on(a.StartInitCall,()=>{this.initEnemys(),this.isStopped=!1}),this.node.on(a.StopActionsCall,this.onStopActions,this),this.node.on(a.ChangeEnemyInitRatio,e=>{this.initSpan=a.FieldEnemyInitSpan/e,this.maxEnemyCount=a.MaxFieldEnemy*e}),this.initPoints=new Array(this.node.childrenCount),this._initedIdxs=new Array(this.node.childrenCount),this.node.children.forEach((e,t)=>{this.initPoints[t]=e.getPosition(),this._initedIdxs[t]=t}),this._initNearRange=this.initNearRange*this.initNearRange}start(){}update(e){this.isStopped||(this._time+=e,this._time>=this.initSpan&&(this._time=0,this.initEnemys()))}initEnemys(){for(let i=this.enemys.length-1;i>=0;i--)cc.isValid(this.enemys[i])||this.enemys.splice(i,1);let e=this._initedIdxs.slice(),t=this.maxEnemyCount-this.enemys.length;for(;t>0&&!(e.length<=0);){let i=n.Utils.RandomRangeInt(0,e.length);if(this.initPoints[e[i]].sub(c.default.Instance.charPos,this._tmpVec2),this._tmpVec2.magSqr()>this._initNearRange){e.splice(i,1);continue}let s=cc.instantiate(this.farmerPrebs[n.Utils.RandomRangeInt(0,this.farmerPrebs.length)]);s.setPosition(this.initPoints[i]),s.setParent(c.default.Instance.mapNode);let o=s.getComponent(r.default);this.enemys.push(o),e.splice(i,1),t--}}onStopActions(){this.isStopped=!0,this.enemys.forEach(e=>cc.isValid(e)&&e.stopActions())}};d.Instance=null,o([h([cc.Prefab])],d.prototype,"farmerPrebs",void 0),o([h(cc.CircleCollider)],d.prototype,"bossCollider",void 0),o([h(r.default)],d.prototype,"enemys",void 0),d=s=o([l],d),i.default=d,cc._RF.pop()},{"../Framework/utils/utils":"utils","./Constant":"Constant","./Enemy":"Enemy","./InGaming":"InGaming"}],Enemy:[function(e,t,i){"use strict";cc._RF.push(t,"a44f31kbJ9E2J5tKlA0jaUv","Enemy");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const o=e("../Framework/Management/MgrMain"),n=e("./Alley"),a=e("./Constant"),r=e("./DropCoin"),c=e("./Fence"),l=e("./InGaming"),h=e("./JianTa"),{ccclass:d,property:p}=cc._decorator;var u;(function(e){e.Idle="idle",e.Run="run2",e.Atk="attack2",e.Die="die"})(u||(u={}));let m=class extends cc.Component{constructor(){super(...arguments),this.spine=null,this.rigid=null,this.hpNode=null,this.hpBarSpr=null,this.atkAni=null,this._atkAniDelay=a.EnemyAtkAniDelay,this.hittedAni=null,this.maxHp=1,this.hp=0,this.hurt=1,this.moveSpeed=a.EnemyMoveSpeed,this.followRange=50,this._thresRange=0,this.isDead=!1,this.dieAniDura=2,this._burnAniDura=1,this._mat=null,this._matVals={progress:0},this._isTweening=!1,this._isAtking=!1,this._atkSpan=a.EnemyAtkSpan,this._lastSpAni=u.Idle,this._tmpVec2s=[cc.v2(),cc.v2(),cc.v2(),cc.v2()],this.collider=null,this._atkCollider=null,this._onAtk=null}onLoad(){this.collider=this.getComponent(cc.CircleCollider),this._mat=this.spine.getMaterial(0),this._mat.setProperty("progress",this._matVals.progress,0),this._thresRange=.2*this.followRange,this.node.on(a.SetEnemyDead,(e=!0)=>this.isDead=e)}start(){this.rigid.syncPosition(!1),this.hp=this.maxHp,this.onHit(0),this._onAtk=this.onAtk.bind(this)}onDestroy(){cc.Tween.stopAllByTarget(this._matVals)}update(e){if(this._burnAniDura>0)return void(this._burnAniDura-=e);if(this.isDead)return;const t=l.default.Instance.charCtrl;if(this.node.getPosition(this._tmpVec2s[1]),t.curAreaType==a.AreaType.Out||l.default.Instance._stepCount==l.StepStage.BuildBase)l.default.Instance.charPos.sub(this._tmpVec2s[1],this._tmpVec2s[2]),null!=this._atkCollider&&this._atkCollider.node!=t.collider.node&&(this._atkCollider=null),this._tmpVec2s[2].mag()<=this.followRange?this._isAtking||(this._isAtking=!0,this.schedule(this._onAtk,this._atkSpan,cc.macro.REPEAT_FOREVER),this._atkCollider=t.collider,this._tmpVec2s[2].x=0,this._tmpVec2s[2].y=0,this.rigid.linearVelocity=this._tmpVec2s[2]):(this._isAtking&&(this._isAtking=!1,this.unschedule(this._onAtk)),this.setAnimation(u.Run),this.rigid.linearVelocity=this._tmpVec2s[2].normalizeSelf().mulSelf(this.moveSpeed),this.node.scaleX=this._tmpVec2s[2].x<=0?-1:1);else{let e=0,t=99999,i=[].concat(l.default.Instance.jiantaNodes);l.default.Instance.campNodes.forEach(e=>{if(e.activeInHierarchy){let t=[];e.__alleys.forEach(e=>cc.isValid(e)&&t.push(e.node)),i=i.concat(t)}});for(let s=0;s<i.length;s++)if(i[s].activeInHierarchy){i[s].getPosition(this._tmpVec2s[3]),this._tmpVec2s[3].sub(this._tmpVec2s[1],this._tmpVec2s[2]);let o=this._tmpVec2s[2].mag();o<t&&(e=s,t=o)}i[e].getPosition(this._tmpVec2s[3]),this._tmpVec2s[3].sub(this._tmpVec2s[1],this._tmpVec2s[2]),null==this._atkCollider?(this.rigid.linearVelocity=this._tmpVec2s[2].normalizeSelf().mulSelf(this.moveSpeed),this.node.scaleX=this._tmpVec2s[2].x<=0?-1:1,this.setAnimation(u.Run),this._isAtking&&(this._isAtking=!1,this.unschedule(this._onAtk))):this._isAtking||(this._isAtking=!0,this.schedule(this._onAtk,this._atkSpan,cc.macro.REPEAT_FOREVER))}}onBeginContact(e,t,i){i.tag!=a.PhysicsTags.Hero&&i.tag!=a.PhysicsTags.Fence&&i.tag!=a.PhysicsTags.Door||!cc.isValid(i.getComponent(c.default))||null==i.getComponent(c.default)._mat||(this._atkCollider=i),i.tag==a.PhysicsTags.JianTa&&(this._atkCollider=i),i.tag!=a.PhysicsTags.Alley||"Archer"!=i.node.name&&"SwordsMan"!=i.node.name||(this._atkCollider=i)}onEndContact(e,t,i){null!=this._atkCollider&&(i.tag!=a.PhysicsTags.Hero&&i.tag!=a.PhysicsTags.Fence&&i.tag!=a.PhysicsTags.Door||i.node!=this._atkCollider.node||(this._atkCollider=null),i.tag==a.PhysicsTags.JianTa&&i.node==this._atkCollider.node&&(this._atkCollider=null),i.tag==a.PhysicsTags.Alley&&i.node==this._atkCollider.node&&(this._atkCollider=null))}onAtk(){null!=this._atkCollider?(this.scheduleOnce(()=>{null!=this._atkCollider?(o.default.Instance.MgrAudio.forcePlayMusic(5),this.atkAni.play(),this._atkCollider.tag!=a.PhysicsTags.Fence&&this._atkCollider.tag!=a.PhysicsTags.Door||this._atkCollider.getComponent(c.default).onHit(this.hurt),this._atkCollider.tag==a.PhysicsTags.JianTa&&this._atkCollider.getComponent(h.default).onHit(this.hurt),this._atkCollider.tag==a.PhysicsTags.Alley&&this._atkCollider.getComponent(n.default).onHit(this.hurt)):this.unschedule(this._onAtk)},this._atkAniDelay),l.default.Instance.onFlashRed(),this.setAnimation(u.Atk,!1)):this.unschedule(this._onAtk)}onHit(e){if(!this.isDead&&cc.isValid(this._mat)){if(o.default.Instance.MgrAudio.forcePlayMusic(8),this.hp-=e,this.hp<=0){this.hp=0,this.isDead=!0,this.unscheduleAllCallbacks(),this.spine.setAnimation(0,u.Die,!1),this.scheduleOnce(()=>this.node.destroy(),this.dieAniDura),l.default.Instance.resCount[a.ResourceType.Coin]++;const e=l.default.Instance.onGetDropResToNode(a.ResourceType.Coin);let t=cc.instantiate(o.default.Instance.MgrRcs.prefabs[a.Prefabs.DropCoin]),i=l.default.Instance.charCtrl.collectsNode.children[a.ResourceType.Coin];this.node.getPosition(this._tmpVec2s[0]),t.setPosition(this._tmpVec2s[0]),t.setParent(l.default.Instance.mapNode),t.scale=i.scale;let s=t.getComponent(r.default);o.default.Instance.MgrAudio.forcePlayMusic(3),s.onDrop(null,()=>{t.convertToWorldSpaceAR(cc.Vec2.ZERO_R,this._tmpVec2s[0]),i.convertToNodeSpaceAR(this._tmpVec2s[0],this._tmpVec2s[1]),t.setPosition(this._tmpVec2s[1]),t.setParent(i),t.scale=1,s.onFlyTo(e,()=>{l.default.Instance.updateResFlag=!0})})}this._isTweening||(this._isTweening=!0,e>0&&this.hittedAni.play(),cc.tween(this._matVals).to(.2,{progress:a.HitFlashAniDura},{onUpdate:e=>{this._mat.setProperty("progress",e.progress,0)}}).to(.2,{progress:0},{onUpdate:e=>{this._mat.setProperty("progress",e.progress,0)}}).call(()=>this._isTweening=!1).start(),e>0&&cc.isValid(this.hpNode)&&!this.hpNode.active&&(this.hpNode.active=!0),cc.isValid(this.hpBarSpr)&&(this.hpBarSpr.fillRange=this.hp/this.maxHp))}}setAnimation(e,t=!0){t&&e==this._lastSpAni||(this.spine.setAnimation(0,e,t),this._lastSpAni=e,e==u.Idle&&(this._tmpVec2s[2].x=0,this._tmpVec2s[2].y=0,this.rigid.linearVelocity=this._tmpVec2s[2]))}stopActions(){this.isDead=!0,this.rigid.linearVelocity=cc.Vec2.ZERO_R,this.unscheduleAllCallbacks()}};s([p(sp.Skeleton)],m.prototype,"spine",void 0),s([p(cc.RigidBody)],m.prototype,"rigid",void 0),s([p(cc.Node)],m.prototype,"hpNode",void 0),s([p(cc.Sprite)],m.prototype,"hpBarSpr",void 0),s([p(cc.Animation)],m.prototype,"atkAni",void 0),s([p(cc.Animation)],m.prototype,"hittedAni",void 0),m=s([d],m),i.default=m,cc._RF.pop()},{"../Framework/Management/MgrMain":"MgrMain","./Alley":"Alley","./Constant":"Constant","./DropCoin":"DropCoin","./Fence":"Fence","./InGaming":"InGaming","./JianTa":"JianTa"}],FactoryBase:[function(e,t,i){"use strict";cc._RF.push(t,"ad4dbZyuUNCXIrRQI5StwkQ","FactoryBase");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const o=e("./Factory"),{ccclass:n,property:a}=cc._decorator;let r=class extends o.default{onLoad(){super.onLoad()}start(){}};r=s([n],r),i.default=r,cc._RF.pop()},{"./Factory":"Factory"}],Factory:[function(e,t,i){"use strict";cc._RF.push(t,"39ba6PFZdBDxq2Fvqr3Wxwc","Factory");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const o=e("../Framework/Management/MgrMain"),n=e("./Alley"),a=e("./Constant"),r=e("./InGaming"),c=e("./Need"),l=e("./NeedFarmer"),{ccclass:h,property:d}=cc._decorator;let p=class extends cc.Component{constructor(){super(...arguments),this.alleyType=a.Prefabs.WorkerWood,this.resType=a.ResourceType.Wood,this.toLvNeeds=[],this.needFarmer=null,this.initNode=null,this.resNode=null,this.upgradeAni=null,this.level=0,this.maxLevel=a.JianTaMaxLevel,this.alleys=[],this.alleyCount=0,this.maxAlleyCount=a.MaxFactoryCount,this.resCount=0,this._showResCount=0,this._tmpVec2s=[cc.v2(),cc.v2(),cc.v2()]}onLoad(){this.initNode=this.node.getChildByName("init"),this.resNode=this.node.getChildByName("res"),this._showResCount=this.resNode.childrenCount,this.resNode.children.forEach(e=>e.active=!1),this.upgradeAni=this.node.getComponentInChildren(cc.Animation),o.default.Instance.MgrAudio.forcePlayMusic(10),this.needFarmer.node.active=!0,this.node.__alleyCount=this.alleyCount,this.node.on(a.ChangeBuildMaxLevel,e=>{this.maxLevel=e,this.level<this.maxLevel&&(this.toLvNeeds[this.level-1].node.active=!0)})}start(){this.onEnter()}onUpgrade(){var e;o.default.Instance.MgrAudio.forcePlayMusic(10),this.level>0&&this.level,this.level++,null===(e=this.upgradeAni)||void 0===e||e.play()}onEnter(){if(this.alleyCount<this.maxAlleyCount){this.alleyCount++,this.node.__alleyCount=this.alleyCount;let e=cc.instantiate(o.default.Instance.MgrRcs.prefabs[this.alleyType]);this.initNode.convertToWorldSpaceAR(cc.Vec2.ZERO_R,this._tmpVec2s[0]),r.default.Instance.mapNode.convertToNodeSpaceAR(this._tmpVec2s[0],this._tmpVec2s[1]),e.setPosition(this._tmpVec2s[1]),e.setParent(r.default.Instance.mapNode);let t=this.initNode.children[0],i=e.getComponent(n.default);i.onMoveDestination(t),this.alleys.push(i),this.alleyCount>=this.maxAlleyCount&&(this.needFarmer.node.active=!1)}}onAddResource(){this.resCount<this._showResCount&&(this.resNode.children[this.resCount].active=!0),this.resCount++}onDecResource(){this.resCount--,this.resCount<this._showResCount&&(this.resNode.children[this.resCount].active=!1)}onGetDropResToNode(e){let t=this._showResCount;return this.resNode.children[this.resCount>=t?t-1:this.resCount]}onToFactoryAndEnter(){if(this.alleyCount>=this.maxAlleyCount)return;let e=r.default.Instance.charCtrl.onShiftFollowee();if(!cc.isValid(e))return;e.getPosition(this._tmpVec2s[0]),this.needFarmer.node.getPosition(this._tmpVec2s[1]),this._tmpVec2s[1].sub(this._tmpVec2s[0],this._tmpVec2s[2]);let t=this._tmpVec2s[2].x>=0?1:-1;e.getComponent(n.default).setAnimation(n.AlleySpAnis.Run),cc.tween(e).call(()=>e.scaleX=t).to(this._tmpVec2s[2].mag()/a.AlleyMoveSpeed,{x:this._tmpVec2s[1].x,y:this._tmpVec2s[1].y}).call(()=>{this.onEnter(),e.destroy()}).start()}};s([d({type:cc.Enum(a.Prefabs)})],p.prototype,"alleyType",void 0),s([d({type:cc.Enum(a.ResourceType)})],p.prototype,"resType",void 0),s([d([c.default])],p.prototype,"toLvNeeds",void 0),s([d(l.default)],p.prototype,"needFarmer",void 0),p=s([h],p),i.default=p,cc._RF.pop()},{"../Framework/Management/MgrMain":"MgrMain","./Alley":"Alley","./Constant":"Constant","./InGaming":"InGaming","./Need":"Need","./NeedFarmer":"NeedFarmer"}],FarmerInit:[function(e,t,i){"use strict";cc._RF.push(t,"ab9b37TYyNMA4UX0E00VLvg","FarmerInit");var s,o=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const n=e("../Framework/utils/utils"),a=e("./Constant"),r=e("./Farmer"),{ccclass:c,property:l}=cc._decorator;let h=s=class extends cc.Component{constructor(){super(...arguments),this.mapNode=null,this.farmerPrebs=[],this.initPoints=null,this._initedIdxs=null,this.farmers=[],this.initSpan=a.FieldFarmerInitSpan,this._time=0,this.isStopped=!0}onLoad(){s.Instance=this,this.node.on(a.StartInitCall,()=>{this.initFarmers(),this.isStopped=!1}),this.node.on(a.StopActionsCall,this.onStopActions,this),this.node.__farmers=this.farmers,this.initPoints=new Array(this.node.childrenCount),this._initedIdxs=new Array(this.node.childrenCount),this.node.children.forEach((e,t)=>{this.initPoints[t]=e.getPosition(),this._initedIdxs[t]=0})}start(){}update(e){this.isStopped||(this._time+=e,this._time>=this.initSpan&&(this._time=0,this.initFarmers()))}initFarmers(){for(let t=this.farmers.length-1;t>=0;t--)cc.isValid(this.farmers[t])&&!this.farmers[t].isFollowing||(this._initedIdxs[this.farmers[t].initPosIdx]=0,this.farmers.splice(t,1));let e=a.MaxFieldFarmer-this.farmers.length;for(;e>0;){let t=n.Utils.RandomRangeInt(0,this.initPoints.length);if(1==this._initedIdxs[t])continue;this._initedIdxs[t]=1;let i=cc.instantiate(this.farmerPrebs[n.Utils.RandomRangeInt(0,this.farmerPrebs.length)]);i.setPosition(this.initPoints[t]),i.setParent(this.mapNode);let s=i.getComponent(r.default);s.initPosIdx=t,this.farmers.push(s),e--}}onStopActions(){this.isStopped=!0,this.farmers.forEach(e=>cc.isValid(e)&&e.stopActions())}};h.Instance=null,o([l(cc.Node)],h.prototype,"mapNode",void 0),o([l([cc.Prefab])],h.prototype,"farmerPrebs",void 0),o([l(r.default)],h.prototype,"farmers",void 0),h=s=o([c],h),i.default=h,cc._RF.pop()},{"../Framework/utils/utils":"utils","./Constant":"Constant","./Farmer":"Farmer"}],Farmer:[function(e,t,i){"use strict";cc._RF.push(t,"1849alLKKdKhLb7QQwr7zXY","Farmer");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const o=e("./Alley"),n=e("./Constant"),a=e("./RangeFollowee"),{ccclass:r,property:c}=cc._decorator;let l=class extends o.default{constructor(){super(...arguments),this.rangeFol=null,this.isFollowing=!1,this.initPosIdx=-1,this._mat=null,this._matVals={progress:0}}onLoad(){super.onLoad(),this.rangeFol.moveSpeed=this.moveSpeed}start(){super.start(),this._mat=this.spine.getMaterial(0),this._mat.setProperty("progress",this._matVals.progress,0),cc.tween(this._matVals).to(.2,{progress:n.HitFlashAniDura},{onUpdate:e=>{this._mat.setProperty("progress",e.progress,0)}}).to(.2,{progress:0},{onUpdate:e=>{this._mat.setProperty("progress",e.progress,0)}}).start()}onCollisionEnter(e,t){if(e.tag==n.PhysicsTags.Hero&&!this.isFollowing){this.isFollowing=!0;let t=this.node.getChildByName("bubble");cc.tween(t).to(.3,{scale:0},{easing:"cubicOut"}).call(()=>t.active=!1).start();const i=e.__followees;this.rangeFol.follower=i.length>0?i[i.length-1]:e.node,e.__followees.push(this.node),e.node.emit(n.FarmerFollow),this.rangeFol.setAnimation("run")}}};s([c(a.default)],l.prototype,"rangeFol",void 0),l=s([r],l),i.default=l,cc._RF.pop()},{"./Alley":"Alley","./Constant":"Constant","./RangeFollowee":"RangeFollowee"}],Fence:[function(e,t,i){"use strict";cc._RF.push(t,"460e1VX6HlDbZqUqza7f706","Fence");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const o=e("../Framework/Management/MgrMain"),n=e("./Constant"),{ccclass:a,property:r}=cc._decorator;let c=class extends cc.Component{constructor(){super(...arguments),this.hitMat=null,this.hpNode=null,this.hpBarSpr=null,this.buildPriority=0,this.level=0,this.maxHp=n.FenceMaxHp,this.hp=0,this.lockHp=n.FenceLockHp,this._mat=null,this._matVals={progress:0},this._isTweening=!1,this.isBuilding=!1,this.isRepairing=!1}onLoad(){this.hp=this.maxHp,cc.isValid(this.hitMat)&&(this.getComponent(cc.Sprite).setMaterial(0,this.hitMat),this._mat=this.getComponent(cc.Sprite).getMaterial(0),this._mat.setProperty("progress",this._matVals.progress,0),this.node.opacity=120,this.hpBarSpr.fillRange=0,this.hpNode.scaleX*=1==this.node.scaleX?1:-1)}onEnable(){var e;null===(e=this.node.getComponent(cc.RigidBody))||void 0===e||e.syncPosition(!1)}start(){}onDestroy(){cc.Tween.stopAllByTarget(this._matVals),cc.Tween.stopAllByTarget(this.hpBarSpr),cc.Tween.stopAllByTarget(this.hpNode)}onUpgrade(){this.level++,this.node.getComponent(cc.Sprite).spriteFrame=o.default.Instance.MgrRcs.GetImageByName(this.level)}onStartBuild(){this.hpNode.active=!0,this.node.opacity=120,cc.tween(this.hpBarSpr).to(n.FenceBuildTime,{fillRange:1}).call(()=>{this.node.opacity=255,this.isBuilding=!1,cc.tween(this.hpNode).to(.2,{opacity:0},{easing:"cubicOut"}).start(),this.onHit()}).start()}onHit(e=0){cc.isValid(this._mat)&&(e>0&&o.default.Instance.MgrAudio.forcePlayMusic(9),this.isRepairing||(this.hp-=e),this.hp<=this.lockHp&&(this.hp=this.lockHp),cc.isValid(this.hpNode)||(this.hpNode=cc.instantiate(o.default.Instance.MgrRcs.prefabs[n.Prefabs.HpBar]),this.hpBarSpr=this.hpNode.getChildByName("bar").getComponent(cc.Sprite),this.hpNode.scale*=this.node.scale>0?1:-1,this.hpNode.setParent(this.node)),e>0&&(!this.hpNode.active||255!=this.hpNode.opacity)&&(this.hpNode.active=!0,this.hpNode.stopAllActions(),this.hpNode.opacity=255),this.isRepairing||(this.hpBarSpr.fillRange=this.hp/this.maxHp),this._isTweening||(this._isTweening=!0,cc.tween(this._matVals).to(.2,{progress:n.HitFlashAniDura},{onUpdate:e=>{this._mat.setProperty("progress",e.progress,0)}}).to(.2,{progress:0},{onUpdate:e=>{this._mat.setProperty("progress",e.progress,0)}}).call(()=>this._isTweening=!1).start()))}onRepair(){this.isRepairing=!0,this.hp=this.maxHp,cc.tween(this.hpBarSpr).to(n.FenceRepairTime,{fillRange:1}).call(()=>{this.isRepairing=!1,cc.tween(this.hpNode).to(.2,{opacity:0}).start()}).start()}};s([r(cc.Material)],c.prototype,"hitMat",void 0),s([r(cc.Node)],c.prototype,"hpNode",void 0),s([r(cc.Sprite)],c.prototype,"hpBarSpr",void 0),s([r],c.prototype,"buildPriority",void 0),c=s([a],c),i.default=c,cc._RF.pop()},{"../Framework/Management/MgrMain":"MgrMain","./Constant":"Constant"}],FlexEventMessageCtrl:[function(e,t,i){"use strict";cc._RF.push(t,"63ecawMz/lAxqTcV+ID13eM","FlexEventMessageCtrl");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const o=e("./RepeatableBehavior"),{ccclass:n,property:a,menu:r}=cc._decorator;let c=class extends o.default{constructor(){super(...arguments),this.eventNode=null,this.rpType=o.RepeatableBehaviorType.EventMessage}start(){}CheckSubTypeLegal(){return!!this.eventNode}SubAction(){this._living&&this.eventNode&&this._commandInfo.command.length>0&&this.eventNode.emit("invokeCustom",[this._commandInfo.command])}};s([a(cc.Node)],c.prototype,"eventNode",void 0),c=s([n,r("Creatives/Logics/FlexEventMessageCtrl")],c),i.default=c,cc._RF.pop()},{"./RepeatableBehavior":"RepeatableBehavior"}],FloatAbove:[function(e,t,i){"use strict";cc._RF.push(t,"fa9d39N5E5IMp4rQS6UwvZm","FloatAbove");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const{ccclass:o,property:n,menu:a}=cc._decorator;let r=class extends cc.Component{constructor(){super(...arguments),this.level=10}start(){this.ResetLevel(this.level)}ResetLevel(e){this.level=e,this.node.zIndex=this.level}};s([n],r.prototype,"level",void 0),r=s([o,a("Creatives/FloatAbove")],r),i.default=r,cc._RF.pop()},{}],HeroAtk:[function(e,t,i){"use strict";cc._RF.push(t,"7602bS8wLBPqKU28PJSwpon","HeroAtk");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const o=e("./Enemy"),n=e("./EnemyInit"),{ccclass:a,property:r}=cc._decorator;let c=class extends cc.Component{constructor(){super(...arguments),this.collider=null,this.enemyColliders=new Array(16),this._tmpVec2s=[cc.v2(),cc.v2(),cc.v2()]}onLoad(){this.collider=this.getComponent(cc.BoxCollider)}start(){}update(e){let t=0;if(cc.isValid(n.default.Instance.bossCollider)&&n.default.Instance.bossCollider.node.active){const e=n.default.Instance.bossCollider.getComponent(o.default);e.isDead||(e.node.convertToWorldSpaceAR(cc.Vec2.ZERO_R,this._tmpVec2s[0]),cc.Intersection.pointInPolygon(this._tmpVec2s[0],this.collider.world.points)&&(this.enemyColliders[t++]=n.default.Instance.bossCollider))}for(n.default.Instance.enemys.forEach(e=>{e.isDead||(e.node.convertToWorldSpaceAR(cc.Vec2.ZERO_R,this._tmpVec2s[0]),cc.Intersection.pointInPolygon(this._tmpVec2s[0],this.collider.world.points)&&(this.enemyColliders[t++]=e.collider))});t<this.enemyColliders.length;t++)this.enemyColliders[t]=null}};c=s([a],c),i.default=c,cc._RF.pop()},{"./Enemy":"Enemy","./EnemyInit":"EnemyInit"}],I18nLabel:[function(e,t,i){"use strict";cc._RF.push(t,"66559HpFWZLDI1puabYsUoz","I18nLabel");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const o=e("./I18nManager"),{ccclass:n,property:a}=cc._decorator;let r=class extends cc.Component{constructor(){super(...arguments),this.zh_Str="",this.en_Str="",this.ko_Str="",this.ja_Str="",this.ru_Str="",this.ar_Str="",this.onlyLanguage_Str=""}onLoad(){o.default.GetInstance().OnlyLanguage?this.getComponent(cc.Label).string=this.en_Str:(this.SwitchLang(o.default.GetInstance().GetLang()),o.default.GetInstance().RegisterLabel(this))}SwitchLang(e){switch(e){case o.LanguageType.zh:this.getComponent(cc.Label).string=this.zh_Str;break;case o.LanguageType.en:this.getComponent(cc.Label).string=this.en_Str;break;case o.LanguageType.ko:this.getComponent(cc.Label).string=this.ko_Str;break;case o.LanguageType.ja:this.getComponent(cc.Label).string=this.ja_Str;break;case o.LanguageType.ru:this.getComponent(cc.Label).string=this.ru_Str;break;case o.LanguageType.ar:this.getComponent(cc.Label).string=this.ar_Str;break;default:this.getComponent(cc.Label).string=this.en_Str}}};s([a({visible:()=>cc.Canvas.instance.getComponent(o.default).zh&&!cc.Canvas.instance.getComponent(o.default).OnlyLanguage,displayName:"\u4e2d\u6587\u7b80\u4f53 / zh_cn"})],r.prototype,"zh_Str",void 0),s([a({visible:()=>cc.Canvas.instance.getComponent(o.default).en&&!cc.Canvas.instance.getComponent(o.default).OnlyLanguage,displayName:"\u82f1\u8bed / en"})],r.prototype,"en_Str",void 0),s([a({visible:()=>cc.Canvas.instance.getComponent(o.default).ko&&!cc.Canvas.instance.getComponent(o.default).OnlyLanguage,displayName:"\u97e9\u8bed / ko"})],r.prototype,"ko_Str",void 0),s([a({visible:()=>cc.Canvas.instance.getComponent(o.default).ja&&!cc.Canvas.instance.getComponent(o.default).OnlyLanguage,displayName:"\u65e5\u8bed / ja"})],r.prototype,"ja_Str",void 0),s([a({visible:()=>cc.Canvas.instance.getComponent(o.default).ru&&!cc.Canvas.instance.getComponent(o.default).OnlyLanguage,displayName:"\u4fc4\u8bed / ru"})],r.prototype,"ru_Str",void 0),s([a({visible:()=>cc.Canvas.instance.getComponent(o.default).ar&&!cc.Canvas.instance.getComponent(o.default).OnlyLanguage,displayName:"\u963f\u62c9\u4f2f\u8bed / ar"})],r.prototype,"ar_Str",void 0),s([a({visible:()=>cc.Canvas.instance.getComponent(o.default).OnlyLanguage})],r.prototype,"onlyLanguage_Str",void 0),r=s([n],r),i.default=r,cc._RF.pop()},{"./I18nManager":"I18nManager"}],I18nManager:[function(e,t,i){"use strict";cc._RF.push(t,"c667038szpEiYxge8Ov4Y5P","I18nManager");var s,o,n,a=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0}),i.LanguageType=i.LanguageTypeE=void 0,function(e){e[e.default=0]="default",e[e.zh_cn=1]="zh_cn",e[e.zh_tw=2]="zh_tw",e[e.en=3]="en",e[e.ko=4]="ko",e[e.ja=5]="ja",e[e.de=6]="de",e[e.fr=7]="fr",e[e.es=8]="es",e[e.pt=9]="pt",e[e.it=10]="it",e[e.be=11]="be",e[e.uk=12]="uk",e[e.id=13]="id",e[e.ru=14]="ru",e[e.ar=15]="ar",e[e.th=16]="th",e[e.vi=17]="vi",e[e.tr=18]="tr"}(o=i.LanguageTypeE||(i.LanguageTypeE={})),function(e){e.default="\u9ed8\u8ba4",e.zh_cn="\u7b80\u4f53\u4e2d\u6587",e.zh_tw="\u7e41\u4f53\u4e2d\u6587",e.en="\u82f1\u8bed",e.ko="\u97e9\u8bed",e.ja="\u65e5\u8bed",e.de="\u5fb7\u8bed",e.fr="\u6cd5\u8bed",e.es="\u897f\u73ed\u7259\u8bed",e.pt="\u8461\u8404\u7259\u8bed",e.it="\u610f\u5927\u5229\u8bed",e.be="\u767d\u4fc4\u7f57\u65af\u8bed",e.uk="\u4e4c\u514b\u5170\u8bed",e.id="\u5370\u5ea6\u5c3c\u897f\u4e9a\u8bed",e.ru="\u4fc4\u8bed",e.ar="\u963f\u62c9\u4f2f\u8bed",e.th="\u6cf0\u8bed",e.vi="\u8d8a\u5357\u8bed",e.tr="\u571f\u8033\u5176\u8bed"}(n=i.LanguageType||(i.LanguageType={}));const{ccclass:r,property:c,menu:l}=cc._decorator;let h=s=class extends cc.Component{constructor(){super(...arguments),this.trFrame="\u8981\u6302\u5728Canves\u8282\u70b9\u4e0a\uff01\uff01\uff01",this.languageSET=o.en,this.language=n.en,this.zh_cn=!1,this.zh_tw=!1,this.en=!1,this.ko=!1,this.ja=!1,this.de=!1,this.fr=!1,this.es=!1,this.pt=!1,this.it=!1,this.be=!1,this.uk=!1,this.id=!1,this.ru=!1,this.ar=!1,this.th=!1,this.vi=!1,this.tr=!1,this._labelArr=[],this._spriteArr=[],this._callBack=[]}static GetInstance(){return this._instance}onLoad(){s._instance=this;let e=navigator.language;console.warn("\u5f53\u524d\u6d4f\u89c8\u5668\u8bed\u8a00\u8bc6\u522b\u4e3a\uff1a",e);{let e=navigator.language;switch(e=e.split("-")[0]){case"zh":if(this.zh_cn||this.zh_tw)if(this.zh_cn&&this.zh_tw)switch(navigator.language){case"zh-CN":this.language=n.zh_cn;break;default:this.language=n.zh_tw}else this.zh_cn?this.language=n.zh_cn:this.zh_tw&&(this.language=n.zh_tw);break;case"en":this.language=n.en;break;case"ko":this.language=n.ko;break;case"ja":this.language=n.ja;break;case"de":this.language=n.de;break;case"fr":this.language=n.fr;break;case"es":this.language=n.es;break;case"pt":this.language=n.pt;break;case"it":this.language=n.it;break;case"be":this.language=n.be;break;case"uk":this.language=n.uk;break;case"id":this.language=n.id;break;case"ru":this.language=n.ru;break;case"ar":this.language=n.ar;break;case"th":this.language=n.th;break;case"vi":this.language=n.vi;break;case"tr":this.language=n.th;break;default:this.language=n.en}this.SwitchLang(this.language)}}GetLang(){return this.language}RegisterLabel(e){this._labelArr.push(e)}RegisterSprite(e){this._spriteArr.push(e)}RegisterCallback(e){this._callBack.push(e)}SwitchLang(e){e!=this.language&&(this.language=e,this._labelArr.forEach(t=>{t.SwitchLang(e)}),this._spriteArr.forEach(t=>{t.SwitchLang(e)}),this._callBack.forEach(t=>{t(e)}))}};h._instance=null,a([c({visible(){return"Canvas"!=this.node.name&&(cc.error("I18nManager \u8981\u6302\u5728Canves\u8282\u70b9\u4e0a\uff01\uff01\uff01 \u5f53\u524d\u6302\u5728\u8282\u70b9\uff1a"+this.node.parent.name+"/"+this.node.name+" \u5df2\u7ecf\u81ea\u52a8\u79fb\u9664"),this.node.removeComponent(s)),!1},displayName:"\u63d0\u793a",readonly:!0})],h.prototype,"trFrame",void 0),a([c({type:cc.Enum(o),displayName:"\u5f00\u53d1\u6a21\u5f0f\u6d4b\u8bd5\u8bed\u8a00",tooltip:"zh_cn : \u7b80\u4f53\u4e2d\u6587\n zh_tw : \u7e41\u4f53\u4e2d\u6587\n en : \u82f1\u8bed\n ko : \u97e9\u8bed\n ja : \u65e5\u8bed\n de : \u5fb7\u8bed\n fr : \u6cd5\u8bed\n es : \u897f\u73ed\u7259\u8bed\n pt : \u8461\u8404\u7259\u8bed\n it : \u610f\u5927\u5229\u8bed\n be : \u767d\u4fc4\u7f57\u65af\u8bed\n uk : \u4e4c\u514b\u5170\u8bed\n id : \u5370\u5ea6\u5c3c\u897f\u4e9a\u8bed\n ar : \u963f\u62c9\u4f2f\u8bed\n th \uff1a\u6cf0\u8bed\n vi \uff1a\u8d8a\u5357\u8bed\n tr \uff1a\u571f\u8033\u5176\u8bed"})],h.prototype,"languageSET",void 0),a([c({type:cc.Enum(n),displayName:"\u5f53\u524d\u8bed\u8a00",visible:!1})],h.prototype,"language",void 0),a([c({displayName:"\u4e2d\u6587\u7b80\u4f53 / zh_cn"})],h.prototype,"zh_cn",void 0),a([c({displayName:"\u7e41\u4f53\u4e2d\u6587 / zh_tw"})],h.prototype,"zh_tw",void 0),a([c({displayName:"\u82f1\u8bed / en"})],h.prototype,"en",void 0),a([c({displayName:"\u97e9\u8bed / ko"})],h.prototype,"ko",void 0),a([c({displayName:"\u65e5\u8bed / ja"})],h.prototype,"ja",void 0),a([c({displayName:"\u5fb7\u8bed / de"})],h.prototype,"de",void 0),a([c({displayName:"\u6cd5\u8bed / fr"})],h.prototype,"fr",void 0),a([c({displayName:"\u897f\u73ed\u7259\u8bed / es"})],h.prototype,"es",void 0),a([c({displayName:"\u8461\u8404\u7259\u8bed / pt"})],h.prototype,"pt",void 0),a([c({displayName:"\u610f\u5927\u5229\u8bed / it"})],h.prototype,"it",void 0),a([c({displayName:"\u767d\u4fc4\u7f57\u65af\u8bed / be"})],h.prototype,"be",void 0),a([c({displayName:"\u4e4c\u514b\u5170\u8bed / uk"})],h.prototype,"uk",void 0),a([c({displayName:"\u5370\u5ea6\u5c3c\u897f\u4e9a\u8bed / id"})],h.prototype,"id",void 0),a([c({displayName:"\u4fc4\u8bed / ru"})],h.prototype,"ru",void 0),a([c({displayName:"\u963f\u62c9\u4f2f\u8bed / ar"})],h.prototype,"ar",void 0),a([c({displayName:"\u6cf0\u8bed / th"})],h.prototype,"th",void 0),a([c({displayName:"\u8d8a\u5357\u8bed / th"})],h.prototype,"vi",void 0),a([c({displayName:"\u571f\u8033\u5176\u8bed / th"})],h.prototype,"tr",void 0),h=s=a([r,l("\u591a\u8bed\u8a00\u7ec4\u4ef6/\u591a\u8bed\u8a00\u7ba1\u7406\u5668")],h),i.default=h,cc._RF.pop()},{}],I18nSprite:[function(e,t,i){"use strict";cc._RF.push(t,"f58f907EvZIEqid+EMSmwoN","I18nSprite");var s,o=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a},n=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))(function(o,n){function a(e){try{c(s.next(e))}catch(t){n(t)}}function r(e){try{c(s.throw(e))}catch(t){n(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,r)}c((s=s.apply(e,t||[])).next())})};Object.defineProperty(i,"__esModule",{value:!0});const a=e("./I18nManager"),{ccclass:r,property:c,menu:l}=cc._decorator;let h=s=class extends cc.Component{constructor(){super(...arguments),this.zh_cnFrame=null,this.zh_twFrame=null,this.enFrame=null,this.koFrame=null,this.jaFrame=null,this.deFrame=null,this.frFrame=null,this.esFrame=null,this.ptFrame=null,this.itFrame=null,this.beFrame=null,this.ukFrame=null,this.idFrame=null,this.ruFrame=null,this.arFrame=null,this.thFrame=null}get AutoFillLanguageBtn(){return!1}set AutoFillLanguageBtn(e){}onLoad(){this.SwitchLang(a.default.GetInstance().GetLang()),a.default.GetInstance().RegisterSprite(this)}AutoFillLanguage(){cc.log("\u5f00\u59cb\u81ea\u52a8\u5173\u8054\u591a\u8bed\u8a00\u6587\u672c");const e=this.node.getComponent(cc.Sprite);if(!e.spriteFrame)return void cc.warn("\u8be5\u8282\u70b9\u7684 cc.Sprite \u7f3a\u5c11\u76ee\u6807\u56fe\u7247");const t=e.spriteFrame.name,i=e.spriteFrame.getRect();cc.log(`\u76ee\u6807\u56fe\u7247\uff1a${t},\u521d\u59cb\u5bbd\u5ea6\uff1a${i.width},\u521d\u59cb\u9ad8\u5ea6\uff1a${i.height}`);const o=cc.Canvas.instance.getComponent(a.default);if(!o)return void cc.warn("Canvas \u8282\u70b9\u4e0a\u672a\u6302\u8f7d I18nManager \u7ec4\u4ef6");const r=this.node.getComponent(s);if(!r)return void cc.warn("\u8be5\u8282\u70b9\u7f3a\u5c11 I18nSprite \u7ec4\u4ef6");let c=!1;const l=(e,s)=>new Promise((o,n)=>{cc.loader.loadRes(s,cc.SpriteFrame,(s,c)=>{if(s)return void n(s);r[`${e}Frame`]=c;let l=c.getRect();l.width-i.width>50&&cc.warn(`\u591a\u8bed\u8a00\u56fe\u7247 ${t} \u5bbd\u5ea6\u4e0e\u539f\u56fe\u5dee\u8ddd\u8f83\u5927\uff0c\u76ee\u6807\u8bed\u8a00 ${e}: ${a.LanguageType[e]}, \u5bbd\u5ea6\u5dee\u8ddd${l.width-i.width}`),l.height-i.height>50&&cc.warn(`\u591a\u8bed\u8a00\u56fe\u7247 ${t} \u5bbd\u5ea6\u4e0e\u539f\u56fe\u5dee\u8ddd\u8f83\u5927\uff0c\u76ee\u6807\u8bed\u8a00 ${e}: ${a.LanguageType[e]}, \u9ad8\u5ea6\u5dee\u8ddd${l.height-i.height}`),cc.log(`\u6210\u529f\u5173\u8054\u591a\u8bed\u8a00\u56fe\u7247\u6587\u4ef6 ${t} \u76ee\u6807\u8bed\u8a00 ${e}: ${a.LanguageType[e]}`),o()})});(()=>n(this,void 0,void 0,function*(){for(const s in a.LanguageType)if(o[s]){const o=`\u591a\u8bed\u8a00/${a.LanguageType[s]}/${t}`;try{yield l(s,o),a.LanguageType[s]===a.LanguageType.zh_cn&&(e.spriteFrame=r[`${s}Frame`],cc.log(`\u76ee\u6807\u56fe\u7247\u91cd\u7f6e\u5f15\u7528\u4e3a ${a.LanguageType[s]}`))}catch(i){c=!0,cc.error(`\u52a0\u8f7d\u591a\u8bed\u8a00\u56fe\u7247\u5931\u8d25: ${i}`),cc.warn("\u8bf7\u68c0\u67e5 Resource \u6587\u4ef6\u5939\u5185\u662f\u5426\u6709\u5bf9\u5e94\u6587\u4ef6\uff0c\u6216\u8054\u7cfbXJ\u5904\u7406")}}c||cc.log("\u5173\u8054\u5b8c\u6210\u3002\u4fdd\u5b58\u573a\u666f\u540e\uff0c\u5c06 Resources \u6587\u4ef6\u5185\u7684\u591a\u8bed\u8a00\u6587\u4ef6\u5939\u79fb\u52a8\u5230 Texture \u6587\u4ef6\u5939\u5185")}))()}SwitchLang(e){let t=!0,i=this.findAvailableDefaultFrame();if(i)switch(e){case a.LanguageType.zh_cn:t=a.default.GetInstance().zh_cn,this.getComponent(cc.Sprite).spriteFrame=t&&this.zh_cnFrame||i;break;case a.LanguageType.zh_tw:t=a.default.GetInstance().zh_tw,this.getComponent(cc.Sprite).spriteFrame=t&&this.zh_twFrame||i;break;case a.LanguageType.en:t=a.default.GetInstance().en,this.getComponent(cc.Sprite).spriteFrame=t?this.enFrame:i;break;case a.LanguageType.ko:t=a.default.GetInstance().ko,this.getComponent(cc.Sprite).spriteFrame=t&&this.koFrame||i;break;case a.LanguageType.ja:t=a.default.GetInstance().ja,this.getComponent(cc.Sprite).spriteFrame=t&&this.jaFrame||i;break;case a.LanguageType.de:t=a.default.GetInstance().de,this.getComponent(cc.Sprite).spriteFrame=t&&this.deFrame||i;break;case a.LanguageType.fr:t=a.default.GetInstance().fr,this.getComponent(cc.Sprite).spriteFrame=t&&this.frFrame||i;break;case a.LanguageType.es:t=a.default.GetInstance().es,this.getComponent(cc.Sprite).spriteFrame=t&&this.esFrame||i;break;case a.LanguageType.pt:t=a.default.GetInstance().pt,this.getComponent(cc.Sprite).spriteFrame=t&&this.ptFrame||i;break;case a.LanguageType.it:t=a.default.GetInstance().it,this.getComponent(cc.Sprite).spriteFrame=t&&this.itFrame||i;break;case a.LanguageType.be:t=a.default.GetInstance().be,this.getComponent(cc.Sprite).spriteFrame=t&&this.beFrame||i;break;case a.LanguageType.uk:t=a.default.GetInstance().uk,this.getComponent(cc.Sprite).spriteFrame=t&&this.ukFrame||i;break;case a.LanguageType.id:t=a.default.GetInstance().id,this.getComponent(cc.Sprite).spriteFrame=t&&this.idFrame||i;break;case a.LanguageType.ru:t=a.default.GetInstance().ru,this.getComponent(cc.Sprite).spriteFrame=t&&this.ruFrame||i;break;case a.LanguageType.ar:t=a.default.GetInstance().ar,this.getComponent(cc.Sprite).spriteFrame=t&&this.arFrame||i;break;case a.LanguageType.th:t=a.default.GetInstance().th,this.getComponent(cc.Sprite).spriteFrame=t&&this.thFrame||i;break;default:this.getComponent(cc.Sprite).spriteFrame=i}else cc.warn("\u672a\u627e\u5230\u9ed8\u8ba4\u8bed\u8a00\u56fe\u7247\uff0c\u8bf7\u68c0\u67e5\u8d44\u6e90\u6587\u4ef6")}findAvailableDefaultFrame(){const e=a.default.GetInstance(),t={[a.LanguageType.zh_cn]:this.zh_cnFrame,[a.LanguageType.zh_tw]:this.zh_twFrame,[a.LanguageType.en]:this.enFrame,[a.LanguageType.ko]:this.koFrame,[a.LanguageType.ja]:this.jaFrame,[a.LanguageType.de]:this.deFrame,[a.LanguageType.fr]:this.frFrame,[a.LanguageType.es]:this.esFrame,[a.LanguageType.pt]:this.ptFrame,[a.LanguageType.it]:this.itFrame,[a.LanguageType.be]:this.beFrame,[a.LanguageType.uk]:this.ukFrame,[a.LanguageType.id]:this.idFrame,[a.LanguageType.ru]:this.ruFrame,[a.LanguageType.ar]:this.arFrame,[a.LanguageType.th]:this.thFrame};for(const i in a.LanguageType)if(isNaN(Number(i))){const s=a.LanguageType[i],o=e[i],n=t[s];if(o&&n)return n}return null}};o([c({displayName:"\u81ea\u52a8\u586b\u5165\u591a\u8bed\u8a00\u6309\u94ae",tooltip:"\u70b9\u51fb\u53ef\u4ee5\u81ea\u52a8\u6839\u636e\u5bf9\u5e94\u56fe\u7247\u540d\u5b57\u5173\u8054\u591a\u8bed\u8a00\u56fe\u7247"})],h.prototype,"AutoFillLanguageBtn",null),o([c({type:cc.SpriteFrame,visible:()=>cc.Canvas.instance.getComponent(a.default).zh_cn,displayName:"\u4e2d\u6587\u7b80\u4f53 / zh_cn"})],h.prototype,"zh_cnFrame",void 0),o([c({type:cc.SpriteFrame,visible:()=>cc.Canvas.instance.getComponent(a.default).zh_tw,displayName:"\u7e41\u4f53\u4e2d\u6587 / zh_tw"})],h.prototype,"zh_twFrame",void 0),o([c({type:cc.SpriteFrame,visible:()=>cc.Canvas.instance.getComponent(a.default).en,displayName:"\u82f1\u8bed / en"})],h.prototype,"enFrame",void 0),o([c({type:cc.SpriteFrame,visible:()=>cc.Canvas.instance.getComponent(a.default).ko,displayName:"\u97e9\u8bed / ko"})],h.prototype,"koFrame",void 0),o([c({type:cc.SpriteFrame,visible:()=>cc.Canvas.instance.getComponent(a.default).ja,displayName:"\u65e5\u8bed / ja"})],h.prototype,"jaFrame",void 0),o([c({type:cc.SpriteFrame,visible:()=>cc.Canvas.instance.getComponent(a.default).de,displayName:"\u5fb7\u8bed / de"})],h.prototype,"deFrame",void 0),o([c({type:cc.SpriteFrame,visible:()=>cc.Canvas.instance.getComponent(a.default).fr,displayName:"\u6cd5\u8bed / fr"})],h.prototype,"frFrame",void 0),o([c({type:cc.SpriteFrame,visible:()=>cc.Canvas.instance.getComponent(a.default).es,displayName:"\u897f\u73ed\u7259\u8bed / es"})],h.prototype,"esFrame",void 0),o([c({type:cc.SpriteFrame,visible:()=>cc.Canvas.instance.getComponent(a.default).pt,displayName:"\u8461\u8404\u7259\u8bed / pt"})],h.prototype,"ptFrame",void 0),o([c({type:cc.SpriteFrame,visible:()=>cc.Canvas.instance.getComponent(a.default).it,displayName:"\u610f\u5927\u5229\u8bed / it"})],h.prototype,"itFrame",void 0),o([c({type:cc.SpriteFrame,visible:()=>cc.Canvas.instance.getComponent(a.default).be,displayName:"\u767d\u4fc4\u7f57\u65af\u8bed / be"})],h.prototype,"beFrame",void 0),o([c({type:cc.SpriteFrame,visible:()=>cc.Canvas.instance.getComponent(a.default).uk,displayName:"\u4e4c\u514b\u5170\u8bed / uk"})],h.prototype,"ukFrame",void 0),o([c({type:cc.SpriteFrame,visible:()=>cc.Canvas.instance.getComponent(a.default).id,displayName:"\u5370\u5ea6\u5c3c\u897f\u4e9a\u8bed / id"})],h.prototype,"idFrame",void 0),o([c({type:cc.SpriteFrame,visible:()=>cc.Canvas.instance.getComponent(a.default).ru,displayName:"\u4fc4\u8bed / ru"})],h.prototype,"ruFrame",void 0),o([c({type:cc.SpriteFrame,visible:()=>cc.Canvas.instance.getComponent(a.default).ar,displayName:"\u963f\u62c9\u4f2f\u8bed / ar"})],h.prototype,"arFrame",void 0),o([c({type:cc.SpriteFrame,visible:()=>cc.Canvas.instance.getComponent(a.default).th,displayName:"\u6cf0\u8bed / th"})],h.prototype,"thFrame",void 0),h=s=o([r,l("\u591a\u8bed\u8a00\u7ec4\u4ef6/\u591a\u8bed\u8a00\u56fe\u7247\u63a7\u5236")],h),i.default=h,cc._RF.pop()},{"./I18nManager":"I18nManager"}],InGame:[function(e,t,i){"use strict";cc._RF.push(t,"edefe52yPVFwa72Hek6rQG1","InGame");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const o=e("../../PBASDK-v2/PBASDK"),n=e("../Management/MgrMain"),a=e("../Views/Cinecamera/CineCamera2d"),r=e("./NotesHelper"),{ccclass:c,property:l}=cc._decorator;let h=class extends cc.Component{constructor(){super(...arguments),this.cmNode=[],this._useCine=!1,this.nodCine=null,this.nodInGame=null,this.nodInWorld=null,this.nodInEm=null,this.hintRespawnTime=5,this.hintHand=null,this.hints=[],this._gameOver=!1,this._stepCount=0,this._dragTrigger=!1,this._animating=!1,this._inited=!1,this._userTouched=!1,this._abTest=1,this._landMark=!0,this._keepLast=!1,this._viewerCursor=0,this._topTouchInfo={start:cc.v3(),move:cc.v3(),end:cc.v3()},this._cameras=[],this._isWin=!0,this._isHinting=!1}get UseCine(){return this._useCine}set UseCine(e){this._useCine=e}get AbMark(){return this._abTest}set AbMark(e){this._abTest=e}get _Animating(){return this._animating}set _Animating(e){this._animating=e,this.onEventTouched()}onLoad(){this.node.on("invokeCustom",e=>{this[e[0]]&&this[e[0]]()},this),this.cmNode.forEach(e=>this._cameras.push(e.getComponent(cc.Camera))),n.default.Instance.AddCallbackReturning(()=>{this.onEventReturningCallback()}),n.default.Instance.AddCallbackFrameSizeChanged(e=>{this.onEventFrameSizeChanged(e)}),r.handleNodeCompBinds(this,"nodInGame"),r.handleResourcesBinds(this,this.onResourcesBindsCompleted.bind(this)),cc.director.getCollisionManager().enabled=!0,cc.director.getPhysicsManager().enabled=!0}start(){cc.game.setFrameRate(59),this.Initial(),this.initEvents(),this.Reset()}onEventGaming(){return!!this._userTouched||(this._userTouched=!0,this._isHinting=!1,n.default.Instance.reportEvents(n.ReportEvents.Start),o.default.GameStart(),!1)}onEventTouched(e=!0){this.unschedule(this.hintRespawn),this.hintHand&&(this.hintHand.children[0].active=!1),this._Animating||(this.hints.forEach(e=>{e&&(e.active=!1)}),e&&this.onEventRehint())}onEventLink(){n.default.Instance.HyperLink()}initEvents(){this.node.on("ongoing",()=>{this.onEventGaming(),this.onEventTouched()},this),this.node.on("topTouchMove",e=>{this.onEventMoveFactor(e),this._topTouchInfo.move=this.nodInGame.convertToWorldSpaceAR(e.getLocation())},this),this.node.on("topTouchStart",e=>{this.onEventFactorOn(e),this._topTouchInfo.start=this.nodInGame.convertToWorldSpaceAR(e.getLocation())},this),this.node.on("topTouchEnd",e=>{this.onEventFactorOff(e),this._topTouchInfo.end=this.nodInGame.convertToWorldSpaceAR(e.getLocation())},this)}hintRespawn(){return!this._gameOver&&!this._Animating&&(this.hintHand&&(this.hintHand.children[0].active=!0),this._isHinting=!0,!0)}onEventRehint(){this.scheduleOnce(this.hintRespawn,this.hintRespawnTime)}onEventFactorOn(e){return!this._Animating&&(this.onEventTouched(!1),this.onEventMoveFactor(e),!0)}onEventFactorOff(e){this.onEventTouched()}onEventMoveFactor(e){return!this._Animating}onEventFrameSizeChanged(e){this._landMark=null!=e?e:!this._landMark,this._isHinting&&this.scheduleOnce(this.hintRespawn.bind(this)),this.UseCine&&this.cineMoveView(this._viewerCursor,!0)}onEventReturningCallback(){this.onEventTouched(!1),n.default.Instance.HighlightCamOff()}_checkAbMark(){let e=window.location.href,t=e.substring(e.lastIndexOf("/")+1,e.length);if(!t.startsWith("debug"))return;let i=(t=t.substring(5,t.length)).match(/mark=(\d+)/);this._abTest=parseInt(i[1])}Initial(){this._gameOver=!1,this._stepCount=0,this._dragTrigger=!1,this._Animating=!1,this.UseCine&&this.cineMoveView(this._viewerCursor,!0)}Reset(){if(2==this.AbMark)return this._gameOver=!0,void n.default.Instance.GameEnd()}Preparation(){}lastStep(e=!1,t=!1,i=1){this._gameOver=!0,this._keepLast=t,n.default.Instance.HighlightCamOff(),!e&&n.default.Instance.FadeOutBranch(3),!t&&n.default.Instance.FadeOutBranch(2),setTimeout(()=>{n.default.Instance.FadeInEndModal(!0),n.default.Instance.reportEvents(n.ReportEvents.GameComplete),n.default.Instance.reportEvents(this._isWin?n.ReportEvents.GameSuccess:n.ReportEvents.GameFail)},500)}cineMoveView(e,t=!1){this._viewerCursor=e,this.nodCine.MoveViewerByIndex(this._viewerCursor,this._landMark?0:1,t)}onResourcesBindsCompleted(){}};s([l({type:[cc.Node]})],h.prototype,"cmNode",void 0),s([l],h.prototype,"_useCine",void 0),s([l],h.prototype,"UseCine",null),s([l(a.default)],h.prototype,"nodCine",void 0),s([l(cc.Node)],h.prototype,"nodInGame",void 0),s([l(cc.Node)],h.prototype,"nodInWorld",void 0),s([l(cc.Node)],h.prototype,"nodInEm",void 0),s([l],h.prototype,"AbMark",null),s([l({type:cc.Float,tooltip:"hint finger respawn time"})],h.prototype,"hintRespawnTime",void 0),s([l(cc.Node)],h.prototype,"hintHand",void 0),s([l([cc.Node])],h.prototype,"hints",void 0),h=s([c],h),i.default=h,cc._RF.pop()},{"../../PBASDK-v2/PBASDK":"PBASDK","../Management/MgrMain":"MgrMain","../Views/Cinecamera/CineCamera2d":"CineCamera2d","./NotesHelper":"NotesHelper"}],InGaming:[function(e,t,i){"use strict";cc._RF.push(t,"1018elQ1a1LGaexk52tcUrI","InGaming");var s,o=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0}),i.StepStage=void 0;const n=e("../Framework/Management/MgrMain"),a=e("../Framework/Logics/InGame"),r=e("../Framework/Management/MgrVersion"),c=e("../Framework/Views/ViewAdapter"),l=e("./CharacterController"),h=e("../Framework/Logics/NotesHelper"),d=e("./Constant"),p=e("./JianTa"),u=e("./Camp"),m=e("./Factory"),_=e("./RangeFollowee"),g=e("../Framework/utils/utils"),f=e("./Enemy"),y=e("./Fence"),v=e("../Framework/utils/messager"),{ccclass:C,property:R}=cc._decorator;var S;(function(e){e[e.BuildBase=0]="BuildBase",e[e.FillJianta01=1]="FillJianta01",e[e.BuildArea01=2]="BuildArea01",e[e.BuildFactory01=3]="BuildFactory01",e[e.UpgradeBase=4]="UpgradeBase",e[e.BossAppear=5]="BossAppear",e[e.Finished=6]="Finished"})(S=i.StepStage||(i.StepStage={}));let A=s=class extends a.default{constructor(){super(...arguments),this.BG=[],this.mapNode=null,this.mapTopNode=null,this.atkArrowsNode=null,this.guideLine=null,this.arrow3d=null,this.bordersNode=null,this.bossNode=null,this.resLabs=[],this.charCtrl=null,this.oriFarmer=null,this.baseNode=null,this.guideNeedNodes=[],this.resNodes=[],this.fencesNodes=[],this.fences=[],this.base1Nodes=[],this.stage2NeedNodes=[],this.area0Nodes=[],this.area1Nodes=[],this.jiantaNodes=[],this.campNodes=[],this.factoryNodes=[],this.base2Nodes=[],this.area0HideFenceNodes=[],this.area1HideFenceNodes=[],this.factory0HideFenceNodes=[],this.factory1HideFenceNodes=[],this.camp0HideFenceNodes=[],this.camp1HideFenceNodes=[],this.campAreaNodes=[],this.resCollectNodes=[],this.instNodes=[],this.charHandler=null,this._charHandlerOriPos=cc.v2(),this.flashRed=null,this.farmerInitNode=null,this.enemyInitNode=null,this.enemyInitRatio=[1,1.2,1.5,2],this._enemyInitRatioLevel=0,this.buildMaxLevels=[1,2],this._buildMaxLevelsLevel=0,this.fenceMaxLevel=0,this.resCount=[10,0,0],this.updateResFlag=!1,this.charPos=cc.v2(),this._tmpVec2s=[cc.v2(),cc.v2(),cc.v2()],this._enterJiantaCount=0,this._expandAreaCount=0,this._buildFactoryCount=0,this._upgradeBaseCount=0}start(){super.start(),s.Instance=this,console.log("%c scene start ","background: #35495E;padding: 1px;border-radius: 2px 0 0 2px;color: #fff;")}initEvents(){super.initEvents(),this.node.on("topTouchStart",e=>{this.charHandler.setPosition(g.Utils.ConvertTouchToLocal(e.getLocation(),this.nodInGame,this._cameras[1]))}),this.node.on("topTouchEnd",()=>{this.charHandler.setPosition(this._charHandlerOriPos)}),this.node.once(d.FarmerFollow,()=>{this.farmerInitNode.emit(d.StartInitCall),this.enemyInitNode.emit(d.StartInitCall)})}onEventGaming(){return this._userTouched||this.scheduleOnce(()=>{this.onFinishAll(),n.default.Instance.HyperLink()},d.AutoHyperLink),super.onEventGaming()}onEventReturningCallback(){super.onEventReturningCallback(),this._gameOver=!0,this.unscheduleAllCallbacks(),this.resLabs[0].node.parent.parent.active=!1,this.flashRed.active=!1,this.charHandler.active=!1,this.onFinishAll()}onEventFrameSizeChanged(e){super.onEventFrameSizeChanged(e),this.charHandler.getPosition(this._charHandlerOriPos),this.mapNode.parent.children.forEach(e=>{e.getComponent(cc.RigidBody).syncPosition(!1)}),this._stepCount!=S.Finished&&(this._cameras[2].zoomRatio=n.default.scaleFactor,this._cameras[3].zoomRatio=n.default.scaleFactor)}onUpdateVersionViewAdapter(){let e=cc.director.getScene().getChildByName("MGR").getChildByName("adapter").getComponent(c.default);switch(r.default.Instance.version){case r.Version.v30s:}e._refinePosScaleRotActive(this._landMark)}hintRespawn(){return super.hintRespawn()}Reset(){n.default.Instance.DarkOnOff(),this.onUpdateVersionViewAdapter(),this.charHandler.getPosition(this._charHandlerOriPos),this.bordersNode.getComponentsInChildren(cc.RigidBody).forEach(e=>e.syncPosition(!1));let e=this.resNodes[0].children.slice();e.forEach(e=>{e.setParent(this.mapNode)}),(e=this.resNodes[1].children.slice()).forEach(e=>{e.setParent(this.mapNode)}),this.onUpdateRes(),this.hintRespawn(),this.hints.forEach(e=>{e.active=!0}),super.Reset()}onJudge(e=!0){this._gameOver||(this._gameOver=!0,n.default.Instance.isWin=e,this.unscheduleAllCallbacks(),e&&n.default.Instance.MgrAudio.PlayMusic(12),this.onFinishAll(),this.flashRed.active=!1,this.charHandler.active=!1,this.lastStep(!0,!0))}update(e){this.charCtrl.node.getPosition(this.charPos);let t=null;switch(this._stepCount){case S.BuildBase:t=this.guideNeedNodes[d.GuideNeeds.Build_Base1];break;case S.FillJianta01:this.charCtrl.collider.__followees.length<2?t=this.onSearchNearestFarmer():this.guideNeedNodes[d.GuideNeeds.Farmer_Base].active&&0==this.baseNode.__alleyCount?t=this.guideNeedNodes[d.GuideNeeds.Farmer_Base]:(t=this.guideNeedNodes[d.GuideNeeds.Farmer_Jianta_0]).active||(t=this.guideNeedNodes[d.GuideNeeds.Farmer_Jianta_1]);break;case S.BuildArea01:case S.BuildFactory01:this.guideNeedNodes[d.GuideNeeds.ExpandArea_0].active?t=this.guideNeedNodes[d.GuideNeeds.ExpandArea_0]:this.guideNeedNodes[d.GuideNeeds.BuildFactory_0].active?t=this.guideNeedNodes[d.GuideNeeds.BuildFactory_0]:this.guideNeedNodes[d.GuideNeeds.ExpandArea_1].active?t=this.guideNeedNodes[d.GuideNeeds.ExpandArea_1]:this.guideNeedNodes[d.GuideNeeds.BuildFactory_1].active&&(t=this.guideNeedNodes[d.GuideNeeds.BuildFactory_1]);break;case S.UpgradeBase:case S.BossAppear:t=this.bossNode.active&&!this.bossNode.getComponent(f.default).isDead?this.bossNode:this.guideNeedNodes[d.GuideNeeds.Build_Base2_0]}null==t?(this.arrow3d.opacity=0,this.guideLine.opacity=0):(this.arrow3d.opacity=255,this.guideLine.opacity=255,this.onUpdateGuideLine(t))}lateUpdate(e){this.updateResFlag&&(this.updateResFlag=!1,this.onUpdateRes())}onUpdateGuideLine(e){cc.isValid(e)&&(this.guideLine.setPosition(this.charPos),e.getPosition(this._tmpVec2s[0]),this.arrow3d.setPosition(this._tmpVec2s[0]),this._tmpVec2s[0].subSelf(this.charPos),this.guideLine.height=this._tmpVec2s[0].mag(),this.guideLine.angle=-cc.misc.radiansToDegrees(this._tmpVec2s[0].signAngle(cc.Vec2.UP_R)))}onUpdateRes(e){null!=e?(this.resLabs[e].string=""+this.resCount[e],this.charCtrl.collectsNode.children[e].children.forEach((t,i)=>{t.active=i<this.resCount[e]})):(this.resLabs.forEach((e,t)=>e.string=""+this.resCount[t]),this.resCount.forEach((e,t)=>{this.charCtrl.collectsNode.children[t].children.forEach((t,i)=>{t.active=i<e})}))}onCheckBuildBase1(){this.fences=this.fences.concat(this.fencesNodes[0].getComponentsInChildren(y.default)),this.base1Nodes[0].active=!1;let e=this.base1Nodes[1].children.slice();e.forEach(e=>{e.setParent(this.mapNode)}),(e=this.base1Nodes[2].children.slice()).forEach(e=>{e.setParent(this.mapNode)}),this.jiantaNodes[0].getComponent(p.default).onUpgrade(),this.jiantaNodes[1].getComponent(p.default).onUpgrade(),this._stepCount=S.FillJianta01}onCheckBuildJianta(e){this.jiantaNodes[e].active=!0,this.jiantaNodes[e].getComponent(p.default).onUpgrade()}onCheckUpgradeJianta(e){this.jiantaNodes[e].getComponent(p.default).onUpgrade()}onCheckExpandArea(e){let t=this.fencesNodes["0"==e?1:2];this.fences=this.fences.concat(t.getComponentsInChildren(y.default)),("0"==e?this.area0HideFenceNodes:this.area1HideFenceNodes).forEach(e=>{e.active=!1,e.destroy()}),this.scheduleOnce(()=>{this.fences=this.fences.filter(e=>cc.isValid(e))});let i="0"==e?this.area0Nodes:this.area1Nodes,s=i[0].children.slice();s.forEach(e=>{e.setParent(this.mapNode)}),(s=t.children.slice()).forEach(e=>{e.setParent(this.mapNode)}),i[0].active=!0,i[1].active=!0,i[2].active=!0,i[3].active=!0,++this._expandAreaCount>=2&&(this._stepCount=S.BuildFactory01)}onCheckBuildFactory(e){let t=this.fencesNodes["0"==e?5:6];this.fences=this.fences.concat(t.getComponentsInChildren(y.default)),("0"==e?this.factory0HideFenceNodes:this.factory1HideFenceNodes).forEach(e=>{e.active=!1,e.destroy()}),this.scheduleOnce(()=>{this.fences=this.fences.filter(e=>cc.isValid(e))});let i=t.children.slice();i.forEach(e=>{e.setParent(this.mapNode)}),(i=this.resCollectNodes[e].children.slice()).forEach(e=>{e.setParent(this.mapNode)}),this.factoryNodes[e].parent.active=!0,this.factoryNodes[e].setParent(this.mapNode),this.factoryNodes[e].getComponent(m.default).onUpgrade(),this.guideNeedNodes["0"==e?d.GuideNeeds.Build_Camp_0:d.GuideNeeds.Build_Camp_1].active=!0,++this._buildFactoryCount>=2&&(this.base2Nodes[0].active=!0,this.base2Nodes[1].active=!0,this._stepCount=S.UpgradeBase)}onCheckUpgradeFactory(e){this.factoryNodes[e].getComponent(m.default).onUpgrade()}onCheckBuildCamp(e){let t=this.fencesNodes["0"==e?3:4];this.fences=this.fences.concat(t.getComponentsInChildren(y.default)),("0"==e?this.camp0HideFenceNodes:this.camp1HideFenceNodes).forEach(e=>{e.active=!1,e.destroy()}),this.scheduleOnce(()=>{this.fences=this.fences.filter(e=>cc.isValid(e))}),this.campNodes[e].parent.active=!0,this.campNodes[e].setParent(this.mapNode),this.campNodes[e].getComponent(u.default).onUpgrade(),this.campAreaNodes[e].active=!0;let i=this.fencesNodes["0"==e?3:4].children.slice();i.forEach(e=>{e.setParent(this.mapNode)}),(i=t.children.slice()).forEach(e=>{e.setParent(this.mapNode)}),this.enemyInitNode.emit(d.ChangeEnemyInitRatio,this.enemyInitRatio[++this._enemyInitRatioLevel])}onCheckUpgradeCamp(e){this.campNodes[e].getComponent(u.default).onUpgrade()}onCheckBuildBase2(){if(++this._upgradeBaseCount>=1){let e=this.baseNode.getChildByName("base");cc.tween(e.children[0]).to(.5,{scale:0},{easing:"cubicOut"}).start(),e.children[1].active=!0,this.fenceMaxLevel=1,this._buildMaxLevelsLevel++,this.jiantaNodes.forEach(e=>{e.emit(d.ChangeBuildMaxLevel,this.buildMaxLevels[this._buildMaxLevelsLevel])}),this.factoryNodes.forEach(e=>{e.emit(d.ChangeBuildMaxLevel,this.buildMaxLevels[this._buildMaxLevelsLevel])}),this.campNodes.forEach(e=>{e.emit(d.ChangeBuildMaxLevel,this.buildMaxLevels[this._buildMaxLevelsLevel])}),this.scheduleOnce(()=>{this.onJudge(!0)},30)}}onEnterJianta(){this._stepCount==S.FillJianta01&&(this._enterJiantaCount++,this._enterJiantaCount>=2&&(this._stepCount=S.BuildArea01,this.stage2NeedNodes.forEach(e=>e.active=!0),this.enemyInitNode.emit(d.ChangeEnemyInitRatio,this.enemyInitRatio[++this._enemyInitRatioLevel])))}onGetDropResToNode(e){return this.charCtrl.collectsNode.children[e].children[this.resCount[e]>=40?39:this.resCount[e]]}onFinishAll(){var e,t;if(this._stepCount==S.Finished)return;this._stepCount=S.Finished,null===(e=this.charCtrl.collider.__followees[0])||void 0===e||(e.getComponent(_.default).follower=null),this.charCtrl.setMoveDirection(cc.Vec2.ZERO_R),this.instNodes.forEach(e=>e.emit(d.StopActionsCall)),this.jiantaNodes.forEach(e=>{var t;e.activeInHierarchy&&(null===(t=e.getComponent(p.default).alleys)||void 0===t||t.forEach(e=>cc.isValid(e)&&e.stopActions()))}),this.campNodes.forEach(e=>{var t;e.activeInHierarchy&&(null===(t=e.getComponent(u.default).alleys)||void 0===t||t.forEach(e=>cc.isValid(e)&&e.stopActions()))}),this.factoryNodes.forEach(e=>{var t;e.activeInHierarchy&&(null===(t=e.getComponent(m.default).alleys)||void 0===t||t.forEach(e=>cc.isValid(e)&&e.stopActions()))}),this.baseNode.activeInHierarchy&&(null===(t=this.baseNode.getComponent(m.default).alleys)||void 0===t||t.forEach(e=>cc.isValid(e)&&e.stopActions()));let i=[this._cameras[2],this._cameras[3]];this.mapNode.convertToWorldSpaceAR(cc.Vec2.ZERO_R,this._tmpVec2s[0]),this.charCtrl.node.convertToNodeSpaceAR(this._tmpVec2s[0],this._tmpVec2s[1]),i.forEach(e=>{cc.tween(e).to(.5,{zoomRatio:.7*n.default.scaleFactor},{easing:"sineInOut"}).start(),cc.tween(e.node).by(.5,{x:this._tmpVec2s[1].x,y:this._tmpVec2s[1].y},{easing:"cubicOut"}).start()})}onSearchNearestFarmer(){let e=this.farmerInitNode.__farmers;if(e.length<=0)return null;let t=0,i=99999;return e.forEach((e,s)=>{if(!e.isFollowing){e.node.getPosition(this._tmpVec2s[0]),this._tmpVec2s[0].subSelf(this.charPos);let o=this._tmpVec2s[0].mag();o<i&&(t=s,i=o)}}),e[t].node}onFlashRed(){this.flashRed.__flashing||(this.flashRed.__flashing=!0,this.flashRed.emit(v.Messager.Inners.StateChange_Run),this.scheduleOnce(()=>{this.flashRed.__flashing=!1},1))}};A.Instance=null,o([R([cc.Node])],A.prototype,"BG",void 0),o([h.NodeCompBinds({path:"MapUI/Map"})],A.prototype,"mapNode",void 0),o([h.NodeCompBinds({path:"MapUI/MapTop"})],A.prototype,"mapTopNode",void 0),o([h.NodeCompBinds({path:"MapUI/MapTop/AtkArrows"})],A.prototype,"atkArrowsNode",void 0),o([h.NodeCompBinds({path:"MapUI/bg/GuideLine"})],A.prototype,"guideLine",void 0),o([h.NodeCompBinds({path:"MapUI/MapTop/Arrow3d"})],A.prototype,"arrow3d",void 0),o([h.NodeCompBinds({path:"MapUI/borders"})],A.prototype,"bordersNode",void 0),o([h.NodeCompBinds({path:"MapUI/Map/Boss"})],A.prototype,"bossNode",void 0),o([R([cc.Label])],A.prototype,"resLabs",void 0),o([R(l.default)],A.prototype,"charCtrl",void 0),o([R(cc.Node)],A.prototype,"oriFarmer",void 0),o([R(cc.Node)],A.prototype,"baseNode",void 0),o([R([cc.Node])],A.prototype,"guideNeedNodes",void 0),o([R([cc.Node])],A.prototype,"resNodes",void 0),o([R([cc.Node])],A.prototype,"fencesNodes",void 0),o([R([cc.Node])],A.prototype,"base1Nodes",void 0),o([R([cc.Node])],A.prototype,"stage2NeedNodes",void 0),o([R([cc.Node])],A.prototype,"area0Nodes",void 0),o([R([cc.Node])],A.prototype,"area1Nodes",void 0),o([R([cc.Node])],A.prototype,"jiantaNodes",void 0),o([R([cc.Node])],A.prototype,"campNodes",void 0),o([R([cc.Node])],A.prototype,"factoryNodes",void 0),o([R([cc.Node])],A.prototype,"base2Nodes",void 0),o([R([cc.Node])],A.prototype,"area0HideFenceNodes",void 0),o([R([cc.Node])],A.prototype,"area1HideFenceNodes",void 0),o([R([cc.Node])],A.prototype,"factory0HideFenceNodes",void 0),o([R([cc.Node])],A.prototype,"factory1HideFenceNodes",void 0),o([R([cc.Node])],A.prototype,"camp0HideFenceNodes",void 0),o([R([cc.Node])],A.prototype,"camp1HideFenceNodes",void 0),o([R([cc.Node])],A.prototype,"campAreaNodes",void 0),o([R([cc.Node])],A.prototype,"resCollectNodes",void 0),o([R([cc.Node])],A.prototype,"instNodes",void 0),o([R(cc.Node)],A.prototype,"charHandler",void 0),o([R(cc.Node)],A.prototype,"flashRed",void 0),o([R(cc.Node)],A.prototype,"farmerInitNode",void 0),o([R(cc.Node)],A.prototype,"enemyInitNode",void 0),A=s=o([C],A),i.default=A,cc._RF.pop()},{"../Framework/Logics/InGame":"InGame","../Framework/Logics/NotesHelper":"NotesHelper","../Framework/Management/MgrMain":"MgrMain","../Framework/Management/MgrVersion":"MgrVersion","../Framework/Views/ViewAdapter":"ViewAdapter","../Framework/utils/messager":"messager","../Framework/utils/utils":"utils","./Camp":"Camp","./CharacterController":"CharacterController","./Constant":"Constant","./Enemy":"Enemy","./Factory":"Factory","./Fence":"Fence","./JianTa":"JianTa","./RangeFollowee":"RangeFollowee"}],InitStones:[function(e,t,i){"use strict";cc._RF.push(t,"7d0f7/9doBF2a3honIKFWg8","InitStones");var s,o=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const n=e("./CollectItem"),a=e("./Constant"),{ccclass:r,property:c}=cc._decorator;let l=s=class extends cc.Component{constructor(){super(...arguments),this.hitMat=null,this.stoneItems=null,this._times=null,this.isStopped=!1}onLoad(){s.Instance=this,this.node.on(a.StopActionsCall,this.onStopActions,this),this.stoneItems=this.getComponentsInChildren(n.default),this._times=new Array(this.stoneItems.length),this.stoneItems.forEach((e,t)=>{e.getComponent(cc.Sprite).setMaterial(0,this.hitMat),e._mat=e.getComponent(cc.Sprite).getMaterial(0),this._times[t]=-1})}start(){}update(e){this.isStopped||this.stoneItems.forEach((t,i)=>{t.resStatus==a.ResourceStatus.Disable&&-1==this._times[i]&&(this._times[i]=0),this._times[i]>=0&&(this._times[i]+=e,this._times[i]>=a.ResourceRefreshSpan&&(t.node.active=!0,this._times[i]=-1))})}onStopActions(){this.isStopped=!0}};l.Instance=null,o([c(cc.Material)],l.prototype,"hitMat",void 0),l=s=o([r],l),i.default=l,cc._RF.pop()},{"./CollectItem":"CollectItem","./Constant":"Constant"}],InitTrees:[function(e,t,i){"use strict";cc._RF.push(t,"5729cY+0sVEGrwE/tYP4a+d","InitTrees");var s,o=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const n=e("./CollectItem"),a=e("./Constant"),{ccclass:r,property:c}=cc._decorator;let l=s=class extends cc.Component{constructor(){super(...arguments),this.hitMat=null,this.treeItems=null,this._times=null,this.isStopped=!1}onLoad(){s.Instance=this,this.node.on(a.StopActionsCall,this.onStopActions,this),this.treeItems=this.getComponentsInChildren(n.default),this._times=new Array(this.treeItems.length),this.treeItems.forEach((e,t)=>{e.getComponent(cc.Sprite).setMaterial(0,this.hitMat),e._mat=e.getComponent(cc.Sprite).getMaterial(0),this._times[t]=-1})}start(){}update(e){this.isStopped||this.treeItems.forEach((t,i)=>{t.resStatus==a.ResourceStatus.Disable&&-1==this._times[i]&&(this._times[i]=0),this._times[i]>=0&&(this._times[i]+=e,this._times[i]>=a.ResourceRefreshSpan&&(t.node.active=!0,this._times[i]=-1))})}onStopActions(){this.isStopped=!0}};l.Instance=null,o([c(cc.Material)],l.prototype,"hitMat",void 0),l=s=o([r],l),i.default=l,cc._RF.pop()},{"./CollectItem":"CollectItem","./Constant":"Constant"}],JianTa:[function(e,t,i){"use strict";cc._RF.push(t,"b1cafq2xs5NeaAzkgYal4Tg","JianTa");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const o=e("../Framework/Management/MgrMain"),n=e("./Alley"),a=e("./Constant"),r=e("./InGaming"),c=e("./Need"),l=e("./NeedFarmer"),{ccclass:h,property:d}=cc._decorator,p=[[cc.v2()],[cc.v2(-26),cc.v2(50)],[cc.v2(8,30),cc.v2(-36),cc.v2(50),cc.v2(4,-30)]],u=cc.v2(72,-56);let m=class extends cc.Component{constructor(){super(...arguments),this.toLvNeeds=[],this.needFarmer=null,this.hitMat=null,this.hpNode=null,this.hpBarSpr=null,this.maxHp=a.FenceMaxHp,this.hp=0,this.lockHp=a.FenceLockHp,this._mat=null,this._matVals={progress:0},this._isTweening=!1,this.bodyNode=null,this.alleysNode=null,this.upgradeAni=null,this.level=0,this.maxLevel=a.JianTaMaxLevel,this.alleys=[],this.alleyCount=0,this.maxAlleyCount=0,this._tmpVec2s=[cc.v2(),cc.v2(),cc.v2()]}onLoad(){this.hp=this.maxHp,this.bodyNode=this.node.getChildByName("body"),this.alleysNode=this.node.getChildByName("alleys"),this.upgradeAni=this.node.getComponentInChildren(cc.Animation),this.needFarmer.node.active=!0,this.node.on(a.ChangeBuildMaxLevel,e=>{this.maxLevel=e,this.alleyCount>=this.maxAlleyCount&&this.level<this.maxLevel&&(this.toLvNeeds[this.level-1].node.active=!0)})}start(){this.node.getComponent(cc.RigidBody).syncPosition(!1)}onUpgrade(){if(o.default.Instance.MgrAudio.forcePlayMusic(10),this.level>0){let e=this.level-1;cc.tween(this.bodyNode.children[e]).to(.5,{scale:0},{easing:"cubicOut"}).call(()=>this.bodyNode.children[e].active=!1).start()}if(this.bodyNode.children[this.level].active=!0,this.bodyNode.children[this.level].scale=0,cc.isValid(this.hitMat)){let e=this.node.getChildByName("body").children[this.level];e.getComponent(cc.Sprite).setMaterial(0,this.hitMat),this._mat=e.getComponent(cc.Sprite).getMaterial(0),this._mat.setProperty("progress",this._matVals.progress,0)}cc.tween(this.bodyNode.children[this.level]).to(.5,{scale:1},{easing:"backOut"}).start(),this.level++,this.maxAlleyCount=1<<this.level-1,this.upgradeAni.play(),this.realignAlleyPos(),this.needFarmer.needs=this.maxAlleyCount,this.needFarmer.onUpdateProgress(),this.needFarmer.node.active=!0}onEnter(e){if(cc.isValid(e)&&this.alleyCount<this.maxAlleyCount){let t=this.getEnterAlleyPos(),i=this.node.getChildByName("alleys");i.convertToWorldSpaceAR(u,this._tmpVec2s[0]),this.node.parent.convertToNodeSpaceAR(this._tmpVec2s[0],this._tmpVec2s[1]),this._tmpVec2s[1].sub(this._tmpVec2s[0],this._tmpVec2s[2]);let s=this._tmpVec2s[2].x>=0?1:-1;e.getChildByName("char").getComponent(sp.Skeleton).setAnimation(0,"run",!0),cc.tween(e).call(()=>e.scaleX=s).call(()=>{e.setParent(i),e.setPosition(u);let s=cc.instantiate(o.default.Instance.MgrRcs.prefabs[a.Prefabs.ArcherFarmer]);s.setParent(i),s.setPosition(u),s.removeComponent(cc.PhysicsCircleCollider),s.removeComponent(cc.RigidBody),s.removeComponent(cc.CircleCollider);let r=s.getComponent(n.default);this.alleys.push(r),r.onScheduleAtk(),this.realignAlleyPos(),cc.tween(s).parallel(cc.tween(s).to(.6,{x:t.x}),cc.tween(s).to(.3,{y:1.5*t.y},{easing:"backOut"}).to(.3,{y:t.y})).call(()=>{}).start(),e.removeFromParent(),e.destroy()}).start(),this.alleyCount++,r.default.Instance.onEnterJianta(),this.alleyCount>=this.maxAlleyCount&&this.level<this.maxLevel&&(this.toLvNeeds[this.level-1].node.active=!0),this.alleyCount>=this.maxAlleyCount&&(this.needFarmer.node.active=!1)}}onToFactoryAndEnter(){let e=r.default.Instance.charCtrl.onShiftFollowee();cc.isValid(e)&&this.onEnter(e)}getEnterAlleyPos(){return p[this.level-1][this.alleyCount]}realignAlleyPos(){const e=p[this.level-1];this.alleysNode.children.forEach((t,i)=>{i<e.length&&t.setPosition(e[i])})}onHit(e=0){cc.isValid(this._mat)&&(e>0&&o.default.Instance.MgrAudio.forcePlayMusic(9),this.hp-=e,this.hp<=this.lockHp&&(this.hp=this.lockHp),cc.isValid(this.hpNode)||(this.hpNode=cc.instantiate(o.default.Instance.MgrRcs.prefabs[a.Prefabs.HpBar]),this.hpBarSpr=this.hpNode.getChildByName("bar").getComponent(cc.Sprite),this.hpNode.scale*=this.node.scale>0?1:-1,this.hpNode.setParent(this.node)),e>0&&(!this.hpNode.active||255!=this.hpNode.opacity)&&(this.hpNode.active=!0,this.hpNode.stopAllActions(),this.hpNode.opacity=255),this.hpBarSpr.fillRange=this.hp/this.maxHp,this._isTweening||(this._isTweening=!0,cc.tween(this._matVals).to(.2,{progress:a.HitFlashAniDura},{onUpdate:e=>{this._mat.setProperty("progress",e.progress,0)}}).to(.2,{progress:0},{onUpdate:e=>{this._mat.setProperty("progress",e.progress,0)}}).call(()=>this._isTweening=!1).start()))}};s([d([c.default])],m.prototype,"toLvNeeds",void 0),s([d(l.default)],m.prototype,"needFarmer",void 0),s([d(cc.Material)],m.prototype,"hitMat",void 0),s([d(cc.Node)],m.prototype,"hpNode",void 0),s([d(cc.Sprite)],m.prototype,"hpBarSpr",void 0),m=s([h],m),i.default=m,cc._RF.pop()},{"../Framework/Management/MgrMain":"MgrMain","./Alley":"Alley","./Constant":"Constant","./InGaming":"InGaming","./Need":"Need","./NeedFarmer":"NeedFarmer"}],MgrAudio:[function(e,t,i){"use strict";cc._RF.push(t,"a28985g/xVMO5xSbEvu0+VG","MgrAudio");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const o=e("./MgrMain"),{ccclass:n,property:a}=cc._decorator;let r=class extends cc.Component{constructor(){super(...arguments),this.volGlobal=1,this.volBGM=1,this.volVO=1,this.s_BGM=null,this.s_audios=[],this.musicBG=new cc.AudioSource,this.voiceOver=new cc.AudioSource,this.mapMusic=new Map,this.loopMusic=new Map,this.outSide=!0}onLoad(){o.default.Instance.MgrAudio=this}start(){this.musicBG.clip=this.s_BGM,this.musicBG.node=this.node,this.voiceOver.node=this.node,this.s_audios.forEach((e,t)=>{let i=new cc.AudioSource;i.node=this.node,i.clip=this.s_audios[t],this.mapMusic.set(t,i)})}PlayBGMusic(){o.default.Instance._touched&&(this.musicBG.isPlaying||(this.musicBG.play(),this.musicBG.volume=this.volBGM*this.volGlobal,this.musicBG.loop=!0))}StopBGMusic(){this.musicBG.isPlaying&&this.musicBG.stop()}PlayMusic(e,t=!1,i=1,s=!1){if(!o.default.Instance._touched)return;let n=this.mapMusic.get(e);s&&n.isPlaying||(n.loop=t,n.volume=i*this.volGlobal,n.play())}StopMusic(e,t=!1){let i=this.mapMusic.get(e);i.loop=t,i.stop()}StopLoopingMusic(e){this.mapMusic.get(e).stop(),this.mapMusic.get(e).loop=!1}PlayVO(e,t=!1,i=1){o.default.Instance._touched&&(this.voiceOver.isPlaying&&this.voiceOver.stop(),this.voiceOver.clip=this.mapMusic.get(e).clip,this.voiceOver.loop=t,this.voiceOver.volume=i*this.volVO*this.volGlobal,this.voiceOver.play())}PlayMutipMusic(e,t,i=!1,s=1){if(!o.default.Instance._touched)return;this.loopMusic.has(t)&&(this.loopMusic.get(t).stop(),this.loopMusic.get(t).destroy(),this.loopMusic.set(t,null));let n=new cc.AudioSource;n.node=this.node,n.clip=this.mapMusic.get(e).clip,n.loop=i,n.volume=s*this.volGlobal,this.loopMusic.set(t,n),n.play()}StopMutipMusic(e){this.loopMusic.has(e)&&this.loopMusic.get(e).stop()}GetAudioByName(e){return this.mapMusic.has(e)?this.mapMusic.get(e):null}StopAll(){this.StopBGMusic(),this.voiceOver.stop(),this.mapMusic.forEach(e=>{e.stop()}),this.loopMusic.forEach(e=>{e.stop()})}forcePlayMusic(e,t=!1,i=1){if(!o.default.Instance._touched)return;let s=this.mapMusic.get(e);if(s.isPlaying){if(s.node.childrenCount>=5)return;let e=new cc.Node("tmpAuNode");s.node.parent.addChild(e);let o=e.addComponent(cc.AudioSource);o.clip=s.clip,o.loop=t,o.volume=i*this.volGlobal,o.play(),this.scheduleOnce(()=>{e.destroy()},s.getDuration())}else this.PlayMusic(e,t,i)}};s([a({min:0})],r.prototype,"volGlobal",void 0),s([a({min:0})],r.prototype,"volBGM",void 0),s([a({min:0})],r.prototype,"volVO",void 0),s([a(cc.AudioClip)],r.prototype,"s_BGM",void 0),s([a({type:[cc.AudioClip]})],r.prototype,"s_audios",void 0),r=s([n],r),i.default=r,cc._RF.pop()},{"./MgrMain":"MgrMain"}],MgrMain:[function(e,t,i){"use strict";cc._RF.push(t,"48b34uaXYRDZYcCqq87YvXN","MgrMain");var s,o=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0}),i.ReportEvents=void 0;const n=e("../../PBASDK-v2/PBASDK"),a=e("../utils/ScreenRecorder"),{ccclass:r,property:c}=cc._decorator;var l;(function(e){e[e.Start=0]="Start",e[e.GameSuccess=1]="GameSuccess",e[e.GameFail=2]="GameFail",e[e.GameComplete=3]="GameComplete",e[e.CTAClick=4]="CTAClick"})(l=i.ReportEvents||(i.ReportEvents={}));let h=s=class extends cc.Component{constructor(){super(...arguments),this.cmHighlight=null,this.Judger=null,this.LogicCtrl=null,this.icon=null,this.cta=null,this.maskDark=null,this.logoView=null,this.acBranches=[],this.inputBlock=null,this.recorder=null,this.MgrAudio=null,this.MgrRcs=null,this.isWin=!1,this._ended=!1,this._touched=!1,this._returningCallback=null,this._frameSizeChangedCallbacks=[],this._cineCameras=[]}onLoad(){s.Instance=this,n.default.Init("th_rescuefarmers",1)}start(){cc.game.setFrameRate(60),this.MgrRcs.LoadAll(),this.SwitchBranch([2]),this.Judger.on(cc.Node.EventType.TOUCH_START,e=>{this.Touched(e)},this),this.Judger.on(cc.Node.EventType.TOUCH_MOVE,e=>{this.TouchedMove(e)},this),this.Judger.on(cc.Node.EventType.TOUCH_END,e=>{this.TouchedEnd(e)},this),this.JudgerSwallow(),this.DarkOnOff(!0),this.recorder=this.getComponent(a.default),this.icon.on(cc.Node.EventType.TOUCH_END,()=>{this.recorder.stopRecorder()}),this.cta.on(cc.Node.EventType.TOUCH_END,()=>{this.HyperLink()},this)}RegisterCinecameras(e){this._cineCameras.push(e)}GetCineCameraByIndex(e){return e>=this._cineCameras.length?null:this._cineCameras[e]}HyperLink(){this.GameEnd(),this.inputBlock.active=!0,n.default.ClickDownloadBar(),this.SwitchBranch([0,2]),this._returningCallback&&this._returningCallback(),s.Instance.MgrAudio.StopAll(),this.logoView.active=!1}JudgerSwallow(e=!1){this.Judger._touchListener.swallowTouches=e}FrameSizeChanged(e){this._frameSizeChangedCallbacks.forEach(t=>t(e))}HighlightCamOn(){this.cmHighlight.active=!0}HighlightCamOff(){this.cmHighlight.active=!1}Touched(e){this._touched=!0,this._ended?this.HyperLink():(this.maskDark&&(this.maskDark.active=!1),this.MgrAudio.PlayBGMusic(),this.LogicCtrl.emit("ongoing")),this.LogicCtrl.emit("topTouchStart",e),n.default.TouchStart()}TouchedMove(e){this.LogicCtrl.emit("topTouchMove",e)}TouchedEnd(e){this.LogicCtrl.emit("topTouchEnd",e),n.default.TouchEnd()}SwitchBranch(e,t=!1){let i=0;e.forEach(e=>{this.acBranches[e].active&&i++}),i>=e.length||(this.acBranches.forEach((t,i)=>{!e.includes(i)&&(t.active=!1)}),e.forEach(e=>{t&&cc.tween(this.acBranches[e]).to(0,{opacity:0},{easing:"cubicIn"}).call(()=>{this.acBranches[e].active=!0}).to(.5,{opacity:255},{easing:"cubicIn"}).start(),this.acBranches[e].active=!0}))}BranchEndModal(e=!1){this.SwitchBranch([1],e),this._ended=!0}SwitchFade(e,t=!1){let i=0;e.forEach(e=>{this.acBranches[e].active&&i++}),i>=e.length||e.forEach(e=>{t&&(this.acBranches[e].active=!0)})}FadeInEndModal(e=!1){this.SwitchFade([1],e),setTimeout(()=>{this._ended=!0},1)}FadeOutBranch(e,t=.3){cc.tween(this.acBranches[e]).to(t,{opacity:0},{easing:"cubicIn"}).call(()=>{this.acBranches[e].active=!1}).start()}AddCallbackReturning(e){this._returningCallback=e}AddCallbackFrameSizeChanged(e){for(let t=0;t<this._frameSizeChangedCallbacks.length;t++)if(null==this._frameSizeChangedCallbacks[t])return this._frameSizeChangedCallbacks[t]=e,t;return this._frameSizeChangedCallbacks.push(e),this._frameSizeChangedCallbacks.length-1}RemoveCallbackFrameSizeChanged(e){this._frameSizeChangedCallbacks[e]=null}DarkOnOff(e=!1){this.maskDark&&(this.maskDark.active=e)}GameEnd(e=!0,t=3){this._ended=e,this.JudgerSwallow(e),this.Judger.zIndex=99,n.default.GameEnd(this.isWin),this.reportEvents(l.CTAClick)}reportEvents(e){}};h.Instance=null,h.TestingNumber=0,h.scaleFactor=0,o([c({type:cc.Node})],h.prototype,"cmHighlight",void 0),o([c({type:cc.Node})],h.prototype,"Judger",void 0),o([c({type:cc.Node})],h.prototype,"LogicCtrl",void 0),o([c({type:cc.Node})],h.prototype,"icon",void 0),o([c({type:cc.Node})],h.prototype,"cta",void 0),o([c({type:cc.Node})],h.prototype,"maskDark",void 0),o([c({type:cc.Node})],h.prototype,"logoView",void 0),o([c({type:[cc.Node]})],h.prototype,"acBranches",void 0),o([c({type:cc.Node})],h.prototype,"inputBlock",void 0),h=s=o([r],h),i.default=h,cc._RF.pop()},{"../../PBASDK-v2/PBASDK":"PBASDK","../utils/ScreenRecorder":"ScreenRecorder"}],MgrResource:[function(e,t,i){"use strict";cc._RF.push(t,"bcd4ao1AG9AkLAJpLarBgMd","MgrResource");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const o=e("./MgrMain"),{ccclass:n,property:a}=cc._decorator;let r=class extends cc.Component{constructor(){super(...arguments),this.imageDefault=null,this.imageSubs=[],this.tempSubPath="texs/subImages/",this.mapImages=new Map,this.prefabs=[]}onLoad(){o.default.Instance.MgrRcs=this}start(){}LoadAll(){this.loadFolder(this.tempSubPath)}loadFolder(e){cc.assetManager.resources.loadDir(this.tempSubPath,cc.SpriteFrame,()=>{})}GetImageByName(e){return"string"==typeof e&&(e=parseInt(e)),this.imageSubs[e]?this.imageSubs[e]:null}};s([a({type:cc.SpriteFrame})],r.prototype,"imageDefault",void 0),s([a({type:[cc.SpriteFrame]})],r.prototype,"imageSubs",void 0),s([a([cc.Prefab])],r.prototype,"prefabs",void 0),r=s([n],r),i.default=r,cc._RF.pop()},{"./MgrMain":"MgrMain"}],MgrVersion:[function(e,t,i){"use strict";cc._RF.push(t,"32dd8rfGkNCr6he5VhmJ3ke","MgrVersion");var s,o=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0}),i.Version=void 0;const{ccclass:n,property:a}=cc._decorator;var r;(function(e){e[e.v30s=1]="v30s",e[e.v1min=2]="v1min"})(r=i.Version||(i.Version={}));let c=s=class extends cc.Component{constructor(){super(...arguments),this._version=r.v30s}get version(){return this._version}set version(e){this._version=e}onLoad(){s.Instance=this}start(){}};c.Instance=null,o([a],c.prototype,"_version",void 0),o([a({type:cc.Enum(r)})],c.prototype,"version",null),c=s=o([n],c),i.default=c,cc._RF.pop()},{}],MultiCircleGradient:[function(e,t,i){"use strict";cc._RF.push(t,"e3aabeb/l5CwIz0qy0WgclW","MultiCircleGradient");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const{ccclass:o,property:n,executeInEditMode:a}=cc._decorator;let r=class extends cc.Component{constructor(){super(...arguments),this.pointRadiusSmoothnessArr=[],this._mat=null,this._flatArr=new Float32Array(8),this._needFreshFlag=!1}onLoad(){this._mat=this.getComponent(cc.Sprite).getMaterial(0)}start(){}onEnable(){this.updateMaterial()}updateMaterial(){this._mat.setProperty("textureSize",cc.v2(this.node.width,this.node.height));for(let e=0;e<this.pointRadiusSmoothnessArr.length;e++)this._flatArr[4*e]=this.pointRadiusSmoothnessArr[e].x,this._flatArr[4*e+1]=this.pointRadiusSmoothnessArr[e].y,this._flatArr[4*e+2]=this.pointRadiusSmoothnessArr[e].z,this._flatArr[4*e+3]=this.pointRadiusSmoothnessArr[e].w;this._mat.setProperty("pointRadiusSmoothnessArr",this._flatArr)}addNewPoint(){return this.pointRadiusSmoothnessArr.push(new cc.Vec4(0,0,0,0)),this.pointRadiusSmoothnessArr.length-1}updatePoint(e,t){this._needFreshFlag=!0,this.pointRadiusSmoothnessArr[e].x=t.x,this.pointRadiusSmoothnessArr[e].y=t.y,this.pointRadiusSmoothnessArr[e].z=t.z,this.pointRadiusSmoothnessArr[e].w=t.w}updatePointTween(e,t,i=.5){cc.tween(this.pointRadiusSmoothnessArr[e]).to(i,{x:t.x,y:t.y,z:t.z,w:t.w},{onUpdate:()=>this._needFreshFlag=!0}).start()}lateUpdate(e){this._needFreshFlag&&this.updateMaterial()}};s([n({type:[cc.Vec4],tooltip:!1})],r.prototype,"pointRadiusSmoothnessArr",void 0),r=s([o,a],r),i.default=r,cc._RF.pop()},{}],NeedFarmer:[function(e,t,i){"use strict";cc._RF.push(t,"cf215gSQo1J87rxqDr9SPOu","NeedFarmer");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const o=e("./Constant"),n=e("./Need"),{ccclass:a,property:r}=cc._decorator;let c=class extends n.default{constructor(){super(...arguments),this.owns=0,this._isFilling=!1,this._isColding=!1,this._time=0,this._heroCollider=null}onLoad(){super.onLoad(),this._fillSpr.fillRange=0}start(){}update(e){this._isColding?(this._time-=e,this._time<=0&&(this._time=0,this._isColding=!1),this._fillSpr.fillRange=this._time/o.NeedFarmerFillSpan):(this._time=o.NeedFarmerFillSpan,this._fillSpr.fillRange=0,this.onAdd())}onCollisionEnter(e,t){e.tag==o.PhysicsTags.Hero&&e.__followees.length>0&&(this._heroCollider=e,this._isFilling=!0)}onCollisionExit(e,t){e.tag==o.PhysicsTags.Hero&&(this._isFilling=!1)}onAdd(){!this._isColding&&this._isFilling&&(this._isColding=!0,this.owns++,cc.Component.EventHandler.emitEvents(this.finishCallEvents),this.onUpdateProgress(),cc.isValid(this._heroCollider)&&this._heroCollider.__followees.length<=0&&(this._isFilling=!1))}onUpdateProgress(){this._numLab.string=this.owns+"/"+this.needs}};s([r],c.prototype,"owns",void 0),c=s([a],c),i.default=c,cc._RF.pop()},{"./Constant":"Constant","./Need":"Need"}],Need:[function(e,t,i){"use strict";cc._RF.push(t,"c82c7HMSkVJ6pMCV/ZS/u1D","Need");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const o=e("./Constant"),{ccclass:n,property:a}=cc._decorator;let r=class extends cc.Component{constructor(){super(...arguments),this.resType=o.ResourceType.Coin,this.needs=999,this.owns=0,this.finishCallEvents=[],this.areaType=o.AreaType.Camp,this._numLab=null,this._fillSpr=null,this._isTweening=!1}onLoad(){this._numLab=this.node.getChildByName("num").getComponent(cc.Label),this._fillSpr=this.node.getChildByName("pg").getComponent(cc.Sprite),this.onUpdateProgress()}start(){}onAdd(){if(!(this.owns>=this.needs)&&(this.owns++,this.resType!=o.ResourceType.Farmer)){if(this.onUpdateProgress(),this.owns>=this.needs&&(this.node.active=!1,cc.Component.EventHandler.emitEvents(this.finishCallEvents)),this._isTweening)return;this._isTweening=!0;let e=this.node.scale;cc.tween(this.node).to(o.ResourceFillSpan,{scale:1.1*e}).to(o.ResourceFillSpan,{scale:e}).call(()=>this._isTweening=!1).start()}}onUpdateProgress(){this._numLab.string=this.needs-this.owns+"",this._fillSpr.fillRange=this.owns/this.needs}};s([a({type:cc.Enum(o.ResourceType)})],r.prototype,"resType",void 0),s([a],r.prototype,"needs",void 0),s([a([cc.Component.EventHandler])],r.prototype,"finishCallEvents",void 0),r=s([n],r),i.default=r,cc._RF.pop()},{"./Constant":"Constant"}],NotesHelper:[function(e,t,i){"use strict";cc._RF.push(t,"0cb8d632URGaZYp9Zyzr76q","NotesHelper"),Object.defineProperty(i,"__esModule",{value:!0}),i.handleResourcesBinds=i.ResourcesBinds=i.handleNodeCompBinds=i.NodeCompBinds=i.LogMethodCalls=void 0,i.LogMethodCalls=function(e="",t=[]){return function(i){const s=Object.getOwnPropertyNames(i.prototype);cc.log(s),s.forEach(s=>{var o;const n=s.toLocaleString();for(const e of t)if(n.includes(e))return;if("function"==typeof(null===(o=Object.getOwnPropertyDescriptor(i.prototype,s))||void 0===o?void 0:o.get))return;const a=i.prototype[s];"constructor"!==s&&"function"==typeof a&&(i.prototype[s]=function(...t){const i=(new Date).toLocaleTimeString();console.log(`[${i}] [${e}] Calling method: ${s} with arguments:`,t);const o=a.apply(this,t);return console.log(`[${e}] Method: ${s} returned:`,o),o})})}},i.NodeCompBinds=function(e){return function(t,i){t.__NodeCompBinds||(t.__NodeCompBinds=[]),t.__NodeCompBinds.push({options:e,propertyKey:i})}},i.handleNodeCompBinds=(e,t)=>{e.__NodeCompBinds&&e.__NodeCompBinds.forEach(i=>{const{options:s,propertyKey:o}=i;let n=s.refer?e[s.refer]:t?e[t]:e.node;if(!n)return void cc.warn(`Root node ${s.refer||t||"target.node"} not found on target.`);let a=n;s.path.split("/").forEach(e=>{a&&(a=a.getChildByName(e))}),a?s.type?s.isComps?e[o]=a.getComponentsInChildren(s.type)||[]:e[o]=a.getComponent(s.type)||null:e[o]=a:cc.warn(`Node ${s.path} not found.`)})},i.ResourcesBinds=function(e){return function(t,i){t.__ResourcesBinds||(t.__ResourcesBinds=[]),t.__ResourcesBinds.push({options:e,propertyKey:i})}},i.handleResourcesBinds=(e,t)=>{e.__ResourcesBinds&&(e.__ResourcesBindsCount=e.__ResourcesBinds.length,e.__ResourcesBinds.forEach(i=>{const{options:s,propertyKey:o}=i;s.isPatch?cc.resources.loadDir(s.path,s.type,(i,n)=>{i?cc.error("handleResourcesBinds error: "+s.path+i):e[o]=n.sort((e,t)=>e.name.localeCompare(t.name)),0==--e.__ResourcesBindsCount&&t&&t()}):cc.resources.load(s.path,s.type,(i,n)=>{i?cc.error("handleResourcesBinds error: "+s.path+i):e[o]=n,0==--e.__ResourcesBindsCount&&t&&t()})}))},cc._RF.pop()},{}],PBASDK:[function(e,t,i){"use strict";cc._RF.push(t,"05c5dDikExGNrMpc7ebpFGG","PBASDK"),Object.defineProperty(i,"__esModule",{value:!0});const s=e("./super_html_playable"),o=e("./PrintComponent"),n=e("./StutterCheck");class a{static Init(e,t){s.default.set_google_play_url("https://play.google.com/store/apps/details?id=com.greenmushroom.boomblitz.gp&hl=en_US"),s.default.set_app_store_url("https://apps.apple.com/us/app/top-heroes/id6450953550"),o.PrintComponent.init(e,t),o.PrintComponent.loading()}static ClickDownloadBar(){o.PrintComponent.actionbar(o.PlayerAction.download),s.default.download()}static AuToJumpDownload(){o.PrintComponent.actionbar(o.PlayerAction.automatic_jump),s.default.download()}static GameEnd(e){n.default.instance.stopReport(),o.PrintComponent.endGame(e),n.default.instance.reportStutter(),s.default.game_end()}static EnterSection(e){o.PrintComponent.stage=e,o.PrintComponent.endGame(!0)}static TouchStart(){o.PrintComponent.game_interaction("touch-start")}static TouchEnd(){o.PrintComponent.game_interaction("touch-end")}static GameStart(){o.PrintComponent.startGame(),n.default.instance.startReport()}static Replay(){o.PrintComponent.replay()}}i.default=a,a._Version="1.0.0",cc._RF.pop()},{"./PrintComponent":"PrintComponent","./StutterCheck":"StutterCheck","./super_html_playable":"super_html_playable"}],PPR2dBase:[function(e,t,i){"use strict";cc._RF.push(t,"37207QFw6BAZL5wG3HPozyQ","PPR2dBase");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0}),i.PPR2dBaseItem=void 0;const{ccclass:o,property:n,menu:a,executeInEditMode:r}=cc._decorator;var c;(function(e){e[e.None=0]="None",e[e.Kawase=1]="Kawase"})(c||(c={}));let l=class{constructor(){this.matrix=new cc.Vec4,this.matrixAnchor=cc.v2(.5,.5),this.effectSprites=[]}};s([n(cc.Vec4)],l.prototype,"matrix",void 0),s([n(cc.Vec2)],l.prototype,"matrixAnchor",void 0),s([n([cc.Sprite])],l.prototype,"effectSprites",void 0),l=s([o("PPR2dBaseItem")],l),i.PPR2dBaseItem=l;let h=class extends cc.Component{constructor(){super(...arguments),this._inUsed=!1,this.PBRrenderNode=null,this.camRenders=[],this.modeType=c.None,this.kawaseIter=1,this._renderSize=cc.v2(1138,640),this.effectedList=[],this._imgRT=new cc.RenderTexture,this._imgRTspritframe=null,this._camPBRUsed=[],this._rtPBRUsed=[],this._imgPBRUsed=[],this._uint8Data=new Uint8Array}get InUsed(){return this._inUsed}set InUsed(e){this._inUsed=e,this._SetOnOffNodes(this._inUsed)}get RenderSize(){return this._renderSize}set RenderSize(e){this._renderSize=e,this._init()}onload(){console.log("ppr"),this.node.active,this.node.on(cc.Node.EventType.SIZE_CHANGED,()=>{this.RenderSize=cc.v2(this.node.getContentSize().width,this.node.getContentSize().height),this.Reset()},this)}onEnable(){this.Reset()}start(){}lateUpdate(e){this.InUsed}_resizeHintArea(){this.node.setContentSize(this.RenderSize.x,this.RenderSize.y)}_init(){this._imgRT.initWithSize(this.RenderSize.x,this.RenderSize.y),this._imgRT.name="hahaha",this.camRenders.forEach(e=>{e.targetTexture=this._imgRT}),this.effectedList.forEach((e,t)=>{this._rtPBRUsed.push(new cc.RenderTexture),this._rtPBRUsed[t].initWithSize(e.matrix.z,e.matrix.w),this._uint8Data=this._imgRT.readPixels(null,e.matrix.x+this.RenderSize.x/2,e.matrix.y-this.RenderSize.y/2,e.matrix.z,e.matrix.w),this._rtPBRUsed[t].initWithData(this._uint8Data,this._imgRT.getPixelFormat(),e.matrix.z,e.matrix.w),console.log("tex ",this._imgRT,"\n",this._rtPBRUsed[t]),e.effectSprites.forEach(e=>{e.spriteFrame=new cc.SpriteFrame(this._imgRT),e.spriteFrame.setFlipY(!0)})}),this.freshRenderInfo()}_SetOnOffNodes(e){this.node.children.forEach(t=>{t.active=e}),this.effectedList.forEach(t=>{t.effectSprites.forEach(t=>{t.node.active=e})})}Reset(){this.InUsed&&(this._init(),this.Refresh(),this.test())}Refresh(){switch(this.freshRenderInfo(),this.modeType){case c.None:case c.Kawase:}}freshRenderInfo(){this._rtPBRUsed.forEach((e,t)=>{this._uint8Data=this._imgRT.readPixels(null,this.effectedList[t].matrix.x+this.RenderSize.x/2,this.effectedList[t].matrix.y-this.RenderSize.y/2,this.effectedList[t].matrix.z,this.effectedList[t].matrix.w),this._rtPBRUsed[t].initWithData(this._uint8Data,cc.RenderTexture.PixelFormat.RGBA8888,this.effectedList[t].matrix.z,this.effectedList[t].matrix.w)})}calculateGaussianWeights(){let e=[.147761,.118318,.0947416,0],t=1/(2*Math.PI*Math.pow(.5,2))*Math.exp(0),i=1/(2*Math.PI*Math.pow(.5,2))*Math.exp(-1/(2*Math.pow(.5,2))),s=1/(2*Math.PI*Math.pow(.5,2))*Math.exp(-2/(2*Math.pow(.5,2))),o=t+4*i+4*s;return e[0]=t/o,e[1]=i/o,e[2]=s/o,e}Kawase(){}test(){}};s([n],h.prototype,"_inUsed",void 0),s([n],h.prototype,"InUsed",null),s([n(cc.Node)],h.prototype,"PBRrenderNode",void 0),s([n([cc.Camera])],h.prototype,"camRenders",void 0),s([n({type:cc.Enum(c)})],h.prototype,"modeType",void 0),s([n({visible(){return this.modeType==c.Kawase}})],h.prototype,"kawaseIter",void 0),s([n],h.prototype,"_renderSize",void 0),s([n],h.prototype,"RenderSize",null),s([n({type:[l]})],h.prototype,"effectedList",void 0),h=s([o,a("Creatives/PPR2DBase"),r],h),i.default=h,cc._RF.pop()},{}],ParticleSystemCtrl:[function(e,t,i){"use strict";cc._RF.push(t,"4ae9dWqmNRFGobzy0uukGXm","ParticleSystemCtrl");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const o=e("./RepeatableBehavior"),{ccclass:n,property:a,menu:r}=cc._decorator;let c=class extends o.default{constructor(){super(...arguments),this.is3d=!1,this.rpType=o.RepeatableBehaviorType.Particle,this._behavior2d=null,this._behavior3d=null}start(){}CheckSubTypeLegal(){if(this.is3d){if(this._behavior3d||(this._behavior3d=this.effectNode.getComponent(cc.ParticleSystem3D)),this._behavior3d)return!0}else if(this._behavior2d||(this._behavior2d=this.effectNode.getComponent(cc.ParticleSystem)),this._behavior2d)return!0;return!1}SubAction(){this._living&&(this.is3d?(this._behavior3d.stop(),this._behavior3d.play()):this._behavior2d.resetSystem())}};s([a],c.prototype,"is3d",void 0),c=s([n,r("Creatives/Logics/ParticleSystemCtrl")],c),i.default=c,cc._RF.pop()},{"./RepeatableBehavior":"RepeatableBehavior"}],PoolRecycle:[function(e,t,i){"use strict";cc._RF.push(t,"26485oZ10NL3rJ6NnjMLJ5I","PoolRecycle");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const{ccclass:o,property:n}=cc._decorator;let a=class extends cc.Component{constructor(){super(...arguments),this._count=0,this.recyclePool=null}onLoad(){}onEnable(){this._count++}onPoolRecycle(){this.recyclePool?this.recyclePool.put(this.node):this.node.destroy()}};a=s([o],a),i.default=a,cc._RF.pop()},{}],PrintComponent:[function(e,t,i){"use strict";cc._RF.push(t,"b42d3oYlPRK9YxQ9S2EtK8g","PrintComponent"),Object.defineProperty(i,"__esModule",{value:!0}),i.PrintComponent=i.EventName=i.PlayerAction=void 0;const s=e("./StutterCheck");var o;(function(e){e.next="next",e.again="again",e.download="download",e.automatic_jump="automatic_jump"})(i.PlayerAction||(i.PlayerAction={})),function(e){e.loading="loading",e.game_start="game_start",e.game_end="game_end",e.actionbar="actionbar",e.interrupt="interrupt",e.game_touch="game_touch",e.stutter="stutter"}(o=i.EventName||(i.EventName={}));class n{static get stage(){return this.m_stage}static set stage(e){this.m_stage=e}static init(e,t=1){this.material=e,this.lastGameStartTime=0,this.totalGamesPlayed=1,this.isPlaying=!1,this.userId=this.getUserId(),this.uuid="uuid_"+Math.random().toString(36).substr(2,9),this.maxStage=t}static getUserId(){let e=window.document.getElementById("GameCanvas");return this.hashString(e.toDataURL("image/png")).toString()}static hashString(e){let t=0;for(let i of e)t=(t<<5)-t+i.charCodeAt(0);return t}static getCurrentDuration(){return parseInt((1e3*s.default.instance.totalDuration).toFixed(0))}static reportEvent(e,t={}){let i=Object.assign({material:this.material,media:this.media,appid:this.appid,user_id:this.userId,uuid:this.uuid},t);i.duration||(i.duration=this.getCurrentDuration(),0==i.duration&&(i.duration=1)),e==o.stutter&&window.gtag&&window.gtag("event",e,i),window.pba_send_msg&&window.pba_send_msg(e,i),console.log("report_log",e,i)}static loading(){this.reportCUid(),this.reportEvent(o.loading),s.default.instance}static reportCUid(){let e=Array.from({length:10},()=>Math.floor(10*Math.random())).join("");window.pba_init_cuid&&window.pba_init_cuid(e),console.log("report_log cuid:",e)}static startGame(){if(!this.isPlaying){this.isPlaying=!0,this.lastGameStartTime=Date.now();let e=++this.m_stage;e!=this.maxStage&&1!=this.maxStage||(e="final"),this.reportEvent(o.game_start,{stage:e,total_games_played:this.totalGamesPlayed}),this.m_gameStartTime=this.getCurrentDuration()}}static replay(){this.m_stage=0,++this.totalGamesPlayed}static game_interaction(e){this.reportEvent(o.game_touch,{type:e})}static endGame(e){if(this.isPlaying){this.isPlaying=!1;let t=this.m_stage;t!=this.maxStage&&1!=this.maxStage||(t="final"),this.reportEvent(o.game_end,{stage:t,total_games_played:this.totalGamesPlayed,value:e?"win":"lose",game_duration:this.getCurrentDuration()-this.m_gameStartTime})}}static actionbar(e){this.reportEvent(o.actionbar,{value:e})}static reportStutter(e){this.reportEvent(o.stutter,e)}}i.PrintComponent=n,n.media="moloco",n.material="",n.appid="TH",n.hasVoice_on=!1,n.m_stage=0,n.m_duration=0,n.m_gameStartTime=0,cc._RF.pop()},{"./StutterCheck":"StutterCheck"}],RangeFollowee:[function(e,t,i){"use strict";cc._RF.push(t,"96e43m0AoxIrpGR56Yq61RR","RangeFollowee");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const o=e("./Constant"),{ccclass:n,property:a}=cc._decorator;var r;(function(e){e.Idle="idle",e.Run="run",e.Tremble="tremble"})(r||(r={}));let c=class extends cc.Component{constructor(){super(...arguments),this.spine=null,this.rigid=null,this.follower=null,this.moveSpeed=0,this.followRange=40,this._thresRange=0,this._lastSpAni=r.Tremble,this._tmpVec2s=[cc.v2(),cc.v2(),cc.v2()],this._scaleTime=0}onLoad(){this._thresRange=.5*this.followRange,this.node.on(o.SetSpineAnimation,e=>{this.setAnimation(e)})}start(){}update(e){if(cc.isValid(this.follower)){this.follower.getPosition(this._tmpVec2s[0]),this.node.getPosition(this._tmpVec2s[1]),this._tmpVec2s[0].sub(this._tmpVec2s[1],this._tmpVec2s[2]);let t=this._tmpVec2s[2].mag();if(t<=this.followRange);else if(t>=this.followRange+this._thresRange){this.rigid.linearVelocity=this._tmpVec2s[2].normalizeSelf().mulSelf(.8*this.moveSpeed);let t=this._tmpVec2s[2].x<=0?-1:1;this._scaleTime>0&&(this._scaleTime-=e),this.node.scaleX!=t&&this._scaleTime<=0&&(this.node.scaleX=t,this._scaleTime=.1)}}}setAnimation(e){e!=this._lastSpAni&&(this.spine.setAnimation(0,e,!0),this._lastSpAni=e,e==r.Idle&&(this._tmpVec2s[2].x=0,this._tmpVec2s[2].y=0,this.rigid.linearVelocity=this._tmpVec2s[2]))}};s([a(sp.Skeleton)],c.prototype,"spine",void 0),s([a(cc.RigidBody)],c.prototype,"rigid",void 0),c=s([n],c),i.default=c,cc._RF.pop()},{"./Constant":"Constant"}],RepeatableBehavior:[function(e,t,i){"use strict";cc._RF.push(t,"6285fzmTd1Pt5IL5SlGtb2c","RepeatableBehavior");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0}),i.BehaviorSubItem=i.RepeatableBehaviorMode=i.RepeatableBehaviorType=void 0;const{ccclass:o,property:n}=cc._decorator;var a,r;(function(e){e[e.None=0]="None",e[e.Animations=1]="Animations",e[e.Spines=2]="Spines",e[e.Particle=3]="Particle",e[e.Particle2d=4]="Particle2d",e[e.Particle3d=5]="Particle3d",e[e.EventMessage=6]="EventMessage"})(a=i.RepeatableBehaviorType||(i.RepeatableBehaviorType={})),function(e){e[e.Simple=0]="Simple",e[e.Flexable=1]="Flexable"}(r=i.RepeatableBehaviorMode||(i.RepeatableBehaviorMode={}));let c=class{constructor(){this.index=0,this.triggerTikDuration=cc.v2(),this.itemName="",this.loop=!1}};s([n({type:cc.Integer,min:0})],c.prototype,"index",void 0),s([n(cc.Vec2)],c.prototype,"triggerTikDuration",void 0),s([n(cc.String)],c.prototype,"itemName",void 0),s([n(cc.Boolean)],c.prototype,"loop",void 0),c=s([o("BehaviorSubItem")],c),i.BehaviorSubItem=c;let l=class extends cc.Component{constructor(){super(...arguments),this.rpType=a.None,this.effectNode=null,this.rpMode=r.Simple,this.auto=!1,this.loop=!1,this.repeatTimes=1,this.delays=cc.v2(0,0),this.commandString="",this._orderPointsByAsc=!0,this.itemsList=[],this._repeatTimesLeft=0,this._living=!1,this._commandStr="",this._itemsListCursor=0,this._commandInfo={delayBefore:0,delayAfter:0,command:"",loop:!1},this._tweState={a:0},this._tweAction=cc.tween(this._tweState)}get TimCostAll(){if(this.itemsList.length<1)return 0;let e=0;return this.itemsList.forEach(t=>{e+=t.triggerTikDuration.x,e+=t.triggerTikDuration.y}),e}get OrderPointsByAsc(){return this._orderPointsByAsc}set OrderPointsByAsc(e){this._orderPointsByAsc=e,this._orderPointsByIndexAsc(this._orderPointsByAsc)}onLoad(){}onEnable(){this._checkLeagl()&&(this._repeatTimesLeft=this.repeatTimes,this._living=!0,this._itemsListCursor=0,this.auto&&(this._setInfo(),this._execSimpleSeq()))}onDisable(){this._living=!1}_setInfo(){switch(this.rpMode){case r.Simple:this._commandInfo.delayBefore=this.delays.x,this._commandInfo.delayAfter=this.delays.y,this._commandInfo.command=this.commandString;break;case r.Flexable:this._commandInfo.delayBefore=this.itemsList[this._itemsListCursor].triggerTikDuration.x,this._commandInfo.delayAfter=this.itemsList[this._itemsListCursor].triggerTikDuration.y,this._commandInfo.command=this.itemsList[this._itemsListCursor].itemName,this._commandInfo.loop=this.itemsList[this._itemsListCursor].loop}}_execSimpleSeq(){this._setInfo(),this._execSimple(),this.scheduleOnce(()=>{switch(this.rpMode){case r.Simple:this._repeatTimesLeft--;break;case r.Flexable:this._itemsListCursor++,this._itemsListCursor>=this.itemsList.length&&(this._repeatTimesLeft--,this._itemsListCursor=0)}this.loop&&(this._repeatTimesLeft=1),!this._living||this._repeatTimesLeft<1||this._execSimpleSeq()},this._commandInfo.delayBefore+this._commandInfo.delayAfter)}_execSimple(){this.scheduleOnce(()=>{this._living&&this.SubAction()},this._commandInfo.delayBefore)}_checkLeagl(){return this.effectNode?this.rpType==a.None?(console.log("unknow rtype"),!1):!!this.CheckSubTypeLegal()||(console.log("unknown efNod"),!1):(console.log("lack efNod"),!1)}_orderPointsByIndexAsc(e){e?this.itemsList.sort((e,t)=>e.index-t.index):this.itemsList.sort((e,t)=>t.index-e.index)}CheckSubTypeLegal(){return!1}SubAction(){}};s([n({type:cc.Enum(a),readonly:!0})],l.prototype,"rpType",void 0),s([n(cc.Node)],l.prototype,"effectNode",void 0),s([n({type:cc.Enum(r)})],l.prototype,"rpMode",void 0),s([n],l.prototype,"auto",void 0),s([n({})],l.prototype,"loop",void 0),s([n({type:cc.Integer,min:1,visible(){return!this.loop}})],l.prototype,"repeatTimes",void 0),s([n({visible(){return this.rpMode==r.Simple}})],l.prototype,"delays",void 0),s([n({visible(){return this.rpMode==r.Simple}})],l.prototype,"commandString",void 0),s([n({visible(){return this.rpMode==r.Flexable}})],l.prototype,"TimCostAll",null),s([n],l.prototype,"_orderPointsByAsc",void 0),s([n({visible(){return this.rpMode==r.Flexable}})],l.prototype,"OrderPointsByAsc",null),s([n({type:[c],visible(){return this.rpMode==r.Flexable}})],l.prototype,"itemsList",void 0),l=s([o],l),i.default=l,cc._RF.pop()},{}],ScreenRecorder:[function(e,t,i){"use strict";cc._RF.push(t,"2a716dtfyNKgK120ueHyjPI","ScreenRecorder");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const{ccclass:o,property:n}=cc._decorator;let a=class extends cc.Component{constructor(){super(...arguments),this.inUse=!0,this.recorder=null,this._textReported=!0,this._videoReported=!0}onLoad(){if(!this.inUse)return;const e=window.location.href;if(e.includes("localhost")||e.includes("fallenmaple")||e.includes("luobinfenglin"))try{var t=cc.game.canvas.captureStream(),i=cc.sys.__audioSupport.context,s=i.createMediaStreamDestination();const e=AudioContext.prototype.createBufferSource;AudioContext.prototype._createBufferSource=e,AudioContext.prototype.createBufferSource=function(){var e=this._createBufferSource();return e.connect(s),e};var o=i.createOscillator();o.type="square",o.frequency.value=0,o.connect(i.destination),o.connect(s),o.start(),o.stop(i.currentTime+.1),t.addTrack(s.stream.getAudioTracks()[0]);const c=function(){const e=["vp9","vp9.0","vp8","vp8.0","h265","h.265","h264","h.264","avc1","av1","opus"],t=[];return["webm","mp4","ogg","x-matroska"].forEach(i=>{const s=`video/${i}`;e.forEach(e=>{[`${s};codecs=${e}`,`${s};codecs:${e}`,`${s};codecs=${e.toUpperCase()}`,`${s};codecs:${e.toUpperCase()}`,`${s}`].forEach(e=>{MediaRecorder.isTypeSupported(e)&&t.push(e)})})}),t}();var n=new MediaRecorder(t,{mimeType:c[0]});this.recorder=n;var a=[];n.addEventListener("dataavailable",e=>{a.push(e.data)}),n.addEventListener("stop",()=>{if(this._videoReported)return;this._videoReported=!0;var e=new Blob(a,{type:a[0].type}),t=URL.createObjectURL(e),i=document.createElement("a");i.href=t;let s=window.location.href.split("/");i.download=s[s.length-1]+"_"+(new Date).getTime()+".webm",i.click()}),document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState&&"inactive"!=n.state&&n.pause(),"visible"===document.visibilityState&&"inactive"!=n.state&&n.resume()}),document.addEventListener("keydown",e=>{e.ctrlKey&&"0"==e.key&&(n.stop(),e.preventDefault())},!0),window.onerror=(e,t,i,s,o)=>{if(this._textReported)return;this._textReported=!0;const a={message:`${e}`,source:`${t}`,lineno:i,colno:s,error:o?{name:`${o.name}`,message:`${o.message}`,stack:`${o.stack||"\u65e0\u5806\u6808\u4fe1\u606f"}`}:"\u65e0\u9519\u8bef\u5bf9\u8c61"},r=JSON.stringify(a,null,2),c=new Blob([r],{type:"text/plain"});var l=URL.createObjectURL(c),h=document.createElement("a");h.href=l;let d=window.location.href.split("/");return h.download=d[d.length-1]+"_"+(new Date).getTime()+".txt",h.click(),setTimeout(()=>{n.stop()},2e3),!1},n.start()}catch(r){console.error(r)}}stopRecorder(){try{null!=this.recorder&&this.recorder.stop()}catch(e){console.error(e)}}};s([n],a.prototype,"inUse",void 0),a=s([o],a),i.default=a,cc._RF.pop()},{}],SkeletonExt:[function(e,t){"use strict";cc._RF.push(t,"c661aYQnidI+qU7BzGNr8j5","SkeletonExt"),cc.game.once(cc.game.EVENT_ENGINE_INITED,function(){cc.js.mixin(sp.Skeleton.prototype,{update:function(e){if(!this.paused)if(e*=this.timeScale*sp.timeScale,this.isAnimationCached()){if(this._isAniComplete){if(0===this._animationQueue.length&&!this._headAniInfo){var t=this._frameCache;if(t&&t.isInvalid()){t.updateToFrame();var i=t.frames;this._curFrame=i[i.length-1]}return}if(this._headAniInfo||(this._headAniInfo=this._animationQueue.shift()),this._accTime+=e,this._accTime>this._headAniInfo.delay){var s=this._headAniInfo;this._headAniInfo=null,this.setAnimation(0,s.animationName,s.loop)}return}this._updateCache(e)}else this._updateRealtime(e)}})}),cc._RF.pop()},{}],SortZIndex:[function(e,t,i){"use strict";cc._RF.push(t,"8b5be8jZ6hIZqzBcD2gQJK2","SortZIndex");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const{ccclass:o,property:n}=cc._decorator;let a=class extends cc.Component{constructor(){super(...arguments),this.refreshRate=0,this.listenPosChangeNodes=[],this._posChangeRefreshFlag=!1,this.includeInactive=!1,this.xyWeights=cc.v2(0,1),this.children=[],this.accumulatedTime=0,this.updateScheduled=!1,this._totalWeight=0,this._xyWeights=cc.v2(0,1)}onLoad(){this._totalWeight=Math.abs(this.xyWeights.x)+Math.abs(this.xyWeights.y),this._xyWeights.x=this.xyWeights.x/this._totalWeight,this._xyWeights.y=this.xyWeights.y/this._totalWeight,0===this.refreshRate?this.initEfficientMode():this.initTimerMode()}initTimerMode(){this.collectChildren()}initEfficientMode(){this.positionChangedCallback=()=>this._posChangeRefreshFlag=!0,this.node.on(cc.Node.EventType.CHILD_ADDED,this.onChildAdded,this),this.node.on(cc.Node.EventType.CHILD_REMOVED,this.onChildRemoved,this),this.listenPosChangeNodes.forEach(e=>this.registerPositionListener(e)),this.collectChildren(),this.updateZIndex()}onChildAdded(e,t=!1){t&&this.registerPositionListener(e),this.collectChildren(),this.scheduleOnceUpdate()}onChildRemoved(e){this.unregisterPositionListener(e),this.collectChildren(),this.scheduleOnceUpdate()}collectChildren(){this.children=this.includeInactive?this.node.children.slice():this.node.children.filter(e=>e.active)}registerPositionListener(e){e.on("position-changed",this.positionChangedCallback,this)}unregisterPositionListener(e){e.off("position-changed",this.positionChangedCallback,this)}scheduleOnceUpdate(){this.updateScheduled||(this.updateScheduled=!0,this.scheduleOnce(()=>{this.updateZIndex(),this.updateScheduled=!1}))}update(e){if(0===this.refreshRate)return;this.accumulatedTime+=e;const t=1/this.refreshRate;this.accumulatedTime>=t&&(this.updateZIndex(),this.accumulatedTime=0)}lateUpdate(e){this._posChangeRefreshFlag&&(this._posChangeRefreshFlag=!1,this.scheduleOnceUpdate())}updateZIndex(){(0===this.refreshRate?this.children:this.includeInactive?this.node.children:this.node.children.filter(e=>e.active)).sort((e,t)=>this._xyWeights.x*(t.x-e.x)+this._xyWeights.y*(t.y-e.y)).forEach((e,t)=>{e.zIndex=t})}onDestroy(){0===this.refreshRate&&(this.node.off(cc.Node.EventType.CHILD_ADDED,this.onChildAdded,this),this.node.off(cc.Node.EventType.CHILD_REMOVED,this.onChildRemoved,this),this.node.off(cc.Node.EventType.CHILD_REORDER,this.collectChildren,this),this.children.forEach(e=>this.unregisterPositionListener(e)))}};s([n({tooltip:!1})],a.prototype,"refreshRate",void 0),s([n({type:[cc.Node],tooltip:!1,visible(){return 0===this.refreshRate}})],a.prototype,"listenPosChangeNodes",void 0),s([n({tooltip:!1})],a.prototype,"includeInactive",void 0),s([n({tooltip:!1})],a.prototype,"xyWeights",void 0),a=s([o],a),i.default=a,cc._RF.pop()},{}],SpineAnimationCtrl:[function(e,t,i){"use strict";cc._RF.push(t,"155fdjs33lChJCnBYMog90Y","SpineAnimationCtrl");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const o=e("./RepeatableBehavior"),{ccclass:n,property:a,menu:r}=cc._decorator;let c=class extends o.default{constructor(){super(...arguments),this.spLoop=!1,this.rpType=o.RepeatableBehaviorType.Spines,this._behavior=null}start(){}CheckSubTypeLegal(){return this._behavior||(this._behavior=this.effectNode.getComponent(sp.Skeleton)),!!this._behavior}SubAction(){this._living&&this._behavior.setAnimation(0,this._commandInfo.command,this.spLoop)}};s([a],c.prototype,"spLoop",void 0),c=s([n,r("Creatives/Logics/SpineAnimationCtrl")],c),i.default=c,cc._RF.pop()},{"./RepeatableBehavior":"RepeatableBehavior"}],StutterCheck:[function(e,t,i){"use strict";cc._RF.push(t,"ae6013O6UZNjoZgMe69rvQN","StutterCheck");var s,o=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const n=e("./PrintComponent"),{ccclass:a,property:r}=cc._decorator;let c=s=class extends cc.Component{constructor(){super(...arguments),this.m_fps=.016,this.m_totalDuration=0,this.m_isGameStart=!1,this.m_pd_duration=0,this.avgDT=1/60,this.pd_big_jank_count=0,this.pd_big_jank_time=0,this.pd_small_jank_count=0,this.pd_small_jank_time=0,this.frameCount=0,this.fpsList=[],this.pd_fps_10_jank_count=0}static get instance(){if(!this._instance){let e=new cc.Node("StutterCheck");cc.director.getScene().addChild(e),this._instance=e.addComponent(s)}return this._instance}start(){this.m_fps=parseFloat((1/cc.game.getFrameRate()).toFixed(3))}get totalDuration(){return this.m_totalDuration}startReport(){this.m_isGameStart=!0,this.schedule(()=>{this.reportStutter()},10)}stopReport(){this.m_isGameStart=!1,this.unscheduleAllCallbacks()}update(e){if(this.m_totalDuration+=e,this.m_isGameStart){if(this.frameCount++,e>2*this.avgDT&&e>.125&&(this.pd_big_jank_count++,this.pd_big_jank_time+=1e3*e),e>2*this.avgDT&&e>.08333&&(this.pd_small_jank_count++,this.pd_small_jank_time+=1e3*e),e>0){const t=1/e;this.fpsList.push(t),t<10&&this.pd_fps_10_jank_count++}this.m_pd_duration+=e}}getPercentile(e,t){if(0===e.length)return 0;const i=e.slice().sort((e,t)=>e-t),s=Math.ceil(t*i.length)-1;return i[Math.max(0,Math.min(s,i.length-1))]}reportStutter(){const e=this.fpsList,t=e.length>0?e.reduce((e,t)=>e+t,0)/e.length:0;let i={pd_duration:Math.ceil(1e3*this.m_pd_duration),pd_big_jank_count:this.pd_big_jank_count,pd_big_jank_time:Number(this.pd_big_jank_time.toFixed(2)),pd_small_jank_count:this.pd_small_jank_count,pd_small_jank_time:Number(this.pd_small_jank_time.toFixed(2)),pd_fps_0_1:Math.ceil(this.getPercentile(e,.001)),pd_fps_01:Math.ceil(this.getPercentile(e,.01)),pd_fps_10:Math.ceil(this.getPercentile(e,.1)),pd_fps_20:Math.ceil(this.getPercentile(e,.2)),pd_fps_30:Math.ceil(this.getPercentile(e,.3)),pd_fps_50:Math.ceil(this.getPercentile(e,.5)),pd_fps:Math.round(t),pd_logic_module_tag:`stage-${n.PrintComponent.stage}`,pd_fps_10_jank_count:this.pd_fps_10_jank_count};this.m_pd_duration=0,this.pd_big_jank_count=0,this.pd_big_jank_time=0,this.pd_small_jank_count=0,this.pd_small_jank_time=0,this.frameCount=0,this.pd_fps_10_jank_count=0,this.fpsList=[],n.PrintComponent.reportStutter(i)}};c._instance=null,c=s=o([a],c),i.default=c,cc._RF.pop()},{"./PrintComponent":"PrintComponent"}],SwordsMan:[function(e,t,i){"use strict";cc._RF.push(t,"eea7d9ReYJGSKXfATTz57FJ","SwordsMan");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const o=e("../Framework/Management/MgrMain"),n=e("../Framework/utils/utils"),a=e("./Alley"),r=e("./Constant"),c=e("./EnemyInit"),l=e("./InGaming"),{ccclass:h,property:d}=cc._decorator;let p=class extends a.default{constructor(){super(...arguments),this.isAtking=!1,this._atkSpan=r.SwordsmanAtkSpan,this._atkSearchRange=r.SwordsmanAtkSearchRange,this._atkRange=r.SwordsmanAtkRange,this._atkAniDelay=r.SwordsmanAtkAniDelay,this._atkTarget=null,this._endStandPos=cc.v2()}onLoad(){super.onLoad(),this._onAtk=()=>{this._lastSpAni=a.AlleySpAnis.Idle,this.onAtk()}}start(){super.start()}update(e){if(!this.isAtking&&!this.isDead)if(cc.isValid(this._atkTarget)&&!this._atkTarget.isDead)if(this.node.getPosition(this._tmpVec2s[0]),this._atkTarget.node.getPosition(this._tmpVec2s[1]),this._tmpVec2s[1].subSelf(this._tmpVec2s[0]),this._tmpVec2s[1].mag()<=this._atkRange)this.rigid.linearVelocity=cc.Vec2.ZERO_R,this.onDoAtk();else{let e=this._tmpVec2s[1].x>=0?1:-1;if(this.node.scaleX=e,cc.isValid(this.hpNode)){let e=Math.abs(this.hpNode.scaleX);this.hpNode.scaleX=this._tmpVec2s[1].x>=0?e:-e}this.rigid.linearVelocity=this._tmpVec2s[1].normalizeSelf().mulSelf(r.SwordsmanMoveSpeed)}else this._lastSpAni!=a.AlleySpAnis.Atk&&(this._atkTarget=null,this.isRunning=!1,this.setAnimation(a.AlleySpAnis.Idle),this.onAtk())}onScheduleAtk(){this.isRunning=!1,this.getComponent(cc.PhysicsCollider).sensor=!1,this.scheduleOnce(this._onAtk,this._atkSpan)}onAtk(){if(this.isRunning||this.isDead)return void this.unschedule(this._onAtk);this.isAtking=!1;let e=null;if(null==e){const t=c.default.Instance.enemys;let i=n.Utils.RandomRangeInt(0,t.length);for(let s=0;s<t.length;s++){let o=(s+i)%t.length;if(cc.isValid(t[o])&&!t[o].isDead&&(t[o].node.getPosition(this._tmpVec2s[1]),this._tmpVec2s[1].subSelf(this._endStandPos),this._tmpVec2s[1].mag()<=this._atkSearchRange)){e=t[o];break}}}null==e||this._tmpVec2s[1].equals(cc.Vec2.ZERO_R)||(this._atkTarget=e,this.isRunning=!0,this.setAnimation(a.AlleySpAnis.Run))}onDoAtk(){if(this.isAtking||this.isDead)return;this.isAtking=!0,o.default.Instance.MgrAudio.forcePlayMusic(1),this.isRunning=!1,this.setAnimation(a.AlleySpAnis.Atk,!1);let e=this._atkTarget;this.scheduleOnce(()=>{cc.isValid(e)&&!e.isDead&&e.onHit(this.hurt)},this._atkAniDelay),this.spine.addAnimation(0,a.AlleySpAnis.Idle,!0),this._atkTarget=null,this.onScheduleAtk()}onMoveDestination(e,t=!0){super.onMoveDestination(e,t),e.children[e.childrenCount-1].convertToWorldSpaceAR(cc.Vec2.ZERO_R,this._tmpVec2s[0]),l.default.Instance.mapNode.convertToNodeSpaceAR(this._tmpVec2s[0],this._tmpVec2s[1]),this._endStandPos=this._tmpVec2s[1].clone()}};p=s([h],p),i.default=p,cc._RF.pop()},{"../Framework/Management/MgrMain":"MgrMain","../Framework/utils/utils":"utils","./Alley":"Alley","./Constant":"Constant","./EnemyInit":"EnemyInit","./InGaming":"InGaming"}],SyncRigidPosition:[function(e,t,i){"use strict";cc._RF.push(t,"9f009zzldNArZwtPR1ZYc3U","SyncRigidPosition");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const{ccclass:o,property:n}=cc._decorator;let a=class extends cc.Component{onLoad(){}start(){}};a=s([o],a),i.default=a,cc._RF.pop()},{}],TweenExt:[function(e,t){"use strict";cc._RF.push(t,"0fd836ccl1OF6rVi5hAOwr1","TweenExt");{const e=cc.Tween.prototype.to;cc.Tween.prototype.to=function(t,i,s){if(t<0){for(const e in i)this._target[e]=i[e];return this.set(i)}return e.call(this,t,i,s)},cc.ActionInterval.prototype.step=function(e){if(this.paused)return;this._firstTick&&!this._goto?(this._firstTick=!1,this._elapsed=0):this._elapsed+=e;let t=this._elapsed/(this._duration>1.192092896e-7?this._duration:1.192092896e-7);t=1>t?t:1,this.update(t>0?t:0),this._repeatMethod&&this._timesForRepeat>1&&this.isDone()&&(this._repeatForever||this._timesForRepeat--,this.startWithTarget(this.target),this.step(this._elapsed-this._duration))},cc.Tween.prototype.pause=function(){this._finalAction.paused=!0},cc.Tween.prototype.resume=function(){this._finalAction.paused=!1},cc.Tween.prototype.speed=function(e){this._finalAction._speedMethod=!0,this._finalAction._speed=e},cc.Tween.prototype.duration=function(){return this._finalAction._duration},cc.Tween.prototype.elapsed=function(){return this._finalAction._elapsed},cc.Tween.prototype.goto=function(e){this._finalAction._goto=!0,this._finalAction._elapsed=e},cc.ActionManager.prototype.pauseByTag=function(e,t){e===cc.Action.TAG_INVALID&&cc.logID(1002);let i=this._hashTargets;for(let s in i){let o=i[s];for(let i=0,s=o.actions.length;i<s;++i){let s=o.actions[i];if(s&&s.getTag()===e){s.paused=t;break}}}},cc.Tween.pauseByTag=function(e){cc.director.getActionManager().pauseByTag(e,!0)},cc.Tween.resumeByTag=function(e){cc.director.getActionManager().pauseByTag(e,!1)}}cc._RF.pop()},{}],ViewAdapter:[function(e,t,i){"use strict";cc._RF.push(t,"adea7ZTy7NHXZlNTDEVYVtU","ViewAdapter");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0}),i.ViewDataSet=void 0;const o=e("../Management/MgrMain"),{ccclass:n,property:a,executeInEditMode:r}=cc._decorator;let c=class{constructor(){this._target=null,this.posScale=new cc.Vec4(0,0,0,1),this.eulers=cc.v3(),this.useActive=!1}get target(){return this._target}set target(e){if(this._target=e,this.posScale.x=e.x,this.posScale.y=e.y,this.posScale.z=e.z,this.posScale.w=e.scale,e.is3DNode){let t=cc.quat();e.getRotation(t),t.toEuler(this.eulers)}else this.eulers.x=e.angle}};s([a(cc.Node)],c.prototype,"_target",void 0),s([a(cc.Node)],c.prototype,"target",null),s([a({tooltip:!1})],c.prototype,"posScale",void 0),s([a({tooltip:!1})],c.prototype,"eulers",void 0),s([a({tooltip:!1})],c.prototype,"useActive",void 0),c=s([n("ViewDataSet")],c),i.ViewDataSet=c;let l=class extends cc.Component{constructor(){super(...arguments),this.msgTrigger=!1,this.msgTest=null,this.viewAreaDebug=null,this.eventNodes=[],this.OResolution=new cc.Size(1138,859),this.canvasNodes=[],this.viewsNodes=[],this._isPreviewLand=!0,this._landDataSets=[],this._portDataSets=[],this.BgFrame=[],this.NeedToRefresh=[],this._landscape=!0,this._strTest="",this._cSize=cc.size(0,0),this._inited=!1,this._scaleFactor=1,this._modScale=1,this._viewValidSiz=cc.v2(),this._viewValidScal=1,this._tmpQuat=cc.quat()}get isPreviewLand(){return this._isPreviewLand}set isPreviewLand(e){this._isPreviewLand=e,this.canvasNodes.forEach(t=>t.setContentSize(e?this.OResolution.width:this.OResolution.height,e?this.OResolution.height:this.OResolution.width)),this._alignDataSets(),this._refinePosScaleRotActive(e)}get storeDataSets(){return!1}set storeDataSets(e){this._storeDataSets()}get landDataSets(){return this._landDataSets}set landDataSets(e){this._landDataSets=e}get portDataSets(){return this._portDataSets}set portDataSets(e){this._portDataSets=e}onLoad(){cc.view.setResizeCallback(()=>{this.screenRotation()}),this._cSize=cc.view.getVisibleSize()}start(){this.viewAreaDebug.active=!1,this.screenRotation()}screenRotation(){this._cSize=cc.view.getVisibleSize(),this._landscape=this._cSize.width>this._cSize.height,this._modScale=this._landscape?this._cSize.width/this._cSize.height:this._cSize.height/this._cSize.width,console.log("plat ",cc.sys.os);let e=new cc.ResolutionPolicy(cc.ContainerStrategy.EQUAL_TO_FRAME,cc.ContentStrategy.EXACT_FIT);switch(this._landscape){case!0:e.setContentStrategy(cc.ContentStrategy.FIXED_WIDTH),cc.view.setDesignResolutionSize(this.OResolution.width,this.OResolution.height,e),this._sizePrev=cc.size(this.OResolution.width,this.OResolution.height),this.viewAreaDebug.angle=0;break;case!1:e.setContentStrategy(cc.ContentStrategy.FIXED_HEIGHT),cc.view.setDesignResolutionSize(this.OResolution.height,this.OResolution.width,e),this._sizePrev=cc.size(this.OResolution.height,this.OResolution.width),this.viewAreaDebug.angle=90}cc.Canvas.instance.node.getComponent(cc.Widget).updateAlignment(),this._cSize=cc.view.getVisibleSize();let t=cc.Canvas.instance.node.getContentSize();this._scaleFactor=this._landscape?t.width/this.OResolution.width:this._cSize.height/this.OResolution.width,this._modScale>1.778125&&(this._scaleFactor=this._landscape?t.height/this.OResolution.height:this._cSize.width/this.OResolution.height),o.default.scaleFactor=this._scaleFactor,this.canvasNodes.forEach(e=>{e.setPosition(cc.Canvas.instance.node.getPosition()),e.setContentSize(this._sizePrev.width,this._sizePrev.height),e.setScale(this._scaleFactor)}),this.viewsNodes.forEach(e=>{e.setPosition(cc.Canvas.instance.node.getPosition()),e.setContentSize(this._cSize.width,this._cSize.height)}),this._refinePosScaleRotActive(this._landscape),o.default.Instance.FrameSizeChanged(this._landscape),this.NeedToRefresh.forEach(e=>{e.emit(cc.Node.EventType.SIZE_CHANGED),console.log("nn ",e.name)})}_refinePosScaleRotActive(e){this.viewAreaDebug.angle=e?0:90,(e?this.landDataSets:this.portDataSets).forEach(t=>{cc.isValid(t.target)&&(t.target.setPosition(t.posScale.x,t.posScale.y,t.posScale.z),t.target.setScale(t.posScale.w),t.target.is3DNode?(this._tmpQuat.fromEuler(t.eulers),t.target.setRotation(this._tmpQuat)):t.target.angle=t.eulers.x,t.useActive&&(t.target.getChildByName("land").active=e,t.target.getChildByName("port").active=!e))})}_checkRatioScale(){cc.view.getCanvasSize(),this._landscape=this._cSize.width>this._cSize.height;let e=this._landscape?this._cSize.width/this._cSize.height:this._cSize.height/this._cSize.width;this._sizePrev=this.OResolution,e>=2&&(this._sizePrev.width=this.OResolution.height*e,this._scaleBgFrame())}_scaleBgFrame(){this._viewValidSiz=cc.v2(cc.view.getVisibleSize().width,cc.view.getVisibleSize().height),this._landscape?this._viewValidScal=this._viewValidSiz.x/this.OResolution.height:this._viewValidScal=this._viewValidSiz.y/this.OResolution.width,this.BgFrame.forEach(e=>{e.setScale(this._viewValidScal)})}_alignDataSets(){let e=this.landDataSets.length>this.portDataSets.length?this.landDataSets:this.portDataSets,t=this.landDataSets.length<=this.portDataSets.length?this.landDataSets:this.portDataSets;for(let i=0;i<e.length;i++){let s=e[i],o=t[i];o||(o=new c,t[i]=o),s.target!=o.target&&(o.target=s.target,o.posScale.set(s.posScale),o.eulers.set(s.eulers),o.useActive=s.useActive)}}_storeDataSets(){(this.isPreviewLand?this.landDataSets:this.portDataSets).forEach(e=>{cc.isValid(e.target)&&(e.posScale.x=e.target.x,e.posScale.y=e.target.y,e.posScale.z=e.target.z,e.posScale.w=e.target.scale,e.target.is3DNode?(e.target.getRotation(this._tmpQuat),this._tmpQuat.toEuler(e.eulers)):e.eulers.x=e.target.angle)})}};s([a],l.prototype,"msgTrigger",void 0),s([a(cc.Label)],l.prototype,"msgTest",void 0),s([a(cc.Node)],l.prototype,"viewAreaDebug",void 0),s([a([cc.Node])],l.prototype,"eventNodes",void 0),s([a],l.prototype,"OResolution",void 0),s([a([cc.Node])],l.prototype,"canvasNodes",void 0),s([a([cc.Node])],l.prototype,"viewsNodes",void 0),s([a],l.prototype,"_isPreviewLand",void 0),s([a],l.prototype,"isPreviewLand",null),s([a],l.prototype,"storeDataSets",null),s([a],l.prototype,"_landDataSets",void 0),s([a({type:[c],visible:function(){return this._isPreviewLand}})],l.prototype,"landDataSets",null),s([a],l.prototype,"_portDataSets",void 0),s([a({type:[c],visible:function(){return!this._isPreviewLand}})],l.prototype,"portDataSets",null),s([a([cc.Node])],l.prototype,"BgFrame",void 0),s([a([cc.Node])],l.prototype,"NeedToRefresh",void 0),l=s([n],l),i.default=l,cc._RF.pop()},{"../Management/MgrMain":"MgrMain"}],WorkerRepair:[function(e,t,i){"use strict";cc._RF.push(t,"0d968yK1XFMv7EboWrW3Fkb","WorkerRepair");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const o=e("./Alley"),n=e("./Constant"),a=e("./InGaming"),{ccclass:r,property:c}=cc._decorator;let l=class extends o.default{constructor(){super(...arguments),this._routeParent=null,this.movePoints=[cc.v2(),cc.v2(),cc.v2(),cc.v2(),cc.v2(),cc.v2(),cc.v2()],this.isRepairing=!1,this._time=0}onLoad(){super.onLoad()}start(){super.start()}update(e){this.isDead||this.isRepairing||(this._time+=e,this._time>=n.FenceBuildTime&&this.onAtk())}onScheduleAtk(){this.onAtk()}onMoveDestination(e,t=!0){this.node.getPosition(this.movePoints[0]),this.onAtk()}onAtk(){if(this.isDead)return;const e=a.default.Instance.fences.sort((e,t)=>t.buildPriority-e.buildPriority);if(e.length<=0)return;this.isRepairing=!0;let t=0;for(t=0;t<e.length;t++)if(cc.isValid(e[t])&&!e[t].node.active&&!e[t].isBuilding){let i=e[t];i.node.active=!0,i.isBuilding=!0,this.node.getPosition(this._tmpVec2s[0]),i.node.getPosition(this._tmpVec2s[1]),this._tmpVec2s[1].sub(this._tmpVec2s[0],this._tmpVec2s[2]);let s=this._tmpVec2s[2].x>=0?1:-1;this.setAnimation(o.AlleySpAnis.Run),cc.tween(this.node).call(()=>this.node.scaleX=s).to(this._tmpVec2s[2].mag()/n.AlleyMoveSpeed,{x:this._tmpVec2s[1].x,y:this._tmpVec2s[1].y}).call(()=>{this.setAnimation(o.AlleySpAnis.Work,!0),cc.isValid(i)&&i.onStartBuild()}).delay(n.FenceBuildTime).call(()=>{this.setAnimation(o.AlleySpAnis.Idle),this.onAtk()}).start();break}if(t==e.length){for(t=0;t<e.length;t++)if(cc.isValid(e[t])&&!e[t].isBuilding&&e[t].level<a.default.Instance.fenceMaxLevel){let i=e[t];if(!i.name.includes("Fence"))continue;i.isBuilding=!0,this.node.getPosition(this._tmpVec2s[0]),i.node.getPosition(this._tmpVec2s[1]),this._tmpVec2s[1].sub(this._tmpVec2s[0],this._tmpVec2s[2]);let s=this._tmpVec2s[2].x>=0?1:-1;this.setAnimation(o.AlleySpAnis.Run),cc.tween(this.node).call(()=>this.node.scaleX=s).to(this._tmpVec2s[2].mag()/n.AlleyMoveSpeed,{x:this._tmpVec2s[1].x,y:this._tmpVec2s[1].y}).call(()=>{this.setAnimation(o.AlleySpAnis.Work,!0),cc.isValid(i)&&(i.onUpgrade(),i.onStartBuild())}).delay(n.FenceRepairTime).call(()=>{this.setAnimation(o.AlleySpAnis.Idle),this.onAtk()}).start();break}if(t==e.length){for(t=0;t<e.length;t++)if(cc.isValid(e[t])&&e[t].hp<e[t].maxHp&&!e[t].isRepairing){let i=e[t];i.isRepairing=!0,this.node.getPosition(this._tmpVec2s[0]),i.node.getPosition(this._tmpVec2s[1]),this._tmpVec2s[1].sub(this._tmpVec2s[0],this._tmpVec2s[2]);let s=this._tmpVec2s[2].x>=0?1:-1;this.setAnimation(o.AlleySpAnis.Run),cc.tween(this.node).call(()=>this.node.scaleX=s).to(this._tmpVec2s[2].mag()/n.AlleyMoveSpeed,{x:this._tmpVec2s[1].x,y:this._tmpVec2s[1].y}).call(()=>{this.setAnimation(o.AlleySpAnis.Work,!0),cc.isValid(i)&&i.onRepair()}).delay(n.FenceRepairTime).call(()=>{this.setAnimation(o.AlleySpAnis.Idle),this.onAtk()}).start();break}if(t==e.length){this._time=0,this.isRepairing=!1,this.node.getPosition(this._tmpVec2s[0]),this._tmpVec2s[1].set(this.movePoints[0]),this._tmpVec2s[1].sub(this._tmpVec2s[0],this._tmpVec2s[2]);let e=this._tmpVec2s[2].x>=0?1:-1;this.setAnimation(o.AlleySpAnis.Run),cc.tween(this.node).call(()=>this.node.scaleX=e).to(this._tmpVec2s[2].mag()/n.AlleyMoveSpeed,{x:this._tmpVec2s[1].x,y:this._tmpVec2s[1].y}).call(()=>{this.setAnimation(o.AlleySpAnis.Idle,!0)}).start()}}}}stopActions(){super.stopActions(),this.node.stopAllActions()}};l=s([r],l),i.default=l,cc._RF.pop()},{"./Alley":"Alley","./Constant":"Constant","./InGaming":"InGaming"}],WorkerStone:[function(e,t,i){"use strict";cc._RF.push(t,"6f2b7WyD9lKCrX56h3lfRqH","WorkerStone");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const o=e("../Framework/Management/MgrMain"),n=e("./Alley"),a=e("./Constant"),r=e("./DropCoin"),c=e("./Factory"),l=e("./InGaming"),h=e("./InitStones"),{ccclass:d,property:p}=cc._decorator;let u=class extends n.default{constructor(){super(...arguments),this.collectNode=null,this._routeParent=null,this.collectCount=0,this.maxCollectCount=a.MaxWorkerCollectCount,this.movePoints=[cc.v2(),cc.v2(),cc.v2(),cc.v2(),cc.v2(),cc.v2(),cc.v2(),cc.v2(),cc.v2(),cc.v2(),cc.v2()],this.movePointsIdx=0,this.isBacking=!1,this._atkRange=2*a.WorkerCollectRange,this._atkAniDelay=a.WorkerAtkAniDelay,this._collectTarget=null}onLoad(){super.onLoad()}start(){super.start(),this.collectNode=this.node.getChildByName("collects"),this.collectNode.children.forEach((e,t)=>e.active=t<this.collectCount)}update(e){this.isDead||cc.isValid(this._collectTarget)&&(this.node.getPosition(this._tmpVec2s[0]),this._collectTarget.node.getPosition(this._tmpVec2s[1]),this._tmpVec2s[1].subSelf(this._tmpVec2s[0]),this._tmpVec2s[1].mag()<=this._atkRange?(this.rigid.linearVelocity=cc.Vec2.ZERO_R,this.onDoAtk()):(this.node.scaleX=this._tmpVec2s[1].x>=0?1:-1,this.rigid.linearVelocity=this._tmpVec2s[1].normalizeSelf().mulSelf(a.AlleyMoveSpeed)))}onScheduleAtk(){this.onAtk()}onAtk(){if(this.isRunning||this.isDead)return void this.unschedule(this._onAtk);let e=null,t=h.default.Instance.stoneItems,i=0,s=9999;this.node.getPosition(this._tmpVec2s[0]);for(let o=0;o<t.length;o++)if(cc.isValid(t[o])&&t[o].resStatus==a.ResourceStatus.Able){t[o].node.getPosition(this._tmpVec2s[1]),this._tmpVec2s[1].subSelf(this._tmpVec2s[0]);let e=this._tmpVec2s[1].mag();e<s&&(i=o,s=e)}e=t[i],cc.isValid(t[i])&&t[i].resStatus==a.ResourceStatus.Able&&(t[i].resStatus=a.ResourceStatus.Targeted),null==e||this._tmpVec2s[1].equals(cc.Vec2.ZERO_R)?this.setAnimation(n.AlleySpAnis.Idle):(this._collectTarget=e,this.isRunning=!0,this.setAnimation(n.AlleySpAnis.Run))}onDoAtk(){if(this.isDead)return;this.isRunning=!1,this.node.getPosition(this.movePoints[this.movePointsIdx++]),o.default.Instance.MgrAudio.forcePlayMusic(1),this.setAnimation(n.AlleySpAnis.Work,!1);let e=this._collectTarget;this._collectTarget=null,this.scheduleOnce(()=>{e.onHit(this.hurt);const t=this.collectNode.children[this.collectCount];let i=cc.instantiate(o.default.Instance.MgrRcs.prefabs[a.Prefabs.DropStone]);e.node.convertToWorldSpaceAR(cc.Vec2.ZERO_R,this._tmpVec2s[0]),t.parent.convertToNodeSpaceAR(this._tmpVec2s[0],this._tmpVec2s[1]),i.setPosition(this._tmpVec2s[1]),i.setParent(t.parent),i.getComponent(r.default).onFlyTo(t,()=>{this.collectNode.children[this.collectCount].active=!0,this.collectCount++,this.collectCount<this.maxCollectCount?this.onAtk():(this.isBacking=!0,this.movePointsIdx-=2,this.onBackToFactory())})},this._atkAniDelay)}onMoveDestination(e,t=!0){super.onMoveDestination(e,t),this._routeParent=e,e.convertToWorldSpaceAR(cc.Vec2.ZERO_R,this._tmpVec2s[0]),l.default.Instance.mapNode.convertToNodeSpaceAR(this._tmpVec2s[0],this.movePoints[0]),e.children.forEach((e,t)=>{e.convertToWorldSpaceAR(cc.Vec2.ZERO_R,this._tmpVec2s[0]),l.default.Instance.mapNode.convertToNodeSpaceAR(this._tmpVec2s[0],this.movePoints[t+1])}),this.movePointsIdx=e.children.length+1}onBackToFactory(){let e=cc.tween(this.node);for(let t=this.movePointsIdx;t>=0;t--){this._tmpVec2s[0].set(this.movePoints[t+1]),this._tmpVec2s[1].set(this.movePoints[t]),this._tmpVec2s[1].sub(this._tmpVec2s[0],this._tmpVec2s[2]);let i=this._tmpVec2s[2].x>=0?1:-1;e=e.then(cc.tween(this.node).call(()=>this.node.scaleX=i).to(this._tmpVec2s[2].mag()/a.AlleyMoveSpeed,{x:this._tmpVec2s[1].x,y:this._tmpVec2s[1].y}))}e=e.then(cc.tween(this.node).call(()=>{this.onFillResourceToFactory()})),this.setAnimation(n.AlleySpAnis.Run),e.start()}onFillResourceToFactory(){const e=l.default.Instance.factoryNodes[1].getComponent(c.default);for(let t=this.maxCollectCount-1;t>=0;t--){const i=l.default.Instance.factoryNodes[1].getChildByName("res");let s=cc.instantiate(o.default.Instance.MgrRcs.prefabs[a.Prefabs.DropStone]);this.collectNode.children[t].convertToWorldSpaceAR(cc.Vec2.ZERO_R,this._tmpVec2s[0]),i.convertToNodeSpaceAR(this._tmpVec2s[0],this._tmpVec2s[1]),s.setPosition(this._tmpVec2s[1]),s.setParent(i);let n=s.getComponent(r.default);this.scheduleOnce(()=>{n.onFlyTo(i,()=>{e.onAddResource(),this.collectNode.children[t].active=!1,this.collectCount--,0==this.collectCount&&this.onMoveDestination(this._routeParent)})},a.ResourceFillSpan*(this.maxCollectCount-1-t))}this.setAnimation(n.AlleySpAnis.Idle)}stopActions(){super.stopActions(),this.node.stopAllActions()}};u=s([d],u),i.default=u,cc._RF.pop()},{"../Framework/Management/MgrMain":"MgrMain","./Alley":"Alley","./Constant":"Constant","./DropCoin":"DropCoin","./Factory":"Factory","./InGaming":"InGaming","./InitStones":"InitStones"}],WorkerWood:[function(e,t,i){"use strict";cc._RF.push(t,"c446eHbB9hABKrOU9eWNlWg","WorkerWood");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const o=e("../Framework/Management/MgrMain"),n=e("./Alley"),a=e("./Constant"),r=e("./DropCoin"),c=e("./Factory"),l=e("./InGaming"),h=e("./InitTrees"),{ccclass:d,property:p}=cc._decorator;let u=class extends n.default{constructor(){super(...arguments),this.collectNode=null,this._routeParent=null,this.collectCount=0,this.maxCollectCount=a.MaxWorkerCollectCount,this.movePoints=[cc.v2(),cc.v2(),cc.v2(),cc.v2(),cc.v2(),cc.v2(),cc.v2(),cc.v2(),cc.v2(),cc.v2(),cc.v2()],this.movePointsIdx=0,this.isBacking=!1,this._atkRange=a.WorkerCollectRange,this._atkAniDelay=a.WorkerAtkAniDelay,this._collectTarget=null}onLoad(){super.onLoad()}start(){super.start(),this.collectNode=this.node.getChildByName("collects"),this.collectNode.children.forEach((e,t)=>e.active=t<this.collectCount)}update(e){this.isDead||cc.isValid(this._collectTarget)&&(this.node.getPosition(this._tmpVec2s[0]),this._collectTarget.node.getPosition(this._tmpVec2s[1]),this._tmpVec2s[1].subSelf(this._tmpVec2s[0]),this._tmpVec2s[1].mag()<=this._atkRange?(this.rigid.linearVelocity=cc.Vec2.ZERO_R,this.onDoAtk()):(this.node.scaleX=this._tmpVec2s[1].x>=0?1:-1,this.rigid.linearVelocity=this._tmpVec2s[1].normalizeSelf().mulSelf(a.AlleyMoveSpeed)))}onScheduleAtk(){this.onAtk()}onAtk(){if(this.isRunning||this.isDead)return void this.unschedule(this._onAtk);let e=null,t=h.default.Instance.treeItems,i=0,s=9999;this.node.getPosition(this._tmpVec2s[0]);for(let o=0;o<t.length;o++)if(cc.isValid(t[o])&&t[o].resStatus==a.ResourceStatus.Able){t[o].node.getPosition(this._tmpVec2s[1]),this._tmpVec2s[1].subSelf(this._tmpVec2s[0]);let e=this._tmpVec2s[1].mag();e<s&&(i=o,s=e)}e=t[i],cc.isValid(t[i])&&t[i].resStatus==a.ResourceStatus.Able&&(t[i].resStatus=a.ResourceStatus.Targeted),null==e||this._tmpVec2s[1].equals(cc.Vec2.ZERO_R)?this.setAnimation(n.AlleySpAnis.Idle):(this._collectTarget=e,this.isRunning=!0,this.setAnimation(n.AlleySpAnis.Run))}onDoAtk(){if(this.isDead)return;this.isRunning=!1,this.node.getPosition(this.movePoints[this.movePointsIdx++]),this.setAnimation(n.AlleySpAnis.Work,!1),o.default.Instance.MgrAudio.forcePlayMusic(1);let e=this._collectTarget;this._collectTarget=null,this.scheduleOnce(()=>{e.onHit(this.hurt);const t=this.collectNode.children[this.collectCount];let i=cc.instantiate(o.default.Instance.MgrRcs.prefabs[a.Prefabs.DropWood]);e.node.convertToWorldSpaceAR(cc.Vec2.ZERO_R,this._tmpVec2s[0]),t.parent.convertToNodeSpaceAR(this._tmpVec2s[0],this._tmpVec2s[1]),i.setPosition(this._tmpVec2s[1]),i.setParent(t.parent),i.getComponent(r.default).onFlyTo(t,()=>{this.collectNode.children[this.collectCount].active=!0,this.collectCount++,this.collectCount<this.maxCollectCount?this.onAtk():(this.isBacking=!0,this.movePointsIdx-=2,this.onBackToFactory())})},this._atkAniDelay)}onMoveDestination(e,t=!0){super.onMoveDestination(e,t),this._routeParent=e,e.convertToWorldSpaceAR(cc.Vec2.ZERO_R,this._tmpVec2s[0]),l.default.Instance.mapNode.convertToNodeSpaceAR(this._tmpVec2s[0],this.movePoints[0]),e.children.forEach((e,t)=>{e.convertToWorldSpaceAR(cc.Vec2.ZERO_R,this._tmpVec2s[0]),l.default.Instance.mapNode.convertToNodeSpaceAR(this._tmpVec2s[0],this.movePoints[t+1])}),this.movePointsIdx=e.children.length+1}onBackToFactory(){let e=cc.tween(this.node);for(let t=this.movePointsIdx;t>=0;t--){this._tmpVec2s[0].set(this.movePoints[t+1]),this._tmpVec2s[1].set(this.movePoints[t]),this._tmpVec2s[1].sub(this._tmpVec2s[0],this._tmpVec2s[2]);let i=this._tmpVec2s[2].x>=0?1:-1;e=e.then(cc.tween(this.node).call(()=>this.node.scaleX=i).to(this._tmpVec2s[2].mag()/a.AlleyMoveSpeed,{x:this._tmpVec2s[1].x,y:this._tmpVec2s[1].y}))}e=e.then(cc.tween(this.node).call(()=>{this.onFillResourceToFactory()})),this.setAnimation(n.AlleySpAnis.Run),e.start()}onFillResourceToFactory(){const e=l.default.Instance.factoryNodes[0].getComponent(c.default);for(let t=this.maxCollectCount-1;t>=0;t--){const i=l.default.Instance.factoryNodes[0].getChildByName("res");let s=cc.instantiate(o.default.Instance.MgrRcs.prefabs[a.Prefabs.DropWood]);this.collectNode.children[t].convertToWorldSpaceAR(cc.Vec2.ZERO_R,this._tmpVec2s[0]),i.convertToNodeSpaceAR(this._tmpVec2s[0],this._tmpVec2s[1]),s.setPosition(this._tmpVec2s[1]),s.setParent(i);let n=s.getComponent(r.default);this.scheduleOnce(()=>{n.onFlyTo(i,()=>{e.onAddResource(),this.collectNode.children[t].active=!1,this.collectCount--,0==this.collectCount&&this.onMoveDestination(this._routeParent)})},a.ResourceFillSpan*(this.maxCollectCount-1-t))}this.setAnimation(n.AlleySpAnis.Idle)}stopActions(){super.stopActions(),this.node.stopAllActions()}};u=s([d],u),i.default=u,cc._RF.pop()},{"../Framework/Management/MgrMain":"MgrMain","./Alley":"Alley","./Constant":"Constant","./DropCoin":"DropCoin","./Factory":"Factory","./InGaming":"InGaming","./InitTrees":"InitTrees"}],Zombie:[function(e,t,i){"use strict";cc._RF.push(t,"788abEFbftBbJ/Hzbja5iJO","Zombie");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const o=e("./Enemy"),{ccclass:n,property:a}=cc._decorator;let r=class extends o.default{onLoad(){super.onLoad()}start(){super.start()}};r=s([n],r),i.default=r,cc._RF.pop()},{"./Enemy":"Enemy"}],algorithm:[function(e,t,i){"use strict";cc._RF.push(t,"be16dRd5ntJPLikrWEFb8uK","algorithm"),Object.defineProperty(i,"__esModule",{value:!0}),i.Algorithm=void 0,i.Algorithm=class{static easeCubicIn(e){return Math.pow(e,3)}static easeCubicOut(e){return 1-Math.pow(1-e,3)}static easeCubicInOut(e,t=!0){const i=4*Math.pow(e,3),s=1-Math.pow(-2*e+2,3)/2;return t?e<.5?i:s:e<.5?1-i:1-s}static easeBounceOut(e){const t=7.5625;return e<.4?t*e*e:e<.8?t*(e-=.6)*e+.75:e<1?t*(e-=.9)*e+.9375:t*(e-=1.05)*e+.984375}static easeBackIn(e){return 2.70158*e*e*e-1.70158*e*e}static easeBackOut(e){return 1+2.70158*Math.pow(e-1,3)+1.70158*(e-1)*(e-1)}},cc._RF.pop()},{}],enums:[function(e,t,i){"use strict";cc._RF.push(t,"7c67eyfkTdEUpTwepa+DRPg","enums"),Object.defineProperty(i,"__esModule",{value:!0}),i.EnumsInUse=void 0,function(e){let t,i,s,o;(function(e){e[e.Left=-1]="Left",e[e.Right=1]="Right"})(t=e.Direction||(e.Direction={})),function(e){e[e.Idle=0]="Idle",e[e.Journey=1]="Journey",e[e.NonStop=2]="NonStop",e[e.Refine=3]="Refine",e[e.StopRand=4]="StopRand",e[e.StopFixed=5]="StopFixed"}(i=e.BehavingMode||(e.BehavingMode={})),function(e){e[e.Idle=0]="Idle",e[e.Running=1]="Running",e[e.Awaiting=2]="Awaiting",e[e.Paused=3]="Paused",e[e.Stop=4]="Stop"}(s=e.RunningState||(e.RunningState={})),function(e){e[e.Idle=0]="Idle",e[e.BigToSmall=1]="BigToSmall",e[e.SmallToBig=2]="SmallToBig"}(o=e.FigureSwipMode||(e.FigureSwipMode={}))}(i.EnumsInUse||(i.EnumsInUse={})),cc._RF.pop()},{}],fadeThing:[function(e,t,i){"use strict";cc._RF.push(t,"10af0POpTBABpnRUvE4aZq9","fadeThing");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const o=e("../../../utils/enums"),n=e("../../../utils/messager"),a=e("./EaseConfig"),{ccclass:r,property:c,menu:l}=cc._decorator;let h=class extends cc.Component{constructor(){super(...arguments),this.mode=o.EnumsInUse.RunningState.Idle,this.ConstantSpeed=!0,this.Loop=!1,this.Auto=!1,this.CycleTimes=1,this.fadeItems=[cc.v2(.5,255)],this.easeType=a.EaseType.CubicOut,this._tikPast=0,this._itemCursor=0,this._oppacityOff=0,this._numPrevious=0,this._numPer=0,this._cycleTimes=0}onLoad(){this._initEvents()}onEnable(){this.Auto&&(this.mode=o.EnumsInUse.RunningState.Running),this.CycleTimes<1&&(this.CycleTimes=1),this._cycleTimes=this.CycleTimes,this._itemCursor=0,this._tikPast=0,this._numPrevious=this.node.opacity,this._calculate()}onDisable(){this.mode=o.EnumsInUse.RunningState.Idle}start(){}update(e){this._calculate(e)}_initEvents(){this.node.on(n.Messager.Inners.StateChange_Pause,()=>{this.mode=o.EnumsInUse.RunningState.Paused},this),this.node.on(n.Messager.Inners.StateChange_Run,()=>{this.mode=o.EnumsInUse.RunningState.Running},this),this.node.on(n.Messager.Inners.StateChange_Stop,()=>{this.mode=o.EnumsInUse.RunningState.Stop},this),this.node.on(n.Messager.Inners.ThingSetChange_Fade,e=>{e&&(this.fadeItems=e),this._itemCursor=0,this._tikPast=0},this)}_calculate(e=0){switch(this.mode){case o.EnumsInUse.RunningState.Running:if(this.fadeItems.length<=0)return;this._tikPast=this._tikPast+e,this._numPer=this.ConstantSpeed?this._tikPast/this.fadeItems[this._itemCursor].x:a.EaseFunction[this.easeType](this._tikPast/this.fadeItems[this._itemCursor].x),this._oppacityOff=this._numPer*(this.fadeItems[this._itemCursor].y-this._numPrevious);break;default:return}if(this.node.opacity=this._numPrevious+this._oppacityOff,this._tikPast>=this.fadeItems[this._itemCursor].x&&(this.node.opacity=this.fadeItems[this._itemCursor].y,this._tikPast=this._tikPast-this.fadeItems[this._itemCursor].x,this._numPrevious=this.fadeItems[this._itemCursor].y,this._itemCursor++),this._itemCursor>=this.fadeItems.length){if(this._itemCursor=0,this.Loop)return;if(this._cycleTimes--,this._cycleTimes<1)return void(this.mode=o.EnumsInUse.RunningState.Idle)}}};s([c({type:cc.Enum(o.EnumsInUse.RunningState)})],h.prototype,"mode",void 0),s([c],h.prototype,"ConstantSpeed",void 0),s([c],h.prototype,"Loop",void 0),s([c],h.prototype,"Auto",void 0),s([c],h.prototype,"CycleTimes",void 0),s([c({type:[cc.Vec2]})],h.prototype,"fadeItems",void 0),s([c({type:cc.Enum(a.EaseType),visible:function(){return!this.ConstantSpeed}})],h.prototype,"easeType",void 0),h=s([r,l("Creatives/behavior2d/FadeThing")],h),i.default=h,cc._RF.pop()},{"../../../utils/enums":"enums","../../../utils/messager":"messager","./EaseConfig":"EaseConfig"}],follower2d:[function(e,t,i){"use strict";cc._RF.push(t,"7a46139oYhJfJvQJTJbW+HZ","follower2d");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const o=e("../../Management/MgrMain"),{ccclass:n,property:a,executeInEditMode:r,menu:c}=cc._decorator;let l=class extends cc.Component{constructor(){super(...arguments),this.InEditor=!1,this.effectNode=null,this.followeeNode=null,this.followerCam=null,this.followeeCam=null,this.followAlways=!1,this.keepMargin=!1,this.marginBox=new cc.Vec4(50,50,50,50),this._position=cc.v3(),this._screenPosition=cc.v3(),this._marginLimits=null,this._frameSizeChangedCbIdx=-1}onLoad(){this.effectNode||(this.effectNode=this.node),this.followeeNode||(this.followeeCam=this.followerCam),this._frameSizeChangedCbIdx=o.default.Instance.AddCallbackFrameSizeChanged(this.onEventFrameSizeChanged.bind(this))}start(){}onEventFrameSizeChanged(e){this.scheduleOnce(()=>{this._resetMarginLimits(),this._move()})}update(e){this.followAlways&&this._move()}_move(){this.followeeNode&&this.effectNode.parent&&(this.keepMargin&&null==this._marginLimits||(this._position=this.effectNode.parent.convertToNodeSpaceAR(this.followerCam.getScreenToWorldPoint(this.followeeCam.getWorldToScreenPoint(this.followeeNode.convertToWorldSpaceAR(cc.v3())))),this.keepMargin&&(this.followerCam.getWorldToScreenPoint(this.effectNode.parent.convertToWorldSpaceAR(this._position),this._screenPosition),this._screenPosition.y>this._marginLimits.x&&(this._screenPosition.y=this._marginLimits.x),this._screenPosition.y<this._marginLimits.y&&(this._screenPosition.y=this._marginLimits.y),this._screenPosition.x<this._marginLimits.z&&(this._screenPosition.x=this._marginLimits.z),this._screenPosition.x>this._marginLimits.w&&(this._screenPosition.x=this._marginLimits.w),this.followerCam.getScreenToWorldPoint(this._screenPosition,this._position),this.effectNode.parent.convertToNodeSpaceAR(this._position,this._position)),this.effectNode.setPosition(this._position)))}_resetMarginLimits(){if(!this.keepMargin)return;let e=cc.winSize;this._marginLimits=new cc.Vec4(e.height-this.marginBox.x,this.marginBox.y,this.marginBox.z,e.width-this.marginBox.w)}};s([a],l.prototype,"InEditor",void 0),s([a(cc.Node)],l.prototype,"effectNode",void 0),s([a(cc.Node)],l.prototype,"followeeNode",void 0),s([a(cc.Camera)],l.prototype,"followerCam",void 0),s([a(cc.Camera)],l.prototype,"followeeCam",void 0),s([a],l.prototype,"followAlways",void 0),s([a],l.prototype,"keepMargin",void 0),s([a({visible:function(){return this.keepMargin},tooltip:!1})],l.prototype,"marginBox",void 0),l=s([n,c("Creatives/follower2d"),r],l),i.default=l,cc._RF.pop()},{"../../Management/MgrMain":"MgrMain"}],messager:[function(e,t,i){"use strict";cc._RF.push(t,"c9eacjg2vBLLYuMhsq57rjw","messager"),Object.defineProperty(i,"__esModule",{value:!0}),i.Messager=void 0;class s{}i.Messager=s,s.Inners={StateChange_Run:"onMSG_StateChange_Run",StateChange_Pause:"onMSG_StateChange_Pause",StateChange_Stop:"onMSG_StateChange_Stop",ThingSetChange_Scale:"onMSG_ThingSetChange_scale",ThingSetChange_Fade:"onMSG_ThingSetChange_fade",ThingSetChange_Move:"onMSG_ThingSetChange_move",ThingSetChange_Active:"onMSG_ThingSetChange_active",CMNEVENTS_DragIn:"onMSG_CommonEvent_DragIn",CMNEVENTS_DragOut:"onMSG_CommonEvent_DragOut",WheelRollStart:"onMSG_WheelRollingStart",WheelRollStop:"onMSG_WheelRollingStop",WheelAnglesSet:"onMSG_WheelAnglesSet",WheelFeedback_Stop:"onMSG_WheelFeedback_Stop",TimerSetCountDown:"onMSG_TimerSetCountDown",TimerSetCountUp:"onMSG_TimerSetCountUp",TimerSetPause:" onMSG_TimerSetPause",TimerSetContinue:"onMSG_TimerSetContinue",ScratcherBlockOn:"onMSG_ScratcherBlockOn",ScratcherBlockOff:"onMSG_ScratcherBlockOff",ScratcherSetsRefine:"onMSG_ScratcherSetsRefine",ScratcherFeedback_Start:"onMSG_ScratcherFeedback_Start",ScratcherFeedback_Stop:"onMSG_ScratcherFeedback_Stop",ScratcherFeedback_Move:"onMSG_ScratcherFeedback_Move",ScratcherFeedback_Fulfil:"onMSG_ScratcherFeedback_Fulfil",ScratcherFeedback_Locate:"onMSG_ScratcherFeedback_Locate",ScratcherFeedback_Proportion:"onMSG_ScratcherFeedback_Proportion",CycleGridSetBehave:"onMSG_CycleGridSetBehave",CycleGridFeedback_Stop:"onMSG_CycleGridFeedback_Stop",RangeBarHit:"onMSG_RangeBarHit",RangeBarPause:"onMSG_RangeBarPause",RangeBarHitAndPause:"onMSG_RangeBarHitAndPause",RangeBarContinue:"onMSG_RangeBarContinue",RangeBarSetPercent:"onMSG_RangeBarSetPercent",RangeBarFeedback_Hit:"onMSG_RangeBarFeedback_Hit",RangeBarSetContentSize:"onMSG_RangeBarSetContentSize"},cc._RF.pop()},{}],moveThing:[function(e,t,i){"use strict";cc._RF.push(t,"25cdb2F+kFDT6VrAfpyZdLp","moveThing");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const o=e("../../../utils/enums"),n=e("../../../utils/messager"),a=e("./EaseConfig"),{ccclass:r,property:c,menu:l}=cc._decorator;let h=class extends cc.Component{constructor(){super(...arguments),this.mode=o.EnumsInUse.RunningState.Idle,this.ConstantSpeed=!0,this.Loop=!1,this.Auto=!1,this.CycleTimes=1,this.moveItems=[cc.v3(.5,1,1)],this.easeType=a.EaseType.CubicOut,this._tikPast=0,this._itemCursor=0,this._moveOff=cc.v2(),this._posDefault=cc.v2(),this._posPrevious=cc.v2(),this._numPer=0}onLoad(){this._initEvents()}onEnable(){this.Auto&&(this.mode=o.EnumsInUse.RunningState.Running),this.CycleTimes<1&&(this.CycleTimes=1),this._itemCursor=0,this._tikPast=0,this._posPrevious=this.node.getPosition(),this._calculate()}onDisable(){this.mode=o.EnumsInUse.RunningState.Idle}start(){}update(e){this._calculate(e)}_initEvents(){this.node.on(n.Messager.Inners.StateChange_Pause,()=>{this.mode=o.EnumsInUse.RunningState.Paused},this),this.node.on(n.Messager.Inners.StateChange_Run,()=>{this.mode=o.EnumsInUse.RunningState.Running},this),this.node.on(n.Messager.Inners.StateChange_Stop,()=>{this.mode=o.EnumsInUse.RunningState.Stop},this),this.node.on(n.Messager.Inners.ThingSetChange_Move,e=>{e&&(this.moveItems=e),this._itemCursor=0,this._tikPast=0},this)}_calculate(e=0){switch(this.mode){case o.EnumsInUse.RunningState.Running:if(this.moveItems.length<=0)return;this._tikPast=this._tikPast+e,this._numPer=this.ConstantSpeed?this._tikPast/this.moveItems[this._itemCursor].x:a.EaseFunction[this.easeType](this._tikPast/this.moveItems[this._itemCursor].x),this._moveOff.x=this._numPer*(this.moveItems[this._itemCursor].y-this._posPrevious.x),this._moveOff.y=this._numPer*(this.moveItems[this._itemCursor].z-this._posPrevious.y);break;default:return}if(this.node.setPosition(this._posPrevious.add(cc.v2(this._moveOff.x,this._moveOff.y))),this._tikPast>=this.moveItems[this._itemCursor].x&&(this.node.setPosition(this.moveItems[this._itemCursor].y,this.moveItems[this._itemCursor].z),this._tikPast=this._tikPast-this.moveItems[this._itemCursor].x,this._posPrevious.x=this.moveItems[this._itemCursor].y,this._posPrevious.y=this.moveItems[this._itemCursor].z,this._itemCursor++),this._itemCursor>=this.moveItems.length){if(this._itemCursor=0,this.Loop)return;if(this.CycleTimes--,this.CycleTimes<1)return void(this.mode=o.EnumsInUse.RunningState.Idle)}}};s([c({type:cc.Enum(o.EnumsInUse.RunningState)})],h.prototype,"mode",void 0),s([c],h.prototype,"ConstantSpeed",void 0),s([c],h.prototype,"Loop",void 0),s([c],h.prototype,"Auto",void 0),s([c],h.prototype,"CycleTimes",void 0),s([c({type:[cc.Vec3]})],h.prototype,"moveItems",void 0),s([c({type:cc.Enum(a.EaseType),visible:function(){return!this.ConstantSpeed}})],h.prototype,"easeType",void 0),h=s([r,l("Creatives/behavior2d/MoveThing")],h),i.default=h,cc._RF.pop()},{"../../../utils/enums":"enums","../../../utils/messager":"messager","./EaseConfig":"EaseConfig"}],scaleThing:[function(e,t,i){"use strict";cc._RF.push(t,"78204NgS2hBDLnHjeaQ7UoY","scaleThing");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const o=e("../../../utils/enums"),n=e("../../../utils/messager"),a=e("./EaseConfig"),{ccclass:r,property:c,menu:l}=cc._decorator;let h=class extends cc.Component{constructor(){super(...arguments),this.mode=o.EnumsInUse.RunningState.Idle,this.ConstantSpeed=!0,this.Loop=!1,this.Auto=!1,this.CycleTimes=1,this.scaleItems=[cc.v3(.5,1,1)],this.easeType=a.EaseType.CubicOut,this._tikPast=0,this._itemCursor=0,this._scaleOff=cc.v2(),this._numDefault=cc.v2(),this._numPrevious=cc.v2(),this._numPer=0}onLoad(){this._initEvents()}onEnable(){this.Auto&&(this.mode=o.EnumsInUse.RunningState.Running),this.CycleTimes<1&&(this.CycleTimes=1),this._itemCursor=0,this._tikPast=0,this.node.getScale(this._numPrevious),this._calculate()}onDisable(){this.mode=o.EnumsInUse.RunningState.Idle}start(){}update(e){this._calculate(e)}_initEvents(){this.node.on(n.Messager.Inners.StateChange_Pause,()=>{this.mode=o.EnumsInUse.RunningState.Paused},this),this.node.on(n.Messager.Inners.StateChange_Run,()=>{this.mode=o.EnumsInUse.RunningState.Running},this),this.node.on(n.Messager.Inners.StateChange_Stop,()=>{this.mode=o.EnumsInUse.RunningState.Stop},this),this.node.on(n.Messager.Inners.ThingSetChange_Scale,e=>{e&&(this.scaleItems=e),this._itemCursor=0,this._tikPast=0},this)}_calculate(e=0){switch(this.mode){case o.EnumsInUse.RunningState.Running:if(this.scaleItems.length<=0)return;this._tikPast=this._tikPast+e,this._numPer=this.ConstantSpeed?this._tikPast/this.scaleItems[this._itemCursor].x:a.EaseFunction[this.easeType](this._tikPast/this.scaleItems[this._itemCursor].x),this._scaleOff.x=this._numPer*(this.scaleItems[this._itemCursor].y-this._numPrevious.x),this._scaleOff.y=this._numPer*(this.scaleItems[this._itemCursor].z-this._numPrevious.y);break;default:return}if(this.node.setScale(this._numPrevious.x+this._scaleOff.x,this._numPrevious.y+this._scaleOff.y),this._tikPast>=this.scaleItems[this._itemCursor].x&&(this.node.setScale(this.scaleItems[this._itemCursor].y,this.scaleItems[this._itemCursor].z),this._tikPast=this._tikPast-this.scaleItems[this._itemCursor].x,this._numPrevious.x=this.scaleItems[this._itemCursor].y,this._numPrevious.y=this.scaleItems[this._itemCursor].z,this._itemCursor++),this._itemCursor>=this.scaleItems.length){if(this._itemCursor=0,this.Loop)return;if(this.CycleTimes--,this.CycleTimes<1)return void(this.mode=o.EnumsInUse.RunningState.Idle)}}};s([c({type:cc.Enum(o.EnumsInUse.RunningState)})],h.prototype,"mode",void 0),s([c],h.prototype,"ConstantSpeed",void 0),s([c],h.prototype,"Loop",void 0),s([c],h.prototype,"Auto",void 0),s([c],h.prototype,"CycleTimes",void 0),s([c({type:[cc.Vec3]})],h.prototype,"scaleItems",void 0),s([c({type:cc.Enum(a.EaseType),visible:function(){return!this.ConstantSpeed}})],h.prototype,"easeType",void 0),h=s([r,l("Creatives/behavior2d/ScaleThing")],h),i.default=h,cc._RF.pop()},{"../../../utils/enums":"enums","../../../utils/messager":"messager","./EaseConfig":"EaseConfig"}],super_html_playable:[function(e,t,i){"use strict";cc._RF.push(t,"1bdceKB2y5HzJQvRBJtO0XQ","super_html_playable"),Object.defineProperty(i,"__esModule",{value:!0}),i.super_html_playable=void 0;class s{download(){console.log("download"),window.super_html&&super_html.download()}game_end(){console.log("game end"),window.super_html&&super_html.game_end()}is_hide_download(){return!(!window.super_html||!super_html.is_hide_download)&&super_html.is_hide_download()}set_google_play_url(e){window.super_html&&(super_html.google_play_url=e)}set_app_store_url(e){window.super_html&&(super_html.appstore_url=e)}is_audio(){return window.super_html&&super_html.is_audio()||!0}}i.super_html_playable=s,i.default=new s,cc._RF.pop()},{}],utils:[function(e,t,i){"use strict";cc._RF.push(t,"bd029zHh/FEeIO/Jb/rs2Sp","utils"),Object.defineProperty(i,"__esModule",{value:!0}),i.Utils=void 0;let s=[cc.v3(),cc.v3(),cc.v3()];i.Utils=class{static numToStringInt(e){return Math.floor(e).toLocaleString()}static parseStringToInt(e){let t=e.replace(/\,/,"");return parseInt(t)}static RandomRangeInt(e,t){return Math.floor(this.RandomRangeFloat(e,t))}static RandomRangeFloat(e,t){return Math.random()*(t-e)+e}static ConvertPosToOtherCamera(e,t,i,s){if(!e.parent||!t)return null;const o=i===s?cc.v2():cc.v2().add(s.getPosition()).sub(i.getPosition());return t.convertToNodeSpaceAR(e.parent.convertToWorldSpaceAR(e.getPosition())).add(o)}static ConvertPosToOtherCameraByScreen(e,t,i,o,n){return t&&i?(o||(o=i),e.convertToWorldSpaceAR(cc.Vec3.ZERO,s[0]),i.getWorldToScreenPoint(s[0],s[1]),o.getScreenToWorldPoint(s[1],s[2]),n=n||cc.v3(),t.convertToNodeSpaceAR(s[2],n)):null}static ConvertTouchToLocal(e,t,i,o){return e instanceof cc.Vec2&&(e=cc.v3(e.x,e.y,0)),i.getScreenToWorldPoint(e,s[0]),o=o||cc.v3(),t.convertToNodeSpaceAR(s[0],o),o}static calculateBezPoint2(e,t,i,s,o=!1){null==i&&(i=t.sub(e).mag());let n="number"==typeof i?cc.v2(i,i):i;null==s&&(s=.3);let a="number"==typeof s?cc.v2(s,.6-s):s,r=t.sub(e).normalizeSelf().rotateSelf(.5*Math.PI),c=e.add(t).mulSelf(.5),l=r.rotate(Math.PI*a.x).mulSelf(n.x).addSelf(c),h=r.rotate(-Math.PI*a.y).mulSelf(n.y).addSelf(c);return o?[h,l]:[l,h]}static GetWorldScale(e,t){let i=e.scale;for(;cc.isValid(e.parent)&&(e=e.parent,!cc.isValid(t)||t!=e);)i*=e.scale;return i}static GetWorldAngle(e,t){let i=e.angle;for(;cc.isValid(e.parent)&&(e=e.parent,!cc.isValid(t)||t!=e);)i+=e.angle;return i}},cc._RF.pop()},{}],whirlingThing:[function(e,t,i){"use strict";cc._RF.push(t,"52ce04ocz5LSYNZKdBedUxL","whirlingThing");var s=this&&this.__decorate||function(e,t,i,s){var o,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});const o=e("../../../utils/enums"),n=e("../../../utils/messager"),a=e("./EaseConfig"),{ccclass:r,property:c,menu:l}=cc._decorator;let h=class extends cc.Component{constructor(){super(...arguments),this.Loop=!1,this.Auto=!1,this.mode=o.EnumsInUse.RunningState.Idle,this.ConstantSpeed=!0,this.direction=o.EnumsInUse.Direction.Left,this.CycleTimes=1,this.yawItems=[cc.v2(0,0),cc.v2(1,360),cc.v2(0,0)],this.easeType=a.EaseType.CubicOut,this._tikPast=0,this._itemCursor=0,this._angleOff=0,this._anglePrevious=0,this._numPer=0,this._angleFoward=1}onLoad(){this._initEvents()}onEnable(){this.Auto&&(this.mode=o.EnumsInUse.RunningState.Running),this.CycleTimes<1&&(this.CycleTimes=1),this._anglePrevious=this.node.angle,this._calculate()}onDisable(){this.mode=o.EnumsInUse.RunningState.Idle}start(){}_initEvents(){this.node.on(n.Messager.Inners.StateChange_Pause,()=>{this.mode=o.EnumsInUse.RunningState.Paused},this),this.node.on(n.Messager.Inners.StateChange_Run,()=>{this.mode=o.EnumsInUse.RunningState.Running},this),this.node.on(n.Messager.Inners.StateChange_Stop,()=>{this.mode=o.EnumsInUse.RunningState.Stop},this)}update(e){this._calculate(e)}_calculate(e=0){switch(this.direction){case o.EnumsInUse.Direction.Left:this._angleFoward=1;break;case o.EnumsInUse.Direction.Right:this._angleFoward=-1}switch(this.mode){case o.EnumsInUse.RunningState.Running:if(this.yawItems.length<=0)return;this._tikPast=this._tikPast+e,this._numPer=this.ConstantSpeed?this._tikPast/this.yawItems[this._itemCursor].x:a.EaseFunction[this.easeType](this._tikPast/this.yawItems[this._itemCursor].x),this._angleOff=this._numPer*(this.yawItems[this._itemCursor].y-this._anglePrevious)*this._angleFoward;break;default:return}if(this.node.angle=this._anglePrevious+this._angleOff,this._tikPast>=this.yawItems[this._itemCursor].x&&(this.node.angle=this.yawItems[this._itemCursor].y,this._tikPast=this._tikPast-this.yawItems[this._itemCursor].x,this._anglePrevious=this.yawItems[this._itemCursor].y,this._itemCursor++),this._itemCursor>=this.yawItems.length){if(this._itemCursor=0,this.Loop)return;if(this.CycleTimes--,this.CycleTimes<1)return void(this.mode=o.EnumsInUse.RunningState.Idle)}}};s([c],h.prototype,"Loop",void 0),s([c],h.prototype,"Auto",void 0),s([c({type:cc.Enum(o.EnumsInUse.RunningState)})],h.prototype,"mode",void 0),s([c],h.prototype,"ConstantSpeed",void 0),s([c({type:cc.Enum(o.EnumsInUse.Direction)})],h.prototype,"direction",void 0),s([c({})],h.prototype,"CycleTimes",void 0),s([c({type:[cc.Vec2]})],h.prototype,"yawItems",void 0),s([c({type:cc.Enum(a.EaseType),visible:function(){return!this.ConstantSpeed}})],h.prototype,"easeType",void 0),h=s([r,l("Creatives/behavior2d/WhirlingThing")],h),i.default=h,cc._RF.pop()},{"../../../utils/enums":"enums","../../../utils/messager":"messager","./EaseConfig":"EaseConfig"}]},{},["CircleGradient","MultiCircleGradient","CyclePic","SortZIndex","AnimationCtrl","FlexEventMessageCtrl","InGame","NotesHelper","ParticleSystemCtrl","RepeatableBehavior","SpineAnimationCtrl","MgrAudio","MgrMain","MgrResource","MgrVersion","PPR2dBase","FloatAbove","ActiveThing","EaseConfig","fadeThing","moveThing","scaleThing","whirlingThing","follower2d","CineCamera","CineCamera2d","ViewAdapter","I18nLabel","I18nManager","I18nSprite","CallEvent","PoolRecycle","ScreenRecorder","algorithm","enums","messager","utils","PBASDK","PrintComponent","StutterCheck","super_html_playable","SkeletonExt","TweenExt","Alley","AlleyAtk","Archer","Area","AtkArrow","Boss","Camp","CharacterController","CharacterHandler","CollectItem","Constant","Door","DoorTrigger","DropCoin","Enemy","EnemyInit","Factory","FactoryBase","Farmer","FarmerInit","Fence","HeroAtk","InGaming","InitStones","InitTrees","JianTa","Need","NeedFarmer","RangeFollowee","SwordsMan","SyncRigidPosition","WorkerRepair","WorkerStone","WorkerWood","Zombie"]);