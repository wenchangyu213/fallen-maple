let baseSearchPriority=0;function getAllTags(){const e=new Set;return portfolioData.categories.forEach(t=>{t.items.forEach(t=>{t.tags.forEach(t=>e.add(t))})}),Array.from(e)}function renderTags(){const e=document.getElementById("tags-container");getAllTags().forEach(t=>{const n=document.createElement("div");n.className="tag",n.textContent=t,n.dataset.tag=t,e.appendChild(n)})}function toggleTag(){this.classList.toggle("active"),filterPortfolio()}function getSelectedTags(){const e=[];return document.querySelectorAll(".tag.active").forEach(t=>{e.push(t.dataset.tag)}),e}function filterPortfolio(){renderPortfolio(document.getElementById("search-input").value.toLowerCase(),getSelectedTags())}function renderPortfolio(e="",t=[],n=0){n=n||baseSearchPriority;const a=document.getElementById("portfolio-container");a.innerHTML="",portfolioData.categories.forEach((r,o)=>{let c=r.items.filter(a=>{const r=""===e||a.title.toLowerCase().includes(e)||a.description.toLowerCase().includes(e),o=0===t.length||t.some(e=>a.tags.includes(e)),c=a.priority>=n;return r&&o&&c});if(c.sort((e,t)=>t.priority-e.priority),c.length>0){const e=document.createElement("div");e.className="category",e.innerHTML=`\n                <div class="category-header" data-category-index="${o}">\n                    <div class="category-title">${r.name}</div>\n                    <div class="item-count">${c.length} 个项目</div>\n                    <div class="toggle-icon">\n                        <i class="fas fa-chevron-down"></i>\n                    </div>\n                </div>\n                <div class="category-content">\n                    ${c.map(e=>createCardHTML(e)).join("")}\n                </div>\n            `,a.appendChild(e),e.querySelector(".category-header").addEventListener("click",function(){const e=this.dataset.categoryIndex;document.querySelector(`.category-header[data-category-index="${e}"]`).parentNode.classList.toggle("collapsed")})}}),""===a.innerHTML&&(a.innerHTML='\n            <div class="no-results">\n                <i class="fas fa-search"></i>\n                <h3>没有找到匹配的项目</h3>\n                <p>请尝试不同的搜索词或标签组合</p>\n            </div>\n        ')}function createCardHTML(e){return`\n        <div class="card ${e.priority>=9?"priority-high":""}">\n            <img src="${e.image}" alt="${e.title}" class="card-image">\n            <div class="card-content">\n                <h3 class="card-title">${e.title}</h3>\n                <p class="card-description">${e.description}</p>\n                <div class="card-tags">\n                    ${e.tags.map(e=>`<span class="card-tag">${e}</span>`).join("")}\n                </div>\n                <a href="${e.link}" class="card-link" target="_blank">预览项目</a>\n            </div>\n        </div>\n    `}function getQueryParam(e){return new URLSearchParams(window.location.search).get(e)||""}document.addEventListener("DOMContentLoaded",async function(){baseSearchPriority=getQueryParam("p")||0,document.getElementById("search-input").addEventListener("input",filterPortfolio),document.querySelectorAll(".tag").forEach(e=>{e.addEventListener("click",toggleTag)}),document.getElementById("show-all").addEventListener("click",()=>{document.getElementById("search-input").value="",document.querySelectorAll(".tag").forEach(e=>e.classList.remove("active")),renderPortfolio()}),document.getElementById("show-high-priority").addEventListener("click",()=>{document.querySelectorAll(".tag").forEach(e=>e.classList.remove("active")),renderPortfolio("",[],9)}),document.getElementById("footer").innerHTML=`© 2025 ${getQueryParam("name")||"俞文昶"} 个人作品集展示 | 精心制作，持续更新`;const e=(new Date).getTime(),t=getQueryParam("te");t&&e>t||(renderTags(),renderPortfolio())});